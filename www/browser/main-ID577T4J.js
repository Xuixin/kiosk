import{G as rc,H as nc,P as oc,h as Qu,i as Hu,j as Yu,k as Xu,l as Gu,m as Aa,p as Ju,q as Zu,s as ec,t as tc}from"./chunk-KOBMHIEX.js";import{E as _n,Ea as Bu,Ga as Lu,Ib as Ra,J as Pu,Ja as Fu,Jb as zu,L as Oo,M as Do,Ma as ju,Q as En,Qa as Ku,Ra as Ao,U as Io,V as Ro,X as Tu,Z as Sn,_ as Mu,a as Ru,ab as qu,b as Xt,d as bn,fa as On,g as Gt,ga as ku,h as So,ha as Da,ib as Uu,jb as Vu,ka as Ia,kb as Wu,la as Nu,p as Au,q as ot,s as Br,va as $u,y as Cu,z as ke}from"./chunk-OCTBPTXY.js";import{a as ic,b as ac}from"./chunk-7VI3B7OV.js";import"./chunk-4YPYJS6U.js";import"./chunk-QUJFQN2Y.js";import"./chunk-PGGZLCZV.js";import"./chunk-LN62OXT4.js";import"./chunk-VRQX2TS7.js";import"./chunk-WVHTM5RI.js";import"./chunk-IN6HLDFE.js";import"./chunk-GIMG75PD.js";import"./chunk-BP2O4U4W.js";import"./chunk-4QA23ZVJ.js";import"./chunk-TSFXGCXF.js";import"./chunk-BMJVVMK5.js";import"./chunk-GG23IEC3.js";import"./chunk-PT7C45JL.js";import"./chunk-ASP7KJ2N.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-E6ADAMKR.js";import"./chunk-CKP3SGE2.js";import"./chunk-UA4ENH7I.js";import{a as he,b as Oe,e as hh,f as dh,g as S}from"./chunk-2R6CW7ES.js";var bm=hh((Ms,ks)=>{"use strict";(function(e,t){typeof Ms=="object"&&typeof ks<"u"?ks.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis<"u"?globalThis:e||self,e.Dexie=t())})(Ms,function(){"use strict";var e=function(o,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,u){s.__proto__=u}||function(s,u){for(var l in u)Object.prototype.hasOwnProperty.call(u,l)&&(s[l]=u[l])},e(o,i)};function t(o,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");e(o,i);function s(){this.constructor=o}o.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}var r=function(){return r=Object.assign||function(i){for(var s,u=1,l=arguments.length;u<l;u++){s=arguments[u];for(var m in s)Object.prototype.hasOwnProperty.call(s,m)&&(i[m]=s[m])}return i},r.apply(this,arguments)};function n(o,i,s){if(s||arguments.length===2)for(var u=0,l=i.length,m;u<l;u++)(m||!(u in i))&&(m||(m=Array.prototype.slice.call(i,0,u)),m[u]=i[u]);return o.concat(m||Array.prototype.slice.call(i))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,c=Object.keys,f=Array.isArray;typeof Promise<"u"&&!a.Promise&&(a.Promise=Promise);function p(o,i){return typeof i!="object"||c(i).forEach(function(s){o[s]=i[s]}),o}var d=Object.getPrototypeOf,_={}.hasOwnProperty;function x(o,i){return _.call(o,i)}function E(o,i){typeof i=="function"&&(i=i(d(o))),(typeof Reflect>"u"?c:Reflect.ownKeys)(i).forEach(function(s){I(o,s,i[s])})}var R=Object.defineProperty;function I(o,i,s,u){R(o,i,p(s&&x(s,"get")&&typeof s.get=="function"?{get:s.get,set:s.set,configurable:!0}:{value:s,configurable:!0,writable:!0},u))}function A(o){return{from:function(i){return o.prototype=Object.create(i.prototype),I(o.prototype,"constructor",o),{extend:E.bind(null,o.prototype)}}}}var F=Object.getOwnPropertyDescriptor;function B(o,i){var s=F(o,i),u;return s||(u=d(o))&&B(u,i)}var Z=[].slice;function G(o,i,s){return Z.call(o,i,s)}function re(o,i){return i(o)}function xe(o){if(!o)throw new Error("Assertion Failed")}function me(o){a.setImmediate?setImmediate(o):setTimeout(o,0)}function be(o,i){return o.reduce(function(s,u,l){var m=i(u,l);return m&&(s[m[0]]=m[1]),s},{})}function ne(o,i){if(typeof i=="string"&&x(o,i))return o[i];if(!i)return o;if(typeof i!="string"){for(var s=[],u=0,l=i.length;u<l;++u){var m=ne(o,i[u]);s.push(m)}return s}var h=i.indexOf(".");if(h!==-1){var v=o[i.substr(0,h)];return v==null?void 0:ne(v,i.substr(h+1))}}function le(o,i,s){if(!(!o||i===void 0)&&!("isFrozen"in Object&&Object.isFrozen(o)))if(typeof i!="string"&&"length"in i){xe(typeof s!="string"&&"length"in s);for(var u=0,l=i.length;u<l;++u)le(o,i[u],s[u])}else{var m=i.indexOf(".");if(m!==-1){var h=i.substr(0,m),v=i.substr(m+1);if(v==="")s===void 0?f(o)&&!isNaN(parseInt(h))?o.splice(h,1):delete o[h]:o[h]=s;else{var y=o[h];(!y||!x(o,h))&&(y=o[h]={}),le(y,v,s)}}else s===void 0?f(o)&&!isNaN(parseInt(i))?o.splice(i,1):delete o[i]:o[i]=s}}function Be(o,i){typeof i=="string"?le(o,i,void 0):"length"in i&&[].map.call(i,function(s){le(o,s,void 0)})}function mt(o){var i={};for(var s in o)x(o,s)&&(i[s]=o[s]);return i}var nn=[].concat;function Lt(o){return nn.apply([],o)}var Dt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Lt([8,16,32,64].map(function(o){return["Int","Uint","Float"].map(function(i){return i+o+"Array"})}))).filter(function(o){return a[o]}),Hn=new Set(Dt.map(function(o){return a[o]}));function Yn(o){var i={};for(var s in o)if(x(o,s)){var u=o[s];i[s]=!u||typeof u!="object"||Hn.has(u.constructor)?u:Yn(u)}return i}function Bi(o){for(var i in o)if(x(o,i))return!1;return!0}var sr=null;function rt(o){sr=new WeakMap;var i=Ft(o);return sr=null,i}function Ft(o){if(!o||typeof o!="object")return o;var i=sr.get(o);if(i)return i;if(f(o)){i=[],sr.set(o,i);for(var s=0,u=o.length;s<u;++s)i.push(Ft(o[s]))}else if(Hn.has(o.constructor))i=o;else{var l=d(o);i=l===Object.prototype?{}:Object.create(l),sr.set(o,i);for(var m in o)x(o,m)&&(i[m]=Ft(o[m]))}return i}var on={}.toString;function jt(o){return on.call(o).slice(8,-1)}var an=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Ke=typeof an=="symbol"?function(o){var i;return o!=null&&(i=o[an])&&i.apply(o)}:function(){return null};function Pe(o,i){var s=o.indexOf(i);return s>=0&&o.splice(s,1),s>=0}var st={};function ut(o){var i,s,u,l;if(arguments.length===1){if(f(o))return o.slice();if(this===st&&typeof o=="string")return[o];if(l=Ke(o)){for(s=[];u=l.next(),!u.done;)s.push(u.value);return s}if(o==null)return[o];if(i=o.length,typeof i=="number"){for(s=new Array(i);i--;)s[i]=o[i];return s}return[o]}for(i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return s}var Li=typeof Symbol<"u"?function(o){return o[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Km=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Us=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Fi=Km.concat(Us),qm={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ar(o,i){this.name=o,this.message=i}A(Ar).from(Error).extend({toString:function(){return this.name+": "+this.message}});function Vs(o,i){return o+". Errors: "+Object.keys(i).map(function(s){return i[s].toString()}).filter(function(s,u,l){return l.indexOf(s)===u}).join(`
`)}function Xn(o,i,s,u){this.failures=i,this.failedKeys=u,this.successCount=s,this.message=Vs(o,i)}A(Xn).from(Ar);function Cr(o,i){this.name="BulkError",this.failures=Object.keys(i).map(function(s){return i[s]}),this.failuresByPos=i,this.message=Vs(o,this.failures)}A(Cr).from(Ar);var ji=Fi.reduce(function(o,i){return o[i]=i+"Error",o},{}),Um=Ar,ee=Fi.reduce(function(o,i){var s=i+"Error";function u(l,m){this.name=s,l?typeof l=="string"?(this.message="".concat(l).concat(m?`
 `+m:""),this.inner=m||null):typeof l=="object"&&(this.message="".concat(l.name," ").concat(l.message),this.inner=l):(this.message=qm[i]||s,this.inner=null)}return A(u).from(Um),o[i]=u,o},{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var Ws=Us.reduce(function(o,i){return o[i+"Error"]=ee[i],o},{});function Vm(o,i){if(!o||o instanceof Ar||o instanceof TypeError||o instanceof SyntaxError||!o.name||!Ws[o.name])return o;var s=new Ws[o.name](i||o.message,o);return"stack"in o&&I(s,"stack",{get:function(){return this.inner.stack}}),s}var Gn=Fi.reduce(function(o,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(o[i+"Error"]=ee[i]),o},{});Gn.ModifyError=Xn,Gn.DexieError=Ar,Gn.BulkError=Cr;function ye(){}function sn(o){return o}function Wm(o,i){return o==null||o===sn?i:function(s){return i(o(s))}}function ur(o,i){return function(){o.apply(this,arguments),i.apply(this,arguments)}}function zm(o,i){return o===ye?i:function(){var s=o.apply(this,arguments);s!==void 0&&(arguments[0]=s);var u=this.onsuccess,l=this.onerror;this.onsuccess=null,this.onerror=null;var m=i.apply(this,arguments);return u&&(this.onsuccess=this.onsuccess?ur(u,this.onsuccess):u),l&&(this.onerror=this.onerror?ur(l,this.onerror):l),m!==void 0?m:s}}function Qm(o,i){return o===ye?i:function(){o.apply(this,arguments);var s=this.onsuccess,u=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),s&&(this.onsuccess=this.onsuccess?ur(s,this.onsuccess):s),u&&(this.onerror=this.onerror?ur(u,this.onerror):u)}}function Hm(o,i){return o===ye?i:function(s){var u=o.apply(this,arguments);p(s,u);var l=this.onsuccess,m=this.onerror;this.onsuccess=null,this.onerror=null;var h=i.apply(this,arguments);return l&&(this.onsuccess=this.onsuccess?ur(l,this.onsuccess):l),m&&(this.onerror=this.onerror?ur(m,this.onerror):m),u===void 0?h===void 0?void 0:h:p(u,h)}}function Ym(o,i){return o===ye?i:function(){return i.apply(this,arguments)===!1?!1:o.apply(this,arguments)}}function Ki(o,i){return o===ye?i:function(){var s=o.apply(this,arguments);if(s&&typeof s.then=="function"){for(var u=this,l=arguments.length,m=new Array(l);l--;)m[l]=arguments[l];return s.then(function(){return i.apply(u,m)})}return i.apply(this,arguments)}}var pt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function zs(o,i){pt=o}var un={},Qs=100,qi=typeof Promise>"u"?[]:(function(){var o=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[o,d(o),o];var i=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[i,d(i),o]})(),Hs=qi[0],Ys=qi[1],Xm=qi[2],Gm=Ys&&Ys.then,cr=Hs&&Hs.constructor,Ui=!!Xm;function Jm(){queueMicrotask(ep)}var cn=function(o,i){ln.push([o,i]),Jn&&(Jm(),Jn=!1)},Vi=!0,Jn=!0,lr=[],Zn=[],Wi=sn,Kt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ye,pgp:!1,env:{},finalize:ye},X=Kt,ln=[],fr=0,eo=[];function z(o){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=X;if(typeof o!="function"){if(o!==un)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Qi(this,this._value);return}this._state=null,this._value=null,++i.ref,Gs(this,o)}var zi={get:function(){var o=X,i=oo;function s(u,l){var m=this,h=!o.global&&(o!==X||i!==oo),v=h&&!Ut(),y=new z(function(g,O){Hi(m,new Xs(eu(u,o,h,v),eu(l,o,h,v),g,O,o))});return this._consoleTask&&(y._consoleTask=this._consoleTask),y}return s.prototype=un,s},set:function(o){I(this,"then",o&&o.prototype===un?zi:{get:function(){return o},set:zi.set})}};E(z.prototype,{then:zi,_then:function(o,i){Hi(this,new Xs(null,null,o,i,X))},catch:function(o){if(arguments.length===1)return this.then(null,o);var i=arguments[0],s=arguments[1];return typeof i=="function"?this.then(null,function(u){return u instanceof i?s(u):to(u)}):this.then(null,function(u){return u&&u.name===i?s(u):to(u)})},finally:function(o){return this.then(function(i){return z.resolve(o()).then(function(){return i})},function(i){return z.resolve(o()).then(function(){return to(i)})})},timeout:function(o,i){var s=this;return o<1/0?new z(function(u,l){var m=setTimeout(function(){return l(new ee.Timeout(i))},o);s.then(u,l).finally(clearTimeout.bind(null,m))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&I(z.prototype,Symbol.toStringTag,"Dexie.Promise"),Kt.env=Zs();function Xs(o,i,s,u,l){this.onFulfilled=typeof o=="function"?o:null,this.onRejected=typeof i=="function"?i:null,this.resolve=s,this.reject=u,this.psd=l}E(z,{all:function(){var o=ut.apply(null,arguments).map(io);return new z(function(i,s){o.length===0&&i([]);var u=o.length;o.forEach(function(l,m){return z.resolve(l).then(function(h){o[m]=h,--u||i(o)},s)})})},resolve:function(o){if(o instanceof z)return o;if(o&&typeof o.then=="function")return new z(function(s,u){o.then(s,u)});var i=new z(un,!0,o);return i},reject:to,race:function(){var o=ut.apply(null,arguments).map(io);return new z(function(i,s){o.map(function(u){return z.resolve(u).then(i,s)})})},PSD:{get:function(){return X},set:function(o){return X=o}},totalEchoes:{get:function(){return oo}},newPSD:qt,usePSD:mr,scheduler:{get:function(){return cn},set:function(o){cn=o}},rejectionMapper:{get:function(){return Wi},set:function(o){Wi=o}},follow:function(o,i){return new z(function(s,u){return qt(function(l,m){var h=X;h.unhandleds=[],h.onunhandled=m,h.finalize=ur(function(){var v=this;tp(function(){v.unhandleds.length===0?l():m(v.unhandleds[0])})},h.finalize),o()},i,s,u)})}}),cr&&(cr.allSettled&&I(z,"allSettled",function(){var o=ut.apply(null,arguments).map(io);return new z(function(i){o.length===0&&i([]);var s=o.length,u=new Array(s);o.forEach(function(l,m){return z.resolve(l).then(function(h){return u[m]={status:"fulfilled",value:h}},function(h){return u[m]={status:"rejected",reason:h}}).then(function(){return--s||i(u)})})})}),cr.any&&typeof AggregateError<"u"&&I(z,"any",function(){var o=ut.apply(null,arguments).map(io);return new z(function(i,s){o.length===0&&s(new AggregateError([]));var u=o.length,l=new Array(u);o.forEach(function(m,h){return z.resolve(m).then(function(v){return i(v)},function(v){l[h]=v,--u||s(new AggregateError(l))})})})}),cr.withResolvers&&(z.withResolvers=cr.withResolvers));function Gs(o,i){try{i(function(s){if(o._state===null){if(s===o)throw new TypeError("A promise cannot be resolved with itself.");var u=o._lib&&Pr();s&&typeof s.then=="function"?Gs(o,function(l,m){s instanceof z?s._then(l,m):s.then(l,m)}):(o._state=!0,o._value=s,Js(o)),u&&Tr()}},Qi.bind(null,o))}catch(s){Qi(o,s)}}function Qi(o,i){if(Zn.push(i),o._state===null){var s=o._lib&&Pr();i=Wi(i),o._state=!1,o._value=i,rp(o),Js(o),s&&Tr()}}function Js(o){var i=o._listeners;o._listeners=[];for(var s=0,u=i.length;s<u;++s)Hi(o,i[s]);var l=o._PSD;--l.ref||l.finalize(),fr===0&&(++fr,cn(function(){--fr===0&&Yi()},[]))}function Hi(o,i){if(o._state===null){o._listeners.push(i);return}var s=o._state?i.onFulfilled:i.onRejected;if(s===null)return(o._state?i.resolve:i.reject)(o._value);++i.psd.ref,++fr,cn(Zm,[s,o,i])}function Zm(o,i,s){try{var u,l=i._value;!i._state&&Zn.length&&(Zn=[]),u=pt&&i._consoleTask?i._consoleTask.run(function(){return o(l)}):o(l),!i._state&&Zn.indexOf(l)===-1&&np(i),s.resolve(u)}catch(m){s.reject(m)}finally{--fr===0&&Yi(),--s.psd.ref||s.psd.finalize()}}function ep(){mr(Kt,function(){Pr()&&Tr()})}function Pr(){var o=Vi;return Vi=!1,Jn=!1,o}function Tr(){var o,i,s;do for(;ln.length>0;)for(o=ln,ln=[],s=o.length,i=0;i<s;++i){var u=o[i];u[0].apply(null,u[1])}while(ln.length>0);Vi=!0,Jn=!0}function Yi(){var o=lr;lr=[],o.forEach(function(u){u._PSD.onunhandled.call(null,u._value,u)});for(var i=eo.slice(0),s=i.length;s;)i[--s]()}function tp(o){function i(){o(),eo.splice(eo.indexOf(i),1)}eo.push(i),++fr,cn(function(){--fr===0&&Yi()},[])}function rp(o){lr.some(function(i){return i._value===o._value})||lr.push(o)}function np(o){for(var i=lr.length;i;)if(lr[--i]._value===o._value){lr.splice(i,1);return}}function to(o){return new z(un,!1,o)}function Se(o,i){var s=X;return function(){var u=Pr(),l=X;try{return Vt(s,!0),o.apply(this,arguments)}catch(m){i&&i(m)}finally{Vt(l,!1),u&&Tr()}}}var Me={awaits:0,echoes:0,id:0},op=0,ro=[],no=0,oo=0,ip=0;function qt(o,i,s,u){var l=X,m=Object.create(l);m.parent=l,m.ref=0,m.global=!1,m.id=++ip,Kt.env,m.env=Ui?{Promise:z,PromiseProp:{value:z,configurable:!0,writable:!0},all:z.all,race:z.race,allSettled:z.allSettled,any:z.any,resolve:z.resolve,reject:z.reject}:{},i&&p(m,i),++l.ref,m.finalize=function(){--this.parent.ref||this.parent.finalize()};var h=mr(m,o,s,u);return m.ref===0&&m.finalize(),h}function Mr(){return Me.id||(Me.id=++op),++Me.awaits,Me.echoes+=Qs,Me.id}function Ut(){return Me.awaits?(--Me.awaits===0&&(Me.id=0),Me.echoes=Me.awaits*Qs,!0):!1}(""+Gm).indexOf("[native code]")===-1&&(Mr=Ut=ye);function io(o){return Me.echoes&&o&&o.constructor===cr?(Mr(),o.then(function(i){return Ut(),i},function(i){return Ut(),Re(i)})):o}function ap(o){++oo,(!Me.echoes||--Me.echoes===0)&&(Me.echoes=Me.awaits=Me.id=0),ro.push(X),Vt(o,!0)}function sp(){var o=ro[ro.length-1];ro.pop(),Vt(o,!1)}function Vt(o,i){var s=X;if((i?Me.echoes&&(!no++||o!==X):no&&(!--no||o!==X))&&queueMicrotask(i?ap.bind(null,o):sp),o!==X&&(X=o,s===Kt&&(Kt.env=Zs()),Ui)){var u=Kt.env.Promise,l=o.env;(s.global||o.global)&&(Object.defineProperty(a,"Promise",l.PromiseProp),u.all=l.all,u.race=l.race,u.resolve=l.resolve,u.reject=l.reject,l.allSettled&&(u.allSettled=l.allSettled),l.any&&(u.any=l.any))}}function Zs(){var o=a.Promise;return Ui?{Promise:o,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:o.all,race:o.race,allSettled:o.allSettled,any:o.any,resolve:o.resolve,reject:o.reject}:{}}function mr(o,i,s,u,l){var m=X;try{return Vt(o,!0),i(s,u,l)}finally{Vt(m,!1)}}function eu(o,i,s,u){return typeof o!="function"?o:function(){var l=X;s&&Mr(),Vt(i,!0);try{return o.apply(this,arguments)}finally{Vt(l,!1),u&&queueMicrotask(Ut)}}}function Xi(o){Promise===cr&&Me.echoes===0?no===0?o():enqueueNativeMicroTask(o):setTimeout(o,0)}var Re=z.reject;function Gi(o,i,s,u){if(!o.idbdb||!o._state.openComplete&&!X.letThrough&&!o._vip){if(o._state.openComplete)return Re(new ee.DatabaseClosed(o._state.dbOpenError));if(!o._state.isBeingOpened){if(!o._state.autoOpen)return Re(new ee.DatabaseClosed);o.open().catch(ye)}return o._state.dbReadyPromise.then(function(){return Gi(o,i,s,u)})}else{var l=o._createTransaction(i,s,o._dbSchema);try{l.create(),o._state.PR1398_maxLoop=3}catch(m){return m.name===ji.InvalidState&&o.isOpen()&&--o._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),o.close({disableAutoOpen:!1}),o.open().then(function(){return Gi(o,i,s,u)})):Re(m)}return l._promise(i,function(m,h){return qt(function(){return X.trans=l,u(m,h,l)})}).then(function(m){if(i==="readwrite")try{l.idbtrans.commit()}catch{}return i==="readonly"?m:l._completion.then(function(){return m})})}}var tu="4.0.10",pr="\uFFFF",Ji=-1/0,It="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ru="String expected.",kr=[],ao="__dbnames",Zi="readonly",ea="readwrite";function hr(o,i){return o?i?function(){return o.apply(this,arguments)&&i.apply(this,arguments)}:o:i}var nu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function so(o){return typeof o=="string"&&!/\./.test(o)?function(i){return i[o]===void 0&&o in i&&(i=rt(i),delete i[o]),i}:function(i){return i}}function ou(){throw ee.Type()}function fe(o,i){try{var s=iu(o),u=iu(i);if(s!==u)return s==="Array"?1:u==="Array"?-1:s==="binary"?1:u==="binary"?-1:s==="string"?1:u==="string"?-1:s==="Date"?1:u!=="Date"?NaN:-1;switch(s){case"number":case"Date":case"string":return o>i?1:o<i?-1:0;case"binary":return cp(au(o),au(i));case"Array":return up(o,i)}}catch{}return NaN}function up(o,i){for(var s=o.length,u=i.length,l=s<u?s:u,m=0;m<l;++m){var h=fe(o[m],i[m]);if(h!==0)return h}return s===u?0:s<u?-1:1}function cp(o,i){for(var s=o.length,u=i.length,l=s<u?s:u,m=0;m<l;++m)if(o[m]!==i[m])return o[m]<i[m]?-1:1;return s===u?0:s<u?-1:1}function iu(o){var i=typeof o;if(i!=="object")return i;if(ArrayBuffer.isView(o))return"binary";var s=jt(o);return s==="ArrayBuffer"?"binary":s}function au(o){return o instanceof Uint8Array?o:ArrayBuffer.isView(o)?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):new Uint8Array(o)}var su=(function(){function o(){}return o.prototype._trans=function(i,s,u){var l=this._tx||X.trans,m=this.name,h=pt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(i==="readonly"?"read":"write"," ").concat(this.name));function v(O,w,P){if(!P.schema[m])throw new ee.NotFound("Table "+m+" not part of transaction");return s(P.idbtrans,P)}var y=Pr();try{var g=l&&l.db._novip===this.db._novip?l===X.trans?l._promise(i,v,u):qt(function(){return l._promise(i,v,u)},{trans:l,transless:X.transless||X}):Gi(this.db,i,[this.name],v);return h&&(g._consoleTask=h,g=g.catch(function(O){return console.trace(O),Re(O)})),g}finally{y&&Tr()}},o.prototype.get=function(i,s){var u=this;return i&&i.constructor===Object?this.where(i).first(s):i==null?Re(new ee.Type("Invalid argument to Table.get()")):this._trans("readonly",function(l){return u.core.get({trans:l,key:i}).then(function(m){return u.hook.reading.fire(m)})}).then(s)},o.prototype.where=function(i){if(typeof i=="string")return new this.db.WhereClause(this,i);if(f(i))return new this.db.WhereClause(this,"[".concat(i.join("+"),"]"));var s=c(i);if(s.length===1)return this.where(s[0]).equals(i[s[0]]);var u=this.schema.indexes.concat(this.schema.primKey).filter(function(O){if(O.compound&&s.every(function(P){return O.keyPath.indexOf(P)>=0})){for(var w=0;w<s.length;++w)if(s.indexOf(O.keyPath[w])===-1)return!1;return!0}return!1}).sort(function(O,w){return O.keyPath.length-w.keyPath.length})[0];if(u&&this.db._maxKey!==pr){var l=u.keyPath.slice(0,s.length);return this.where(l).equals(l.map(function(O){return i[O]}))}!u&&pt&&console.warn("The query ".concat(JSON.stringify(i)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(s.join("+"),"]"));var m=this.schema.idxByName;function h(O,w){return fe(O,w)===0}var v=s.reduce(function(O,w){var P=O[0],K=O[1],b=m[w],D=i[w];return[P||b,P||!b?hr(K,b&&b.multi?function(C){var $=ne(C,w);return f($)&&$.some(function(k){return h(D,k)})}:function(C){return h(D,ne(C,w))}):K]},[null,null]),y=v[0],g=v[1];return y?this.where(y.name).equals(i[y.keyPath]).filter(g):u?this.filter(g):this.where(s).equals("")},o.prototype.filter=function(i){return this.toCollection().and(i)},o.prototype.count=function(i){return this.toCollection().count(i)},o.prototype.offset=function(i){return this.toCollection().offset(i)},o.prototype.limit=function(i){return this.toCollection().limit(i)},o.prototype.each=function(i){return this.toCollection().each(i)},o.prototype.toArray=function(i){return this.toCollection().toArray(i)},o.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},o.prototype.orderBy=function(i){return new this.db.Collection(new this.db.WhereClause(this,f(i)?"[".concat(i.join("+"),"]"):i))},o.prototype.reverse=function(){return this.toCollection().reverse()},o.prototype.mapToClass=function(i){var s=this,u=s.db,l=s.name;this.schema.mappedClass=i,i.prototype instanceof ou&&(i=(function(y){t(g,y);function g(){return y!==null&&y.apply(this,arguments)||this}return Object.defineProperty(g.prototype,"db",{get:function(){return u},enumerable:!1,configurable:!0}),g.prototype.table=function(){return l},g})(i));for(var m=new Set,h=i.prototype;h;h=d(h))Object.getOwnPropertyNames(h).forEach(function(y){return m.add(y)});var v=function(y){if(!y)return y;var g=Object.create(i.prototype);for(var O in y)if(!m.has(O))try{g[O]=y[O]}catch{}return g};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),i},o.prototype.defineClass=function(){function i(s){p(this,s)}return this.mapToClass(i)},o.prototype.add=function(i,s){var u=this,l=this.schema.primKey,m=l.auto,h=l.keyPath,v=i;return h&&m&&(v=so(h)(i)),this._trans("readwrite",function(y){return u.core.mutate({trans:y,type:"add",keys:s!=null?[s]:null,values:[v]})}).then(function(y){return y.numFailures?z.reject(y.failures[0]):y.lastResult}).then(function(y){if(h)try{le(i,h,y)}catch{}return y})},o.prototype.update=function(i,s){if(typeof i=="object"&&!f(i)){var u=ne(i,this.schema.primKey.keyPath);return u===void 0?Re(new ee.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(u).modify(s)}else return this.where(":id").equals(i).modify(s)},o.prototype.put=function(i,s){var u=this,l=this.schema.primKey,m=l.auto,h=l.keyPath,v=i;return h&&m&&(v=so(h)(i)),this._trans("readwrite",function(y){return u.core.mutate({trans:y,type:"put",values:[v],keys:s!=null?[s]:null})}).then(function(y){return y.numFailures?z.reject(y.failures[0]):y.lastResult}).then(function(y){if(h)try{le(i,h,y)}catch{}return y})},o.prototype.delete=function(i){var s=this;return this._trans("readwrite",function(u){return s.core.mutate({trans:u,type:"delete",keys:[i]})}).then(function(u){return u.numFailures?z.reject(u.failures[0]):void 0})},o.prototype.clear=function(){var i=this;return this._trans("readwrite",function(s){return i.core.mutate({trans:s,type:"deleteRange",range:nu})}).then(function(s){return s.numFailures?z.reject(s.failures[0]):void 0})},o.prototype.bulkGet=function(i){var s=this;return this._trans("readonly",function(u){return s.core.getMany({keys:i,trans:u}).then(function(l){return l.map(function(m){return s.hook.reading.fire(m)})})})},o.prototype.bulkAdd=function(i,s,u){var l=this,m=Array.isArray(s)?s:void 0;u=u||(m?void 0:s);var h=u?u.allKeys:void 0;return this._trans("readwrite",function(v){var y=l.schema.primKey,g=y.auto,O=y.keyPath;if(O&&m)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(m&&m.length!==i.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var w=i.length,P=O&&g?i.map(so(O)):i;return l.core.mutate({trans:v,type:"add",keys:m,values:P,wantResults:h}).then(function(K){var b=K.numFailures,D=K.results,C=K.lastResult,$=K.failures,k=h?D:C;if(b===0)return k;throw new Cr("".concat(l.name,".bulkAdd(): ").concat(b," of ").concat(w," operations failed"),$)})})},o.prototype.bulkPut=function(i,s,u){var l=this,m=Array.isArray(s)?s:void 0;u=u||(m?void 0:s);var h=u?u.allKeys:void 0;return this._trans("readwrite",function(v){var y=l.schema.primKey,g=y.auto,O=y.keyPath;if(O&&m)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(m&&m.length!==i.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var w=i.length,P=O&&g?i.map(so(O)):i;return l.core.mutate({trans:v,type:"put",keys:m,values:P,wantResults:h}).then(function(K){var b=K.numFailures,D=K.results,C=K.lastResult,$=K.failures,k=h?D:C;if(b===0)return k;throw new Cr("".concat(l.name,".bulkPut(): ").concat(b," of ").concat(w," operations failed"),$)})})},o.prototype.bulkUpdate=function(i){var s=this,u=this.core,l=i.map(function(v){return v.key}),m=i.map(function(v){return v.changes}),h=[];return this._trans("readwrite",function(v){return u.getMany({trans:v,keys:l,cache:"clone"}).then(function(y){var g=[],O=[];i.forEach(function(P,K){var b=P.key,D=P.changes,C=y[K];if(C){for(var $=0,k=Object.keys(D);$<k.length;$++){var N=k[$],L=D[N];if(N===s.schema.primKey.keyPath){if(fe(L,b)!==0)throw new ee.Constraint("Cannot update primary key in bulkUpdate()")}else le(C,N,L)}h.push(K),g.push(b),O.push(C)}});var w=g.length;return u.mutate({trans:v,type:"put",keys:g,values:O,updates:{keys:l,changeSpecs:m}}).then(function(P){var K=P.numFailures,b=P.failures;if(K===0)return w;for(var D=0,C=Object.keys(b);D<C.length;D++){var $=C[D],k=h[Number($)];if(k!=null){var N=b[$];delete b[$],b[k]=N}}throw new Cr("".concat(s.name,".bulkUpdate(): ").concat(K," of ").concat(w," operations failed"),b)})})})},o.prototype.bulkDelete=function(i){var s=this,u=i.length;return this._trans("readwrite",function(l){return s.core.mutate({trans:l,type:"delete",keys:i})}).then(function(l){var m=l.numFailures,h=l.lastResult,v=l.failures;if(m===0)return h;throw new Cr("".concat(s.name,".bulkDelete(): ").concat(m," of ").concat(u," operations failed"),v)})},o})();function fn(o){var i={},s=function(v,y){if(y){for(var g=arguments.length,O=new Array(g-1);--g;)O[g-1]=arguments[g];return i[v].subscribe.apply(null,O),o}else if(typeof v=="string")return i[v]};s.addEventType=m;for(var u=1,l=arguments.length;u<l;++u)m(arguments[u]);return s;function m(v,y,g){if(typeof v=="object")return h(v);y||(y=Ym),g||(g=ye);var O={subscribers:[],fire:g,subscribe:function(w){O.subscribers.indexOf(w)===-1&&(O.subscribers.push(w),O.fire=y(O.fire,w))},unsubscribe:function(w){O.subscribers=O.subscribers.filter(function(P){return P!==w}),O.fire=O.subscribers.reduce(y,g)}};return i[v]=s[v]=O,O}function h(v){c(v).forEach(function(y){var g=v[y];if(f(g))m(y,v[y][0],v[y][1]);else if(g==="asap")var O=m(y,sn,function(){for(var P=arguments.length,K=new Array(P);P--;)K[P]=arguments[P];O.subscribers.forEach(function(b){me(function(){b.apply(null,K)})})});else throw new ee.InvalidArgument("Invalid event config")})}}function mn(o,i){return A(i).from({prototype:o}),i}function lp(o){return mn(su.prototype,function(s,u,l){this.db=o,this._tx=l,this.name=s,this.schema=u,this.hook=o._allTables[s]?o._allTables[s].hook:fn(null,{creating:[zm,ye],reading:[Wm,sn],updating:[Hm,ye],deleting:[Qm,ye]})})}function Nr(o,i){return!(o.filter||o.algorithm||o.or)&&(i?o.justLimit:!o.replayFilter)}function ta(o,i){o.filter=hr(o.filter,i)}function ra(o,i,s){var u=o.replayFilter;o.replayFilter=u?function(){return hr(u(),i())}:i,o.justLimit=s&&!u}function fp(o,i){o.isMatch=hr(o.isMatch,i)}function uo(o,i){if(o.isPrimKey)return i.primaryKey;var s=i.getIndexByKeyPath(o.index);if(!s)throw new ee.Schema("KeyPath "+o.index+" on object store "+i.name+" is not indexed");return s}function uu(o,i,s){var u=uo(o,i.schema);return i.openCursor({trans:s,values:!o.keysOnly,reverse:o.dir==="prev",unique:!!o.unique,query:{index:u,range:o.range}})}function co(o,i,s,u){var l=o.replayFilter?hr(o.filter,o.replayFilter()):o.filter;if(o.or){var m={},h=function(v,y,g){if(!l||l(y,g,function(P){return y.stop(P)},function(P){return y.fail(P)})){var O=y.primaryKey,w=""+O;w==="[object ArrayBuffer]"&&(w=""+new Uint8Array(O)),x(m,w)||(m[w]=!0,i(v,y,g))}};return Promise.all([o.or._iterate(h,s),cu(uu(o,u,s),o.algorithm,h,!o.keysOnly&&o.valueMapper)])}else return cu(uu(o,u,s),hr(o.algorithm,l),i,!o.keysOnly&&o.valueMapper)}function cu(o,i,s,u){var l=u?function(h,v,y){return s(u(h),v,y)}:s,m=Se(l);return o.then(function(h){if(h)return h.start(function(){var v=function(){return h.continue()};(!i||i(h,function(y){return v=y},function(y){h.stop(y),v=ye},function(y){h.fail(y),v=ye}))&&m(h.value,h,function(y){return v=y}),v()})})}var mp=Symbol(),pn=(function(){function o(i){Object.assign(this,i)}return o.prototype.execute=function(i){var s;if(this.add!==void 0){var u=this.add;if(f(u))return n(n([],f(i)?i:[],!0),u,!0).sort();if(typeof u=="number")return(Number(i)||0)+u;if(typeof u=="bigint")try{return BigInt(i)+u}catch{return BigInt(0)+u}throw new TypeError("Invalid term ".concat(u))}if(this.remove!==void 0){var l=this.remove;if(f(l))return f(i)?i.filter(function(h){return!l.includes(h)}).sort():[];if(typeof l=="number")return Number(i)-l;if(typeof l=="bigint")try{return BigInt(i)-l}catch{return BigInt(0)-l}throw new TypeError("Invalid subtrahend ".concat(l))}var m=(s=this.replacePrefix)===null||s===void 0?void 0:s[0];return m&&typeof i=="string"&&i.startsWith(m)?this.replacePrefix[1]+i.substring(m.length):i},o})(),pp=(function(){function o(){}return o.prototype._read=function(i,s){var u=this._ctx;return u.error?u.table._trans(null,Re.bind(null,u.error)):u.table._trans("readonly",i).then(s)},o.prototype._write=function(i){var s=this._ctx;return s.error?s.table._trans(null,Re.bind(null,s.error)):s.table._trans("readwrite",i,"locked")},o.prototype._addAlgorithm=function(i){var s=this._ctx;s.algorithm=hr(s.algorithm,i)},o.prototype._iterate=function(i,s){return co(this._ctx,i,s,this._ctx.table.core)},o.prototype.clone=function(i){var s=Object.create(this.constructor.prototype),u=Object.create(this._ctx);return i&&p(u,i),s._ctx=u,s},o.prototype.raw=function(){return this._ctx.valueMapper=null,this},o.prototype.each=function(i){var s=this._ctx;return this._read(function(u){return co(s,i,u,s.table.core)})},o.prototype.count=function(i){var s=this;return this._read(function(u){var l=s._ctx,m=l.table.core;if(Nr(l,!0))return m.count({trans:u,query:{index:uo(l,m.schema),range:l.range}}).then(function(v){return Math.min(v,l.limit)});var h=0;return co(l,function(){return++h,!1},u,m).then(function(){return h})}).then(i)},o.prototype.sortBy=function(i,s){var u=i.split(".").reverse(),l=u[0],m=u.length-1;function h(g,O){return O?h(g[u[O]],O-1):g[l]}var v=this._ctx.dir==="next"?1:-1;function y(g,O){var w=h(g,m),P=h(O,m);return fe(w,P)*v}return this.toArray(function(g){return g.sort(y)}).then(s)},o.prototype.toArray=function(i){var s=this;return this._read(function(u){var l=s._ctx;if(l.dir==="next"&&Nr(l,!0)&&l.limit>0){var m=l.valueMapper,h=uo(l,l.table.core.schema);return l.table.core.query({trans:u,limit:l.limit,values:!0,query:{index:h,range:l.range}}).then(function(y){var g=y.result;return m?g.map(m):g})}else{var v=[];return co(l,function(y){return v.push(y)},u,l.table.core).then(function(){return v})}},i)},o.prototype.offset=function(i){var s=this._ctx;return i<=0?this:(s.offset+=i,Nr(s)?ra(s,function(){var u=i;return function(l,m){return u===0?!0:u===1?(--u,!1):(m(function(){l.advance(u),u=0}),!1)}}):ra(s,function(){var u=i;return function(){return--u<0}}),this)},o.prototype.limit=function(i){return this._ctx.limit=Math.min(this._ctx.limit,i),ra(this._ctx,function(){var s=i;return function(u,l,m){return--s<=0&&l(m),s>=0}},!0),this},o.prototype.until=function(i,s){return ta(this._ctx,function(u,l,m){return i(u.value)?(l(m),s):!0}),this},o.prototype.first=function(i){return this.limit(1).toArray(function(s){return s[0]}).then(i)},o.prototype.last=function(i){return this.reverse().first(i)},o.prototype.filter=function(i){return ta(this._ctx,function(s){return i(s.value)}),fp(this._ctx,i),this},o.prototype.and=function(i){return this.filter(i)},o.prototype.or=function(i){return new this.db.WhereClause(this._ctx.table,i,this)},o.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},o.prototype.desc=function(){return this.reverse()},o.prototype.eachKey=function(i){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(u,l){i(l.key,l)})},o.prototype.eachUniqueKey=function(i){return this._ctx.unique="unique",this.eachKey(i)},o.prototype.eachPrimaryKey=function(i){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(u,l){i(l.primaryKey,l)})},o.prototype.keys=function(i){var s=this._ctx;s.keysOnly=!s.isMatch;var u=[];return this.each(function(l,m){u.push(m.key)}).then(function(){return u}).then(i)},o.prototype.primaryKeys=function(i){var s=this._ctx;if(s.dir==="next"&&Nr(s,!0)&&s.limit>0)return this._read(function(l){var m=uo(s,s.table.core.schema);return s.table.core.query({trans:l,values:!1,limit:s.limit,query:{index:m,range:s.range}})}).then(function(l){var m=l.result;return m}).then(i);s.keysOnly=!s.isMatch;var u=[];return this.each(function(l,m){u.push(m.primaryKey)}).then(function(){return u}).then(i)},o.prototype.uniqueKeys=function(i){return this._ctx.unique="unique",this.keys(i)},o.prototype.firstKey=function(i){return this.limit(1).keys(function(s){return s[0]}).then(i)},o.prototype.lastKey=function(i){return this.reverse().firstKey(i)},o.prototype.distinct=function(){var i=this._ctx,s=i.index&&i.table.schema.idxByName[i.index];if(!s||!s.multi)return this;var u={};return ta(this._ctx,function(l){var m=l.primaryKey.toString(),h=x(u,m);return u[m]=!0,!h}),this},o.prototype.modify=function(i){var s=this,u=this._ctx;return this._write(function(l){var m;if(typeof i=="function")m=i;else{var h=c(i),v=h.length;m=function(k){for(var N=!1,L=0;L<v;++L){var T=h[L],q=i[T],Q=ne(k,T);q instanceof pn?(le(k,T,q.execute(Q)),N=!0):Q!==q&&(le(k,T,q),N=!0)}return N}}var y=u.table.core,g=y.schema.primaryKey,O=g.outbound,w=g.extractKey,P=200,K=s.db._options.modifyChunkSize;K&&(typeof K=="object"?P=K[y.name]||K["*"]||200:P=K);var b=[],D=0,C=[],$=function(k,N){var L=N.failures,T=N.numFailures;D+=k-T;for(var q=0,Q=c(L);q<Q.length;q++){var W=Q[q];b.push(L[W])}};return s.clone().primaryKeys().then(function(k){var N=Nr(u)&&u.limit===1/0&&(typeof i!="function"||i===na)&&{index:u.index,range:u.range},L=function(T){var q=Math.min(P,k.length-T);return y.getMany({trans:l,keys:k.slice(T,T+q),cache:"immutable"}).then(function(Q){for(var W=[],te=[],se=O?[]:null,Y=[],ae=0;ae<q;++ae){var oe=Q[ae],pe={value:rt(oe),primKey:k[T+ae]};m.call(pe,pe.value,pe)!==!1&&(pe.value==null?Y.push(k[T+ae]):!O&&fe(w(oe),w(pe.value))!==0?(Y.push(k[T+ae]),W.push(pe.value)):(te.push(pe.value),O&&se.push(k[T+ae])))}return Promise.resolve(W.length>0&&y.mutate({trans:l,type:"add",values:W}).then(function(J){for(var Ie in J.failures)Y.splice(parseInt(Ie),1);$(W.length,J)})).then(function(){return(te.length>0||N&&typeof i=="object")&&y.mutate({trans:l,type:"put",keys:se,values:te,criteria:N,changeSpec:typeof i!="function"&&i,isAdditionalChunk:T>0}).then(function(J){return $(te.length,J)})}).then(function(){return(Y.length>0||N&&i===na)&&y.mutate({trans:l,type:"delete",keys:Y,criteria:N,isAdditionalChunk:T>0}).then(function(J){return $(Y.length,J)})}).then(function(){return k.length>T+q&&L(T+P)})})};return L(0).then(function(){if(b.length>0)throw new Xn("Error modifying one or more objects",b,D,C);return k.length})})})},o.prototype.delete=function(){var i=this._ctx,s=i.range;return Nr(i)&&(i.isPrimKey||s.type===3)?this._write(function(u){var l=i.table.core.schema.primaryKey,m=s;return i.table.core.count({trans:u,query:{index:l,range:m}}).then(function(h){return i.table.core.mutate({trans:u,type:"deleteRange",range:m}).then(function(v){var y=v.failures;v.lastResult,v.results;var g=v.numFailures;if(g)throw new Xn("Could not delete some values",Object.keys(y).map(function(O){return y[O]}),h-g);return h-g})})}):this.modify(na)},o})(),na=function(o,i){return i.value=null};function hp(o){return mn(pp.prototype,function(s,u){this.db=o;var l=nu,m=null;if(u)try{l=u()}catch(g){m=g}var h=s._ctx,v=h.table,y=v.hook.reading.fire;this._ctx={table:v,index:h.index,isPrimKey:!h.index||v.schema.primKey.keyPath&&h.index===v.schema.primKey.name,range:l,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:m,or:h.or,valueMapper:y!==sn?y:null}})}function dp(o,i){return o<i?-1:o===i?0:1}function vp(o,i){return o>i?-1:o===i?0:1}function Xe(o,i,s){var u=o instanceof fu?new o.Collection(o):o;return u._ctx.error=s?new s(i):new TypeError(i),u}function $r(o){return new o.Collection(o,function(){return lu("")}).limit(0)}function yp(o){return o==="next"?function(i){return i.toUpperCase()}:function(i){return i.toLowerCase()}}function gp(o){return o==="next"?function(i){return i.toLowerCase()}:function(i){return i.toUpperCase()}}function xp(o,i,s,u,l,m){for(var h=Math.min(o.length,u.length),v=-1,y=0;y<h;++y){var g=i[y];if(g!==u[y])return l(o[y],s[y])<0?o.substr(0,y)+s[y]+s.substr(y+1):l(o[y],u[y])<0?o.substr(0,y)+u[y]+s.substr(y+1):v>=0?o.substr(0,v)+i[v]+s.substr(v+1):null;l(o[y],g)<0&&(v=y)}return h<u.length&&m==="next"?o+s.substr(o.length):h<o.length&&m==="prev"?o.substr(0,s.length):v<0?null:o.substr(0,v)+u[v]+s.substr(v+1)}function lo(o,i,s,u){var l,m,h,v,y,g,O,w=s.length;if(!s.every(function(D){return typeof D=="string"}))return Xe(o,ru);function P(D){l=yp(D),m=gp(D),h=D==="next"?dp:vp;var C=s.map(function($){return{lower:m($),upper:l($)}}).sort(function($,k){return h($.lower,k.lower)});v=C.map(function($){return $.upper}),y=C.map(function($){return $.lower}),g=D,O=D==="next"?"":u}P("next");var K=new o.Collection(o,function(){return Wt(v[0],y[w-1]+u)});K._ondirectionchange=function(D){P(D)};var b=0;return K._addAlgorithm(function(D,C,$){var k=D.key;if(typeof k!="string")return!1;var N=m(k);if(i(N,y,b))return!0;for(var L=null,T=b;T<w;++T){var q=xp(k,N,v[T],y[T],h,g);q===null&&L===null?b=T+1:(L===null||h(L,q)>0)&&(L=q)}return C(L!==null?function(){D.continue(L+O)}:$),!1}),K}function Wt(o,i,s,u){return{type:2,lower:o,upper:i,lowerOpen:s,upperOpen:u}}function lu(o){return{type:1,lower:o,upper:o}}var fu=(function(){function o(){}return Object.defineProperty(o.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),o.prototype.between=function(i,s,u,l){u=u!==!1,l=l===!0;try{return this._cmp(i,s)>0||this._cmp(i,s)===0&&(u||l)&&!(u&&l)?$r(this):new this.Collection(this,function(){return Wt(i,s,!u,!l)})}catch{return Xe(this,It)}},o.prototype.equals=function(i){return i==null?Xe(this,It):new this.Collection(this,function(){return lu(i)})},o.prototype.above=function(i){return i==null?Xe(this,It):new this.Collection(this,function(){return Wt(i,void 0,!0)})},o.prototype.aboveOrEqual=function(i){return i==null?Xe(this,It):new this.Collection(this,function(){return Wt(i,void 0,!1)})},o.prototype.below=function(i){return i==null?Xe(this,It):new this.Collection(this,function(){return Wt(void 0,i,!1,!0)})},o.prototype.belowOrEqual=function(i){return i==null?Xe(this,It):new this.Collection(this,function(){return Wt(void 0,i)})},o.prototype.startsWith=function(i){return typeof i!="string"?Xe(this,ru):this.between(i,i+pr,!0,!0)},o.prototype.startsWithIgnoreCase=function(i){return i===""?this.startsWith(i):lo(this,function(s,u){return s.indexOf(u[0])===0},[i],pr)},o.prototype.equalsIgnoreCase=function(i){return lo(this,function(s,u){return s===u[0]},[i],"")},o.prototype.anyOfIgnoreCase=function(){var i=ut.apply(st,arguments);return i.length===0?$r(this):lo(this,function(s,u){return u.indexOf(s)!==-1},i,"")},o.prototype.startsWithAnyOfIgnoreCase=function(){var i=ut.apply(st,arguments);return i.length===0?$r(this):lo(this,function(s,u){return u.some(function(l){return s.indexOf(l)===0})},i,pr)},o.prototype.anyOf=function(){var i=this,s=ut.apply(st,arguments),u=this._cmp;try{s.sort(u)}catch{return Xe(this,It)}if(s.length===0)return $r(this);var l=new this.Collection(this,function(){return Wt(s[0],s[s.length-1])});l._ondirectionchange=function(h){u=h==="next"?i._ascending:i._descending,s.sort(u)};var m=0;return l._addAlgorithm(function(h,v,y){for(var g=h.key;u(g,s[m])>0;)if(++m,m===s.length)return v(y),!1;return u(g,s[m])===0?!0:(v(function(){h.continue(s[m])}),!1)}),l},o.prototype.notEqual=function(i){return this.inAnyRange([[Ji,i],[i,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},o.prototype.noneOf=function(){var i=ut.apply(st,arguments);if(i.length===0)return new this.Collection(this);try{i.sort(this._ascending)}catch{return Xe(this,It)}var s=i.reduce(function(u,l){return u?u.concat([[u[u.length-1][1],l]]):[[Ji,l]]},null);return s.push([i[i.length-1],this.db._maxKey]),this.inAnyRange(s,{includeLowers:!1,includeUppers:!1})},o.prototype.inAnyRange=function(i,s){var u=this,l=this._cmp,m=this._ascending,h=this._descending,v=this._min,y=this._max;if(i.length===0)return $r(this);if(!i.every(function(T){return T[0]!==void 0&&T[1]!==void 0&&m(T[0],T[1])<=0}))return Xe(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);var g=!s||s.includeLowers!==!1,O=s&&s.includeUppers===!0;function w(T,q){for(var Q=0,W=T.length;Q<W;++Q){var te=T[Q];if(l(q[0],te[1])<0&&l(q[1],te[0])>0){te[0]=v(te[0],q[0]),te[1]=y(te[1],q[1]);break}}return Q===W&&T.push(q),T}var P=m;function K(T,q){return P(T[0],q[0])}var b;try{b=i.reduce(w,[]),b.sort(K)}catch{return Xe(this,It)}var D=0,C=O?function(T){return m(T,b[D][1])>0}:function(T){return m(T,b[D][1])>=0},$=g?function(T){return h(T,b[D][0])>0}:function(T){return h(T,b[D][0])>=0};function k(T){return!C(T)&&!$(T)}var N=C,L=new this.Collection(this,function(){return Wt(b[0][0],b[b.length-1][1],!g,!O)});return L._ondirectionchange=function(T){T==="next"?(N=C,P=m):(N=$,P=h),b.sort(K)},L._addAlgorithm(function(T,q,Q){for(var W=T.key;N(W);)if(++D,D===b.length)return q(Q),!1;return k(W)?!0:(u._cmp(W,b[D][1])===0||u._cmp(W,b[D][0])===0||q(function(){P===m?T.continue(b[D][0]):T.continue(b[D][1])}),!1)}),L},o.prototype.startsWithAnyOf=function(){var i=ut.apply(st,arguments);return i.every(function(s){return typeof s=="string"})?i.length===0?$r(this):this.inAnyRange(i.map(function(s){return[s,s+pr]})):Xe(this,"startsWithAnyOf() only works with strings")},o})();function wp(o){return mn(fu.prototype,function(s,u,l){if(this.db=o,this._ctx={table:s,index:u===":id"?null:u,or:l},this._cmp=this._ascending=fe,this._descending=function(m,h){return fe(h,m)},this._max=function(m,h){return fe(m,h)>0?m:h},this._min=function(m,h){return fe(m,h)<0?m:h},this._IDBKeyRange=o._deps.IDBKeyRange,!this._IDBKeyRange)throw new ee.MissingAPI})}function ht(o){return Se(function(i){return hn(i),o(i.target.error),!1})}function hn(o){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault()}var dn="storagemutated",oa="x-storagemutated-1",zt=fn(null,dn),bp=(function(){function o(){}return o.prototype._lock=function(){return xe(!X.global),++this._reculock,this._reculock===1&&!X.global&&(X.lockOwnerFor=this),this},o.prototype._unlock=function(){if(xe(!X.global),--this._reculock===0)for(X.global||(X.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var i=this._blockedFuncs.shift();try{mr(i[1],i[0])}catch{}}return this},o.prototype._locked=function(){return this._reculock&&X.lockOwnerFor!==this},o.prototype.create=function(i){var s=this;if(!this.mode)return this;var u=this.db.idbdb,l=this.db._state.dbOpenError;if(xe(!this.idbtrans),!i&&!u)switch(l&&l.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(l);case"MissingAPIError":throw new ee.MissingAPI(l.message,l);default:throw new ee.OpenFailed(l)}if(!this.active)throw new ee.TransactionInactive;return xe(this._completion._state===null),i=this.idbtrans=i||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):u.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),i.onerror=Se(function(m){hn(m),s._reject(i.error)}),i.onabort=Se(function(m){hn(m),s.active&&s._reject(new ee.Abort(i.error)),s.active=!1,s.on("abort").fire(m)}),i.oncomplete=Se(function(){s.active=!1,s._resolve(),"mutatedParts"in i&&zt.storagemutated.fire(i.mutatedParts)}),this},o.prototype._promise=function(i,s,u){var l=this;if(i==="readwrite"&&this.mode!=="readwrite")return Re(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return Re(new ee.TransactionInactive);if(this._locked())return new z(function(h,v){l._blockedFuncs.push([function(){l._promise(i,s,u).then(h,v)},X])});if(u)return qt(function(){var h=new z(function(v,y){l._lock();var g=s(v,y,l);g&&g.then&&g.then(v,y)});return h.finally(function(){return l._unlock()}),h._lib=!0,h});var m=new z(function(h,v){var y=s(h,v,l);y&&y.then&&y.then(h,v)});return m._lib=!0,m},o.prototype._root=function(){return this.parent?this.parent._root():this},o.prototype.waitFor=function(i){var s=this._root(),u=z.resolve(i);if(s._waitingFor)s._waitingFor=s._waitingFor.then(function(){return u});else{s._waitingFor=u,s._waitingQueue=[];var l=s.idbtrans.objectStore(s.storeNames[0]);(function h(){for(++s._spinCount;s._waitingQueue.length;)s._waitingQueue.shift()();s._waitingFor&&(l.get(-1/0).onsuccess=h)})()}var m=s._waitingFor;return new z(function(h,v){u.then(function(y){return s._waitingQueue.push(Se(h.bind(null,y)))},function(y){return s._waitingQueue.push(Se(v.bind(null,y)))}).finally(function(){s._waitingFor===m&&(s._waitingFor=null)})})},o.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))},o.prototype.table=function(i){var s=this._memoizedTables||(this._memoizedTables={});if(x(s,i))return s[i];var u=this.schema[i];if(!u)throw new ee.NotFound("Table "+i+" not part of transaction");var l=new this.db.Table(i,u,this);return l.core=this.db.core.table(i),s[i]=l,l},o})();function _p(o){return mn(bp.prototype,function(s,u,l,m,h){var v=this;this.db=o,this.mode=s,this.storeNames=u,this.schema=l,this.chromeTransactionDurability=m,this.idbtrans=null,this.on=fn(this,"complete","error","abort"),this.parent=h||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new z(function(y,g){v._resolve=y,v._reject=g}),this._completion.then(function(){v.active=!1,v.on.complete.fire()},function(y){var g=v.active;return v.active=!1,v.on.error.fire(y),v.parent?v.parent._reject(y):g&&v.idbtrans&&v.idbtrans.abort(),Re(y)})})}function ia(o,i,s,u,l,m,h){return{name:o,keyPath:i,unique:s,multi:u,auto:l,compound:m,src:(s&&!h?"&":"")+(u?"*":"")+(l?"++":"")+mu(i)}}function mu(o){return typeof o=="string"?o:o?"["+[].join.call(o,"+")+"]":""}function aa(o,i,s){return{name:o,primKey:i,indexes:s,mappedClass:null,idxByName:be(s,function(u){return[u.name,u]})}}function Ep(o){return o.length===1?o[0]:o}var vn=function(o){try{return o.only([[]]),vn=function(){return[[]]},[[]]}catch{return vn=function(){return pr},pr}};function sa(o){return o==null?function(){}:typeof o=="string"?Sp(o):function(i){return ne(i,o)}}function Sp(o){var i=o.split(".");return i.length===1?function(s){return s[o]}:function(s){return ne(s,o)}}function pu(o){return[].slice.call(o)}var Op=0;function yn(o){return o==null?":id":typeof o=="string"?o:"[".concat(o.join("+"),"]")}function Dp(o,i,s){function u(w,P){var K=pu(w.objectStoreNames);return{schema:{name:w.name,tables:K.map(function(b){return P.objectStore(b)}).map(function(b){var D=b.keyPath,C=b.autoIncrement,$=f(D),k=D==null,N={},L={name:b.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:k,compound:$,keyPath:D,autoIncrement:C,unique:!0,extractKey:sa(D)},indexes:pu(b.indexNames).map(function(T){return b.index(T)}).map(function(T){var q=T.name,Q=T.unique,W=T.multiEntry,te=T.keyPath,se=f(te),Y={name:q,compound:se,keyPath:te,unique:Q,multiEntry:W,extractKey:sa(te)};return N[yn(te)]=Y,Y}),getIndexByKeyPath:function(T){return N[yn(T)]}};return N[":id"]=L.primaryKey,D!=null&&(N[yn(D)]=L.primaryKey),L})},hasGetAll:K.length>0&&"getAll"in P.objectStore(K[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function l(w){if(w.type===3)return null;if(w.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var P=w.lower,K=w.upper,b=w.lowerOpen,D=w.upperOpen,C=P===void 0?K===void 0?null:i.upperBound(K,!!D):K===void 0?i.lowerBound(P,!!b):i.bound(P,K,!!b,!!D);return C}function m(w){var P=w.name;function K(C){var $=C.trans,k=C.type,N=C.keys,L=C.values,T=C.range;return new Promise(function(q,Q){q=Se(q);var W=$.objectStore(P),te=W.keyPath==null,se=k==="put"||k==="add";if(!se&&k!=="delete"&&k!=="deleteRange")throw new Error("Invalid operation type: "+k);var Y=(N||L||{length:1}).length;if(N&&L&&N.length!==L.length)throw new Error("Given keys array must have same length as given values array.");if(Y===0)return q({numFailures:0,failures:{},results:[],lastResult:void 0});var ae,oe=[],pe=[],J=0,Ie=function(vt){++J,hn(vt)};if(k==="deleteRange"){if(T.type===4)return q({numFailures:J,failures:pe,results:[],lastResult:void 0});T.type===3?oe.push(ae=W.clear()):oe.push(ae=W.delete(l(T)))}else{var Fe=se?te?[L,N]:[L,null]:[N,null],dt=Fe[0],We=Fe[1];if(se)for(var nt=0;nt<Y;++nt)oe.push(ae=We&&We[nt]!==void 0?W[k](dt[nt],We[nt]):W[k](dt[nt])),ae.onerror=Ie;else for(var nt=0;nt<Y;++nt)oe.push(ae=W[k](dt[nt])),ae.onerror=Ie}var Yt=function(vt){var wn=vt.target.result;oe.forEach(function(ct,Eo){return ct.error!=null&&(pe[Eo]=ct.error)}),q({numFailures:J,failures:pe,results:k==="delete"?N:oe.map(function(ct){return ct.result}),lastResult:wn})};ae.onerror=function(vt){Ie(vt),Yt(vt)},ae.onsuccess=Yt})}function b(C){var $=C.trans,k=C.values,N=C.query,L=C.reverse,T=C.unique;return new Promise(function(q,Q){q=Se(q);var W=N.index,te=N.range,se=$.objectStore(P),Y=W.isPrimaryKey?se:se.index(W.name),ae=L?T?"prevunique":"prev":T?"nextunique":"next",oe=k||!("openKeyCursor"in Y)?Y.openCursor(l(te),ae):Y.openKeyCursor(l(te),ae);oe.onerror=ht(Q),oe.onsuccess=Se(function(pe){var J=oe.result;if(!J){q(null);return}J.___id=++Op,J.done=!1;var Ie=J.continue.bind(J),Fe=J.continuePrimaryKey;Fe&&(Fe=Fe.bind(J));var dt=J.advance.bind(J),We=function(){throw new Error("Cursor not started")},nt=function(){throw new Error("Cursor not stopped")};J.trans=$,J.stop=J.continue=J.continuePrimaryKey=J.advance=We,J.fail=Se(Q),J.next=function(){var Yt=this,vt=1;return this.start(function(){return vt--?Yt.continue():Yt.stop()}).then(function(){return Yt})},J.start=function(Yt){var vt=new Promise(function(ct,Eo){ct=Se(ct),oe.onerror=ht(Eo),J.fail=Eo,J.stop=function(ph){J.stop=J.continue=J.continuePrimaryKey=J.advance=nt,ct(ph)}}),wn=function(){if(oe.result)try{Yt()}catch(ct){J.fail(ct)}else J.done=!0,J.start=function(){throw new Error("Cursor behind last entry")},J.stop()};return oe.onsuccess=Se(function(ct){oe.onsuccess=wn,wn()}),J.continue=Ie,J.continuePrimaryKey=Fe,J.advance=dt,wn(),vt},q(J)},Q)})}function D(C){return function($){return new Promise(function(k,N){k=Se(k);var L=$.trans,T=$.values,q=$.limit,Q=$.query,W=q===1/0?void 0:q,te=Q.index,se=Q.range,Y=L.objectStore(P),ae=te.isPrimaryKey?Y:Y.index(te.name),oe=l(se);if(q===0)return k({result:[]});if(C){var pe=T?ae.getAll(oe,W):ae.getAllKeys(oe,W);pe.onsuccess=function(dt){return k({result:dt.target.result})},pe.onerror=ht(N)}else{var J=0,Ie=T||!("openKeyCursor"in ae)?ae.openCursor(oe):ae.openKeyCursor(oe),Fe=[];Ie.onsuccess=function(dt){var We=Ie.result;if(!We)return k({result:Fe});if(Fe.push(T?We.value:We.primaryKey),++J===q)return k({result:Fe});We.continue()},Ie.onerror=ht(N)}})}}return{name:P,schema:w,mutate:K,getMany:function(C){var $=C.trans,k=C.keys;return new Promise(function(N,L){N=Se(N);for(var T=$.objectStore(P),q=k.length,Q=new Array(q),W=0,te=0,se,Y=function(J){var Ie=J.target;(Q[Ie._pos]=Ie.result)!=null,++te===W&&N(Q)},ae=ht(L),oe=0;oe<q;++oe){var pe=k[oe];pe!=null&&(se=T.get(k[oe]),se._pos=oe,se.onsuccess=Y,se.onerror=ae,++W)}W===0&&N(Q)})},get:function(C){var $=C.trans,k=C.key;return new Promise(function(N,L){N=Se(N);var T=$.objectStore(P),q=T.get(k);q.onsuccess=function(Q){return N(Q.target.result)},q.onerror=ht(L)})},query:D(y),openCursor:b,count:function(C){var $=C.query,k=C.trans,N=$.index,L=$.range;return new Promise(function(T,q){var Q=k.objectStore(P),W=N.isPrimaryKey?Q:Q.index(N.name),te=l(L),se=te?W.count(te):W.count();se.onsuccess=Se(function(Y){return T(Y.target.result)}),se.onerror=ht(q)})}}}var h=u(o,s),v=h.schema,y=h.hasGetAll,g=v.tables.map(function(w){return m(w)}),O={};return g.forEach(function(w){return O[w.name]=w}),{stack:"dbcore",transaction:o.transaction.bind(o),table:function(w){var P=O[w];if(!P)throw new Error("Table '".concat(w,"' not found"));return O[w]},MIN_KEY:-1/0,MAX_KEY:vn(i),schema:v}}function Ip(o,i){return i.reduce(function(s,u){var l=u.create;return r(r({},s),l(s))},o)}function Rp(o,i,s,u){var l=s.IDBKeyRange;s.indexedDB;var m=Ip(Dp(i,l,u),o.dbcore);return{dbcore:m}}function fo(o,i){var s=i.db,u=Rp(o._middlewares,s,o._deps,i);o.core=u.dbcore,o.tables.forEach(function(l){var m=l.name;o.core.schema.tables.some(function(h){return h.name===m})&&(l.core=o.core.table(m),o[m]instanceof o.Table&&(o[m].core=l.core))})}function mo(o,i,s,u){s.forEach(function(l){var m=u[l];i.forEach(function(h){var v=B(h,l);(!v||"value"in v&&v.value===void 0)&&(h===o.Transaction.prototype||h instanceof o.Transaction?I(h,l,{get:function(){return this.table(l)},set:function(y){R(this,l,{value:y,writable:!0,configurable:!0,enumerable:!0})}}):h[l]=new o.Table(l,m))})})}function ua(o,i){i.forEach(function(s){for(var u in s)s[u]instanceof o.Table&&delete s[u]})}function Ap(o,i){return o._cfg.version-i._cfg.version}function Cp(o,i,s,u){var l=o._dbSchema;s.objectStoreNames.contains("$meta")&&!l.$meta&&(l.$meta=aa("$meta",du("")[0],[]),o._storeNames.push("$meta"));var m=o._createTransaction("readwrite",o._storeNames,l);m.create(s),m._completion.catch(u);var h=m._reject.bind(m),v=X.transless||X;qt(function(){if(X.trans=m,X.transless=v,i===0)c(l).forEach(function(y){la(s,y,l[y].primKey,l[y].indexes)}),fo(o,s),z.follow(function(){return o.on.populate.fire(m)}).catch(h);else return fo(o,s),Tp(o,m,i).then(function(y){return Mp(o,y,m,s)}).catch(h)})}function Pp(o,i){hu(o._dbSchema,i),i.db.version%10===0&&!i.objectStoreNames.contains("$meta")&&i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var s=ho(o,o.idbdb,i);vo(o,o._dbSchema,i);for(var u=ca(s,o._dbSchema),l=function(g){if(g.change.length||g.recreate)return console.warn("Unable to patch indexes of table ".concat(g.name," because it has changes on the type of index or primary key.")),{value:void 0};var O=i.objectStore(g.name);g.add.forEach(function(w){pt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(g.name,".").concat(w.src)),po(O,w)})},m=0,h=u.change;m<h.length;m++){var v=h[m],y=l(v);if(typeof y=="object")return y.value}}function Tp(o,i,s){return i.storeNames.includes("$meta")?i.table("$meta").get("version").then(function(u){return u??s}):z.resolve(s)}function Mp(o,i,s,u){var l=[],m=o._versions,h=o._dbSchema=ho(o,o.idbdb,u),v=m.filter(function(g){return g._cfg.version>=i});if(v.length===0)return z.resolve();v.forEach(function(g){l.push(function(){var O=h,w=g._cfg.dbschema;vo(o,O,u),vo(o,w,u),h=o._dbSchema=w;var P=ca(O,w);P.add.forEach(function(k){la(u,k[0],k[1].primKey,k[1].indexes)}),P.change.forEach(function(k){if(k.recreate)throw new ee.Upgrade("Not yet support for changing primary key");var N=u.objectStore(k.name);k.add.forEach(function(L){return po(N,L)}),k.change.forEach(function(L){N.deleteIndex(L.name),po(N,L)}),k.del.forEach(function(L){return N.deleteIndex(L)})});var K=g._cfg.contentUpgrade;if(K&&g._cfg.version>i){fo(o,u),s._memoizedTables={};var b=mt(w);P.del.forEach(function(k){b[k]=O[k]}),ua(o,[o.Transaction.prototype]),mo(o,[o.Transaction.prototype],c(b),b),s.schema=b;var D=Li(K);D&&Mr();var C,$=z.follow(function(){if(C=K(s),C&&D){var k=Ut.bind(null,null);C.then(k,k)}});return C&&typeof C.then=="function"?z.resolve(C):$.then(function(){return C})}}),l.push(function(O){var w=g._cfg.dbschema;kp(w,O),ua(o,[o.Transaction.prototype]),mo(o,[o.Transaction.prototype],o._storeNames,o._dbSchema),s.schema=o._dbSchema}),l.push(function(O){o.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(o.idbdb.version/10)===g._cfg.version?(o.idbdb.deleteObjectStore("$meta"),delete o._dbSchema.$meta,o._storeNames=o._storeNames.filter(function(w){return w!=="$meta"})):O.objectStore("$meta").put(g._cfg.version,"version"))})});function y(){return l.length?z.resolve(l.shift()(s.idbtrans)).then(y):z.resolve()}return y().then(function(){hu(h,u)})}function ca(o,i){var s={del:[],add:[],change:[]},u;for(u in o)i[u]||s.del.push(u);for(u in i){var l=o[u],m=i[u];if(!l)s.add.push([u,m]);else{var h={name:u,def:m,recreate:!1,del:[],add:[],change:[]};if(""+(l.primKey.keyPath||"")!=""+(m.primKey.keyPath||"")||l.primKey.auto!==m.primKey.auto)h.recreate=!0,s.change.push(h);else{var v=l.idxByName,y=m.idxByName,g=void 0;for(g in v)y[g]||h.del.push(g);for(g in y){var O=v[g],w=y[g];O?O.src!==w.src&&h.change.push(w):h.add.push(w)}(h.del.length>0||h.add.length>0||h.change.length>0)&&s.change.push(h)}}}return s}function la(o,i,s,u){var l=o.db.createObjectStore(i,s.keyPath?{keyPath:s.keyPath,autoIncrement:s.auto}:{autoIncrement:s.auto});return u.forEach(function(m){return po(l,m)}),l}function hu(o,i){c(o).forEach(function(s){i.db.objectStoreNames.contains(s)||(pt&&console.debug("Dexie: Creating missing table",s),la(i,s,o[s].primKey,o[s].indexes))})}function kp(o,i){[].slice.call(i.db.objectStoreNames).forEach(function(s){return o[s]==null&&i.db.deleteObjectStore(s)})}function po(o,i){o.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function ho(o,i,s){var u={},l=G(i.objectStoreNames,0);return l.forEach(function(m){for(var h=s.objectStore(m),v=h.keyPath,y=ia(mu(v),v||"",!0,!1,!!h.autoIncrement,v&&typeof v!="string",!0),g=[],O=0;O<h.indexNames.length;++O){var w=h.index(h.indexNames[O]);v=w.keyPath;var P=ia(w.name,v,!!w.unique,!!w.multiEntry,!1,v&&typeof v!="string",!1);g.push(P)}u[m]=aa(m,y,g)}),u}function Np(o,i,s){o.verno=i.version/10;var u=o._dbSchema=ho(o,i,s);o._storeNames=G(i.objectStoreNames,0),mo(o,[o._allTables],c(u),u)}function $p(o,i){var s=ho(o,o.idbdb,i),u=ca(s,o._dbSchema);return!(u.add.length||u.change.some(function(l){return l.add.length||l.change.length}))}function vo(o,i,s){for(var u=s.db.objectStoreNames,l=0;l<u.length;++l){var m=u[l],h=s.objectStore(m);o._hasGetAll="getAll"in h;for(var v=0;v<h.indexNames.length;++v){var y=h.indexNames[v],g=h.index(y).keyPath,O=typeof g=="string"?g:"["+G(g).join("+")+"]";if(i[m]){var w=i[m].idxByName[O];w&&(w.name=y,delete i[m].idxByName[O],i[m].idxByName[y]=w)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(o._hasGetAll=!1)}function du(o){return o.split(",").map(function(i,s){i=i.trim();var u=i.replace(/([&*]|\+\+)/g,""),l=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return ia(u,l||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),f(l),s===0)})}var Bp=(function(){function o(){}return o.prototype._parseStoresSpec=function(i,s){c(i).forEach(function(u){if(i[u]!==null){var l=du(i[u]),m=l.shift();if(m.unique=!0,m.multi)throw new ee.Schema("Primary key cannot be multi-valued");l.forEach(function(h){if(h.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!h.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")}),s[u]=aa(u,m,l)}})},o.prototype.stores=function(i){var s=this.db;this._cfg.storesSource=this._cfg.storesSource?p(this._cfg.storesSource,i):i;var u=s._versions,l={},m={};return u.forEach(function(h){p(l,h._cfg.storesSource),m=h._cfg.dbschema={},h._parseStoresSpec(l,m)}),s._dbSchema=m,ua(s,[s._allTables,s,s.Transaction.prototype]),mo(s,[s._allTables,s,s.Transaction.prototype,this._cfg.tables],c(m),m),s._storeNames=c(m),this},o.prototype.upgrade=function(i){return this._cfg.contentUpgrade=Ki(this._cfg.contentUpgrade||ye,i),this},o})();function Lp(o){return mn(Bp.prototype,function(s){this.db=o,this._cfg={version:s,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function fa(o,i){var s=o._dbNamesDB;return s||(s=o._dbNamesDB=new Rt(ao,{addons:[],indexedDB:o,IDBKeyRange:i}),s.version(1).stores({dbnames:"name"})),s.table("dbnames")}function ma(o){return o&&typeof o.databases=="function"}function Fp(o){var i=o.indexedDB,s=o.IDBKeyRange;return ma(i)?Promise.resolve(i.databases()).then(function(u){return u.map(function(l){return l.name}).filter(function(l){return l!==ao})}):fa(i,s).toCollection().primaryKeys()}function jp(o,i){var s=o.indexedDB,u=o.IDBKeyRange;!ma(s)&&i!==ao&&fa(s,u).put({name:i}).catch(ye)}function Kp(o,i){var s=o.indexedDB,u=o.IDBKeyRange;!ma(s)&&i!==ao&&fa(s,u).delete(i).catch(ye)}function pa(o){return qt(function(){return X.letThrough=!0,o()})}function qp(){var o=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!o||!indexedDB.databases)return Promise.resolve();var i;return new Promise(function(s){var u=function(){return indexedDB.databases().finally(s)};i=setInterval(u,100),u()}).finally(function(){return clearInterval(i)})}var ha;function da(o){return!("from"in o)}var Le=function(o,i){if(this)p(this,arguments.length?{d:1,from:o,to:arguments.length>1?i:o}:{d:0});else{var s=new Le;return o&&"d"in o&&p(s,o),s}};E(Le.prototype,(ha={add:function(o){return xn(this,o),this},addKey:function(o){return gn(this,o,o),this},addKeys:function(o){var i=this;return o.forEach(function(s){return gn(i,s,s)}),this},hasKey:function(o){var i=yo(this).next(o).value;return i&&fe(i.from,o)<=0&&fe(i.to,o)>=0}},ha[an]=function(){return yo(this)},ha));function gn(o,i,s){var u=fe(i,s);if(!isNaN(u)){if(u>0)throw RangeError();if(da(o))return p(o,{from:i,to:s,d:1});var l=o.l,m=o.r;if(fe(s,o.from)<0)return l?gn(l,i,s):o.l={from:i,to:s,d:1,l:null,r:null},yu(o);if(fe(i,o.to)>0)return m?gn(m,i,s):o.r={from:i,to:s,d:1,l:null,r:null},yu(o);fe(i,o.from)<0&&(o.from=i,o.l=null,o.d=m?m.d+1:1),fe(s,o.to)>0&&(o.to=s,o.r=null,o.d=o.l?o.l.d+1:1);var h=!o.r;l&&!o.l&&xn(o,l),m&&h&&xn(o,m)}}function xn(o,i){function s(u,l){var m=l.from,h=l.to,v=l.l,y=l.r;gn(u,m,h),v&&s(u,v),y&&s(u,y)}da(i)||s(o,i)}function vu(o,i){var s=yo(i),u=s.next();if(u.done)return!1;for(var l=u.value,m=yo(o),h=m.next(l.from),v=h.value;!u.done&&!h.done;){if(fe(v.from,l.to)<=0&&fe(v.to,l.from)>=0)return!0;fe(l.from,v.from)<0?l=(u=s.next(v.from)).value:v=(h=m.next(l.from)).value}return!1}function yo(o){var i=da(o)?null:{s:0,n:o};return{next:function(s){for(var u=arguments.length>0;i;)switch(i.s){case 0:if(i.s=1,u)for(;i.n.l&&fe(s,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!u||fe(s,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function yu(o){var i,s,u=(((i=o.r)===null||i===void 0?void 0:i.d)||0)-(((s=o.l)===null||s===void 0?void 0:s.d)||0),l=u>1?"r":u<-1?"l":"";if(l){var m=l==="r"?"l":"r",h=r({},o),v=o[l];o.from=v.from,o.to=v.to,o[l]=v[l],h[l]=v[m],o[m]=h,h.d=gu(h)}o.d=gu(o)}function gu(o){var i=o.r,s=o.l;return(i?s?Math.max(i.d,s.d):i.d:s?s.d:0)+1}function go(o,i){return c(i).forEach(function(s){o[s]?xn(o[s],i[s]):o[s]=Yn(i[s])}),o}function va(o,i){return o.all||i.all||Object.keys(o).some(function(s){return i[s]&&vu(i[s],o[s])})}var dr={},ya={},ga=!1;function xo(o,i){go(ya,o),ga||(ga=!0,setTimeout(function(){ga=!1;var s=ya;ya={},xa(s,!1)},0))}function xa(o,i){i===void 0&&(i=!1);var s=new Set;if(o.all)for(var u=0,l=Object.values(dr);u<l.length;u++){var m=l[u];xu(m,o,s,i)}else for(var h in o){var v=/^idb\:\/\/(.*)\/(.*)\//.exec(h);if(v){var y=v[1],g=v[2],m=dr["idb://".concat(y,"/").concat(g)];m&&xu(m,o,s,i)}}s.forEach(function(O){return O()})}function xu(o,i,s,u){for(var l=[],m=0,h=Object.entries(o.queries.query);m<h.length;m++){for(var v=h[m],y=v[0],g=v[1],O=[],w=0,P=g;w<P.length;w++){var K=P[w];va(i,K.obsSet)?K.subscribers.forEach(function($){return s.add($)}):u&&O.push(K)}u&&l.push([y,O])}if(u)for(var b=0,D=l;b<D.length;b++){var C=D[b],y=C[0],O=C[1];o.queries.query[y]=O}}function Up(o){var i=o._state,s=o._deps.indexedDB;if(i.isBeingOpened||o.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?Re(i.dbOpenError):o});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var u=i.openCanceller,l=Math.round(o.verno*10),m=!1;function h(){if(i.openCanceller!==u)throw new ee.DatabaseClosed("db.open() was cancelled")}var v=i.dbReadyResolve,y=null,g=!1,O=function(){return new z(function(w,P){if(h(),!s)throw new ee.MissingAPI;var K=o.name,b=i.autoSchema||!l?s.open(K):s.open(K,l);if(!b)throw new ee.MissingAPI;b.onerror=ht(P),b.onblocked=Se(o._fireOnBlocked),b.onupgradeneeded=Se(function(D){if(y=b.transaction,i.autoSchema&&!o._options.allowEmptyDB){b.onerror=hn,y.abort(),b.result.close();var C=s.deleteDatabase(K);C.onsuccess=C.onerror=Se(function(){P(new ee.NoSuchDatabase("Database ".concat(K," doesnt exist")))})}else{y.onerror=ht(P);var $=D.oldVersion>Math.pow(2,62)?0:D.oldVersion;g=$<1,o.idbdb=b.result,m&&Pp(o,y),Cp(o,$/10,y,P)}},P),b.onsuccess=Se(function(){y=null;var D=o.idbdb=b.result,C=G(D.objectStoreNames);if(C.length>0)try{var $=D.transaction(Ep(C),"readonly");if(i.autoSchema)Np(o,D,$);else if(vo(o,o._dbSchema,$),!$p(o,$)&&!m)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),D.close(),l=D.version+1,m=!0,w(O());fo(o,$)}catch{}kr.push(o),D.onversionchange=Se(function(k){i.vcFired=!0,o.on("versionchange").fire(k)}),D.onclose=Se(function(k){o.on("close").fire(k)}),g&&jp(o._deps,K),w()},P)}).catch(function(w){switch(w?.name){case"UnknownError":if(i.PR1398_maxLoop>0)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),O();break;case"VersionError":if(l>0)return l=0,O();break}return z.reject(w)})};return z.race([u,(typeof navigator>"u"?z.resolve():qp()).then(O)]).then(function(){return h(),i.onReadyBeingFired=[],z.resolve(pa(function(){return o.on.ready.fire(o.vip)})).then(function w(){if(i.onReadyBeingFired.length>0){var P=i.onReadyBeingFired.reduce(Ki,ye);return i.onReadyBeingFired=[],z.resolve(pa(function(){return P(o.vip)})).then(w)}})}).finally(function(){i.openCanceller===u&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(w){i.dbOpenError=w;try{y&&y.abort()}catch{}return u===i.openCanceller&&o._close(),Re(w)}).finally(function(){i.openComplete=!0,v()}).then(function(){if(g){var w={};o.tables.forEach(function(P){P.schema.indexes.forEach(function(K){K.name&&(w["idb://".concat(o.name,"/").concat(P.name,"/").concat(K.name)]=new Le(-1/0,[[[]]]))}),w["idb://".concat(o.name,"/").concat(P.name,"/")]=w["idb://".concat(o.name,"/").concat(P.name,"/:dels")]=new Le(-1/0,[[[]]])}),zt(dn).fire(w),xa(w,!0)}return o})}function wa(o){var i=function(h){return o.next(h)},s=function(h){return o.throw(h)},u=m(i),l=m(s);function m(h){return function(v){var y=h(v),g=y.value;return y.done?g:!g||typeof g.then!="function"?f(g)?Promise.all(g).then(u,l):u(g):g.then(u,l)}}return m(i)()}function Vp(o,i,s){var u=arguments.length;if(u<2)throw new ee.InvalidArgument("Too few arguments");for(var l=new Array(u-1);--u;)l[u-1]=arguments[u];s=l.pop();var m=Lt(l);return[o,m,s]}function wu(o,i,s,u,l){return z.resolve().then(function(){var m=X.transless||X,h=o._createTransaction(i,s,o._dbSchema,u);h.explicit=!0;var v={trans:h,transless:m};if(u)h.idbtrans=u.idbtrans;else try{h.create(),h.idbtrans._explicit=!0,o._state.PR1398_maxLoop=3}catch(w){return w.name===ji.InvalidState&&o.isOpen()&&--o._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),o.close({disableAutoOpen:!1}),o.open().then(function(){return wu(o,i,s,null,l)})):Re(w)}var y=Li(l);y&&Mr();var g,O=z.follow(function(){if(g=l.call(h,h),g)if(y){var w=Ut.bind(null,null);g.then(w,w)}else typeof g.next=="function"&&typeof g.throw=="function"&&(g=wa(g))},v);return(g&&typeof g.then=="function"?z.resolve(g).then(function(w){return h.active?w:Re(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):O.then(function(){return g})).then(function(w){return u&&h._resolve(),h._completion.then(function(){return w})}).catch(function(w){return h._reject(w),Re(w)})})}function wo(o,i,s){for(var u=f(o)?o.slice():[o],l=0;l<s;++l)u.push(i);return u}function Wp(o){return r(r({},o),{table:function(i){var s=o.table(i),u=s.schema,l={},m=[];function h(D,C,$){var k=yn(D),N=l[k]=l[k]||[],L=D==null?0:typeof D=="string"?1:D.length,T=C>0,q=r(r({},$),{name:T?"".concat(k,"(virtual-from:").concat($.name,")"):$.name,lowLevelIndex:$,isVirtual:T,keyTail:C,keyLength:L,extractKey:sa(D),unique:!T&&$.unique});if(N.push(q),q.isPrimaryKey||m.push(q),L>1){var Q=L===2?D[0]:D.slice(0,L-1);h(Q,C+1,$)}return N.sort(function(W,te){return W.keyTail-te.keyTail}),q}var v=h(u.primaryKey.keyPath,0,u.primaryKey);l[":id"]=[v];for(var y=0,g=u.indexes;y<g.length;y++){var O=g[y];h(O.keyPath,0,O)}function w(D){var C=l[yn(D)];return C&&C[0]}function P(D,C){return{type:D.type===1?2:D.type,lower:wo(D.lower,D.lowerOpen?o.MAX_KEY:o.MIN_KEY,C),lowerOpen:!0,upper:wo(D.upper,D.upperOpen?o.MIN_KEY:o.MAX_KEY,C),upperOpen:!0}}function K(D){var C=D.query.index;return C.isVirtual?r(r({},D),{query:{index:C.lowLevelIndex,range:P(D.query.range,C.keyTail)}}):D}var b=r(r({},s),{schema:r(r({},u),{primaryKey:v,indexes:m,getIndexByKeyPath:w}),count:function(D){return s.count(K(D))},query:function(D){return s.query(K(D))},openCursor:function(D){var C=D.query.index,$=C.keyTail,k=C.isVirtual,N=C.keyLength;if(!k)return s.openCursor(D);function L(T){function q(W){W!=null?T.continue(wo(W,D.reverse?o.MAX_KEY:o.MIN_KEY,$)):D.unique?T.continue(T.key.slice(0,N).concat(D.reverse?o.MIN_KEY:o.MAX_KEY,$)):T.continue()}var Q=Object.create(T,{continue:{value:q},continuePrimaryKey:{value:function(W,te){T.continuePrimaryKey(wo(W,o.MAX_KEY,$),te)}},primaryKey:{get:function(){return T.primaryKey}},key:{get:function(){var W=T.key;return N===1?W[0]:W.slice(0,N)}},value:{get:function(){return T.value}}});return Q}return s.openCursor(K(D)).then(function(T){return T&&L(T)})}});return b}})}var zp={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Wp};function ba(o,i,s,u){return s=s||{},u=u||"",c(o).forEach(function(l){if(!x(i,l))s[u+l]=void 0;else{var m=o[l],h=i[l];if(typeof m=="object"&&typeof h=="object"&&m&&h){var v=jt(m),y=jt(h);v!==y?s[u+l]=i[l]:v==="Object"?ba(m,h,s,u+l+"."):m!==h&&(s[u+l]=i[l])}else m!==h&&(s[u+l]=i[l])}}),c(i).forEach(function(l){x(o,l)||(s[u+l]=i[l])}),s}function _a(o,i){return i.type==="delete"?i.keys:i.keys||i.values.map(o.extractKey)}var Qp={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(o){return r(r({},o),{table:function(i){var s=o.table(i),u=s.schema.primaryKey,l=r(r({},s),{mutate:function(m){var h=X.trans,v=h.table(i).hook,y=v.deleting,g=v.creating,O=v.updating;switch(m.type){case"add":if(g.fire===ye)break;return h._promise("readwrite",function(){return w(m)},!0);case"put":if(g.fire===ye&&O.fire===ye)break;return h._promise("readwrite",function(){return w(m)},!0);case"delete":if(y.fire===ye)break;return h._promise("readwrite",function(){return w(m)},!0);case"deleteRange":if(y.fire===ye)break;return h._promise("readwrite",function(){return P(m)},!0)}return s.mutate(m);function w(b){var D=X.trans,C=b.keys||_a(u,b);if(!C)throw new Error("Keys missing");return b=b.type==="add"||b.type==="put"?r(r({},b),{keys:C}):r({},b),b.type!=="delete"&&(b.values=n([],b.values,!0)),b.keys&&(b.keys=n([],b.keys,!0)),Hp(s,b,C).then(function($){var k=C.map(function(N,L){var T=$[L],q={onerror:null,onsuccess:null};if(b.type==="delete")y.fire.call(q,N,T,D);else if(b.type==="add"||T===void 0){var Q=g.fire.call(q,N,b.values[L],D);N==null&&Q!=null&&(N=Q,b.keys[L]=N,u.outbound||le(b.values[L],u.keyPath,N))}else{var W=ba(T,b.values[L]),te=O.fire.call(q,W,N,T,D);if(te){var se=b.values[L];Object.keys(te).forEach(function(Y){x(se,Y)?se[Y]=te[Y]:le(se,Y,te[Y])})}}return q});return s.mutate(b).then(function(N){for(var L=N.failures,T=N.results,q=N.numFailures,Q=N.lastResult,W=0;W<C.length;++W){var te=T?T[W]:C[W],se=k[W];te==null?se.onerror&&se.onerror(L[W]):se.onsuccess&&se.onsuccess(b.type==="put"&&$[W]?b.values[W]:te)}return{failures:L,results:T,numFailures:q,lastResult:Q}}).catch(function(N){return k.forEach(function(L){return L.onerror&&L.onerror(N)}),Promise.reject(N)})})}function P(b){return K(b.trans,b.range,1e4)}function K(b,D,C){return s.query({trans:b,values:!1,query:{index:u,range:D},limit:C}).then(function($){var k=$.result;return w({type:"delete",keys:k,trans:b}).then(function(N){return N.numFailures>0?Promise.reject(N.failures[0]):k.length<C?{failures:[],numFailures:0,lastResult:void 0}:K(b,r(r({},D),{lower:k[k.length-1],lowerOpen:!0}),C)})})}}});return l}})}};function Hp(o,i,s){return i.type==="add"?Promise.resolve([]):o.getMany({trans:i.trans,keys:s,cache:"immutable"})}function bu(o,i,s){try{if(!i||i.keys.length<o.length)return null;for(var u=[],l=0,m=0;l<i.keys.length&&m<o.length;++l)fe(i.keys[l],o[m])===0&&(u.push(s?rt(i.values[l]):i.values[l]),++m);return u.length===o.length?u:null}catch{return null}}var Yp={stack:"dbcore",level:-1,create:function(o){return{table:function(i){var s=o.table(i);return r(r({},s),{getMany:function(u){if(!u.cache)return s.getMany(u);var l=bu(u.keys,u.trans._cache,u.cache==="clone");return l?z.resolve(l):s.getMany(u).then(function(m){return u.trans._cache={keys:u.keys,values:u.cache==="clone"?rt(m):m},m})},mutate:function(u){return u.type!=="add"&&(u.trans._cache=null),s.mutate(u)}})}}}};function _u(o,i){return o.trans.mode==="readonly"&&!!o.subscr&&!o.trans.explicit&&o.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function Eu(o,i){switch(o){case"query":return i.values&&!i.unique;case"get":return!1;case"getMany":return!1;case"count":return!1;case"openCursor":return!1}}var Xp={stack:"dbcore",level:0,name:"Observability",create:function(o){var i=o.schema.name,s=new Le(o.MIN_KEY,o.MAX_KEY);return r(r({},o),{transaction:function(u,l,m){if(X.subscr&&l!=="readonly")throw new ee.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(X.querier));return o.transaction(u,l,m)},table:function(u){var l=o.table(u),m=l.schema,h=m.primaryKey,v=m.indexes,y=h.extractKey,g=h.outbound,O=h.autoIncrement&&v.filter(function(b){return b.compound&&b.keyPath.includes(h.keyPath)}),w=r(r({},l),{mutate:function(b){var D,C,$=b.trans,k=b.mutatedParts||(b.mutatedParts={}),N=function(oe){var pe="idb://".concat(i,"/").concat(u,"/").concat(oe);return k[pe]||(k[pe]=new Le)},L=N(""),T=N(":dels"),q=b.type,Q=b.type==="deleteRange"?[b.range]:b.type==="delete"?[b.keys]:b.values.length<50?[_a(h,b).filter(function(oe){return oe}),b.values]:[],W=Q[0],te=Q[1],se=b.trans._cache;if(f(W)){L.addKeys(W);var Y=q==="delete"||W.length===te.length?bu(W,se):null;Y||T.addKeys(W),(Y||te)&&Gp(N,m,Y,te)}else if(W){var ae={from:(D=W.lower)!==null&&D!==void 0?D:o.MIN_KEY,to:(C=W.upper)!==null&&C!==void 0?C:o.MAX_KEY};T.add(ae),L.add(ae)}else L.add(s),T.add(s),m.indexes.forEach(function(oe){return N(oe.name).add(s)});return l.mutate(b).then(function(oe){return W&&(b.type==="add"||b.type==="put")&&(L.addKeys(oe.results),O&&O.forEach(function(pe){for(var J=b.values.map(function(We){return pe.extractKey(We)}),Ie=pe.keyPath.findIndex(function(We){return We===h.keyPath}),Fe=0,dt=oe.results.length;Fe<dt;++Fe)J[Fe][Ie]=oe.results[Fe];N(pe.name).addKeys(J)})),$.mutatedParts=go($.mutatedParts||{},k),oe})}}),P=function(b){var D,C,$=b.query,k=$.index,N=$.range;return[k,new Le((D=N.lower)!==null&&D!==void 0?D:o.MIN_KEY,(C=N.upper)!==null&&C!==void 0?C:o.MAX_KEY)]},K={get:function(b){return[h,new Le(b.key)]},getMany:function(b){return[h,new Le().addKeys(b.keys)]},count:P,query:P,openCursor:P};return c(K).forEach(function(b){w[b]=function(D){var C=X.subscr,$=!!C,k=_u(X,l)&&Eu(b,D),N=k?D.obsSet={}:C;if($){var L=function(Y){var ae="idb://".concat(i,"/").concat(u,"/").concat(Y);return N[ae]||(N[ae]=new Le)},T=L(""),q=L(":dels"),Q=K[b](D),W=Q[0],te=Q[1];if(b==="query"&&W.isPrimaryKey&&!D.values?q.add(te):L(W.name||"").add(te),!W.isPrimaryKey)if(b==="count")q.add(s);else{var se=b==="query"&&g&&D.values&&l.query(r(r({},D),{values:!1}));return l[b].apply(this,arguments).then(function(Y){if(b==="query"){if(g&&D.values)return se.then(function(J){var Ie=J.result;return T.addKeys(Ie),Y});var ae=D.values?Y.result.map(y):Y.result;D.values?T.addKeys(ae):q.addKeys(ae)}else if(b==="openCursor"){var oe=Y,pe=D.values;return oe&&Object.create(oe,{key:{get:function(){return q.addKey(oe.primaryKey),oe.key}},primaryKey:{get:function(){var J=oe.primaryKey;return q.addKey(J),J}},value:{get:function(){return pe&&T.addKey(oe.primaryKey),oe.value}}})}return Y})}}return l[b].apply(this,arguments)}}),w}})}};function Gp(o,i,s,u){function l(m){var h=o(m.name||"");function v(g){return g!=null?m.extractKey(g):null}var y=function(g){return m.multiEntry&&f(g)?g.forEach(function(O){return h.addKey(O)}):h.addKey(g)};(s||u).forEach(function(g,O){var w=s&&v(s[O]),P=u&&v(u[O]);fe(w,P)!==0&&(w!=null&&y(w),P!=null&&y(P))})}i.indexes.forEach(l)}function Su(o,i,s){if(s.numFailures===0)return i;if(i.type==="deleteRange")return null;var u=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1;if(s.numFailures===u)return null;var l=r({},i);return f(l.keys)&&(l.keys=l.keys.filter(function(m,h){return!(h in s.failures)})),"values"in l&&f(l.values)&&(l.values=l.values.filter(function(m,h){return!(h in s.failures)})),l}function Jp(o,i){return i.lower===void 0?!0:i.lowerOpen?fe(o,i.lower)>0:fe(o,i.lower)>=0}function Zp(o,i){return i.upper===void 0?!0:i.upperOpen?fe(o,i.upper)<0:fe(o,i.upper)<=0}function Ea(o,i){return Jp(o,i)&&Zp(o,i)}function Ou(o,i,s,u,l,m){if(!s||s.length===0)return o;var h=i.query.index,v=h.multiEntry,y=i.query.range,g=u.schema.primaryKey,O=g.extractKey,w=h.extractKey,P=(h.lowLevelIndex||h).extractKey,K=s.reduce(function(b,D){var C=b,$=[];if(D.type==="add"||D.type==="put")for(var k=new Le,N=D.values.length-1;N>=0;--N){var L=D.values[N],T=O(L);if(!k.hasKey(T)){var q=w(L);(v&&f(q)?q.some(function(Y){return Ea(Y,y)}):Ea(q,y))&&(k.addKey(T),$.push(L))}}switch(D.type){case"add":{var Q=new Le().addKeys(i.values?b.map(function(Y){return O(Y)}):b);C=b.concat(i.values?$.filter(function(Y){var ae=O(Y);return Q.hasKey(ae)?!1:(Q.addKey(ae),!0)}):$.map(function(Y){return O(Y)}).filter(function(Y){return Q.hasKey(Y)?!1:(Q.addKey(Y),!0)}));break}case"put":{var W=new Le().addKeys(D.values.map(function(Y){return O(Y)}));C=b.filter(function(Y){return!W.hasKey(i.values?O(Y):Y)}).concat(i.values?$:$.map(function(Y){return O(Y)}));break}case"delete":var te=new Le().addKeys(D.keys);C=b.filter(function(Y){return!te.hasKey(i.values?O(Y):Y)});break;case"deleteRange":var se=D.range;C=b.filter(function(Y){return!Ea(O(Y),se)});break}return C},o);return K===o?o:(K.sort(function(b,D){return fe(P(b),P(D))||fe(O(b),O(D))}),i.limit&&i.limit<1/0&&(K.length>i.limit?K.length=i.limit:o.length===i.limit&&K.length<i.limit&&(l.dirty=!0)),m?Object.freeze(K):K)}function Du(o,i){return fe(o.lower,i.lower)===0&&fe(o.upper,i.upper)===0&&!!o.lowerOpen==!!i.lowerOpen&&!!o.upperOpen==!!i.upperOpen}function eh(o,i,s,u){if(o===void 0)return i!==void 0?-1:0;if(i===void 0)return 1;var l=fe(o,i);if(l===0){if(s&&u)return 0;if(s)return 1;if(u)return-1}return l}function th(o,i,s,u){if(o===void 0)return i!==void 0?1:0;if(i===void 0)return-1;var l=fe(o,i);if(l===0){if(s&&u)return 0;if(s)return-1;if(u)return 1}return l}function rh(o,i){return eh(o.lower,i.lower,o.lowerOpen,i.lowerOpen)<=0&&th(o.upper,i.upper,o.upperOpen,i.upperOpen)>=0}function nh(o,i,s,u){var l=dr["idb://".concat(o,"/").concat(i)];if(!l)return[];var m=l.queries[s];if(!m)return[null,!1,l,null];var h=u.query?u.query.index.name:null,v=m[h||""];if(!v)return[null,!1,l,null];switch(s){case"query":var y=v.find(function(w){return w.req.limit===u.limit&&w.req.values===u.values&&Du(w.req.query.range,u.query.range)});if(y)return[y,!0,l,v];var g=v.find(function(w){var P="limit"in w.req?w.req.limit:1/0;return P>=u.limit&&(u.values?w.req.values:!0)&&rh(w.req.query.range,u.query.range)});return[g,!1,l,v];case"count":var O=v.find(function(w){return Du(w.req.query.range,u.query.range)});return[O,!!O,l,v]}}function oh(o,i,s,u){o.subscribers.add(s),u.addEventListener("abort",function(){o.subscribers.delete(s),o.subscribers.size===0&&ih(o,i)})}function ih(o,i){setTimeout(function(){o.subscribers.size===0&&Pe(i,o)},3e3)}var ah={stack:"dbcore",level:0,name:"Cache",create:function(o){var i=o.schema.name,s=r(r({},o),{transaction:function(u,l,m){var h=o.transaction(u,l,m);if(l==="readwrite"){var v=new AbortController,y=v.signal,g=function(O){return function(){if(v.abort(),l==="readwrite"){for(var w=new Set,P=0,K=u;P<K.length;P++){var b=K[P],D=dr["idb://".concat(i,"/").concat(b)];if(D){var C=o.table(b),$=D.optimisticOps.filter(function(pe){return pe.trans===h});if(h._explicit&&O&&h.mutatedParts)for(var k=0,N=Object.values(D.queries.query);k<N.length;k++)for(var L=N[k],T=0,q=L.slice();T<q.length;T++){var Q=q[T];va(Q.obsSet,h.mutatedParts)&&(Pe(L,Q),Q.subscribers.forEach(function(pe){return w.add(pe)}))}else if($.length>0){D.optimisticOps=D.optimisticOps.filter(function(pe){return pe.trans!==h});for(var W=0,te=Object.values(D.queries.query);W<te.length;W++)for(var L=te[W],se=0,Y=L.slice();se<Y.length;se++){var Q=Y[se];if(Q.res!=null&&h.mutatedParts)if(O&&!Q.dirty){var ae=Object.isFrozen(Q.res),oe=Ou(Q.res,Q.req,$,C,Q,ae);Q.dirty?(Pe(L,Q),Q.subscribers.forEach(function(Ie){return w.add(Ie)})):oe!==Q.res&&(Q.res=oe,Q.promise=z.resolve({result:oe}))}else Q.dirty&&Pe(L,Q),Q.subscribers.forEach(function(Ie){return w.add(Ie)})}}}}w.forEach(function(pe){return pe()})}}};h.addEventListener("abort",g(!1),{signal:y}),h.addEventListener("error",g(!1),{signal:y}),h.addEventListener("complete",g(!0),{signal:y})}return h},table:function(u){var l=o.table(u),m=l.schema.primaryKey,h=r(r({},l),{mutate:function(v){var y=X.trans;if(m.outbound||y.db._options.cache==="disabled"||y.explicit||y.idbtrans.mode!=="readwrite")return l.mutate(v);var g=dr["idb://".concat(i,"/").concat(u)];if(!g)return l.mutate(v);var O=l.mutate(v);return(v.type==="add"||v.type==="put")&&(v.values.length>=50||_a(m,v).some(function(w){return w==null}))?O.then(function(w){var P=r(r({},v),{values:v.values.map(function(b,D){var C;if(w.failures[D])return b;var $=!((C=m.keyPath)===null||C===void 0)&&C.includes(".")?rt(b):r({},b);return le($,m.keyPath,w.results[D]),$})}),K=Su(g,P,w);g.optimisticOps.push(K),queueMicrotask(function(){return v.mutatedParts&&xo(v.mutatedParts)})}):(g.optimisticOps.push(v),v.mutatedParts&&xo(v.mutatedParts),O.then(function(w){if(w.numFailures>0){Pe(g.optimisticOps,v);var P=Su(g,v,w);P&&g.optimisticOps.push(P),v.mutatedParts&&xo(v.mutatedParts)}}),O.catch(function(){Pe(g.optimisticOps,v),v.mutatedParts&&xo(v.mutatedParts)})),O},query:function(v){var y;if(!_u(X,l)||!Eu("query",v))return l.query(v);var g=((y=X.trans)===null||y===void 0?void 0:y.db._options.cache)==="immutable",O=X,w=O.requery,P=O.signal,K=nh(i,u,"query",v),b=K[0],D=K[1],C=K[2],$=K[3];if(b&&D)b.obsSet=v.obsSet;else{var k=l.query(v).then(function(N){var L=N.result;if(b&&(b.res=L),g){for(var T=0,q=L.length;T<q;++T)Object.freeze(L[T]);Object.freeze(L)}else N.result=rt(L);return N}).catch(function(N){return $&&b&&Pe($,b),Promise.reject(N)});b={obsSet:v.obsSet,promise:k,subscribers:new Set,type:"query",req:v,dirty:!1},$?$.push(b):($=[b],C||(C=dr["idb://".concat(i,"/").concat(u)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),C.queries.query[v.query.index.name||""]=$)}return oh(b,$,w,P),b.promise.then(function(N){return{result:Ou(N.result,v,C?.optimisticOps,l,b,g)}})}});return h}});return s}};function bo(o,i){return new Proxy(o,{get:function(s,u,l){return u==="db"?i:Reflect.get(s,u,l)}})}var Rt=(function(){function o(i,s){var u=this;this._middlewares={},this.verno=0;var l=o.dependencies;this._options=s=r({addons:o.addons,autoOpen:!0,indexedDB:l.indexedDB,IDBKeyRange:l.IDBKeyRange,cache:"cloned"},s),this._deps={indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange};var m=s.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var h={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ye,dbReadyPromise:null,cancelOpen:ye,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:s.autoOpen};h.dbReadyPromise=new z(function(y){h.dbReadyResolve=y}),h.openCanceller=new z(function(y,g){h.cancelOpen=g}),this._state=h,this.name=i,this.on=fn(this,"populate","blocked","versionchange","close",{ready:[Ki,ye]}),this.on.ready.subscribe=re(this.on.ready.subscribe,function(y){return function(g,O){o.vip(function(){var w=u._state;if(w.openComplete)w.dbOpenError||z.resolve().then(g),O&&y(g);else if(w.onReadyBeingFired)w.onReadyBeingFired.push(g),O&&y(g);else{y(g);var P=u;O||y(function K(){P.on.ready.unsubscribe(g),P.on.ready.unsubscribe(K)})}})}}),this.Collection=hp(this),this.Table=lp(this),this.Transaction=_p(this),this.Version=Lp(this),this.WhereClause=wp(this),this.on("versionchange",function(y){y.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(u.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(u.name,"'. Closing db now to resume the delete request.")),u.close({disableAutoOpen:!1})}),this.on("blocked",function(y){!y.newVersion||y.newVersion<y.oldVersion?console.warn("Dexie.delete('".concat(u.name,"') was blocked")):console.warn("Upgrade '".concat(u.name,"' blocked by other connection holding version ").concat(y.oldVersion/10))}),this._maxKey=vn(s.IDBKeyRange),this._createTransaction=function(y,g,O,w){return new u.Transaction(y,g,O,u._options.chromeTransactionDurability,w)},this._fireOnBlocked=function(y){u.on("blocked").fire(y),kr.filter(function(g){return g.name===u.name&&g!==u&&!g._state.vcFired}).map(function(g){return g.on("versionchange").fire(y)})},this.use(Yp),this.use(ah),this.use(Xp),this.use(zp),this.use(Qp);var v=new Proxy(this,{get:function(y,g,O){if(g==="_vip")return!0;if(g==="table")return function(P){return bo(u.table(P),v)};var w=Reflect.get(y,g,O);return w instanceof su?bo(w,v):g==="tables"?w.map(function(P){return bo(P,v)}):g==="_createTransaction"?function(){var P=w.apply(this,arguments);return bo(P,v)}:w}});this.vip=v,m.forEach(function(y){return y(u)})}return o.prototype.version=function(i){if(isNaN(i)||i<.1)throw new ee.Type("Given version is not a positive number");if(i=Math.round(i*10)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,i);var s=this._versions,u=s.filter(function(l){return l._cfg.version===i})[0];return u||(u=new this.Version(i),s.push(u),s.sort(Ap),u.stores({}),this._state.autoSchema=!1,u)},o.prototype._whenReady=function(i){var s=this;return this.idbdb&&(this._state.openComplete||X.letThrough||this._vip)?i():new z(function(u,l){if(s._state.openComplete)return l(new ee.DatabaseClosed(s._state.dbOpenError));if(!s._state.isBeingOpened){if(!s._state.autoOpen){l(new ee.DatabaseClosed);return}s.open().catch(ye)}s._state.dbReadyPromise.then(u,l)}).then(i)},o.prototype.use=function(i){var s=i.stack,u=i.create,l=i.level,m=i.name;m&&this.unuse({stack:s,name:m});var h=this._middlewares[s]||(this._middlewares[s]=[]);return h.push({stack:s,create:u,level:l??10,name:m}),h.sort(function(v,y){return v.level-y.level}),this},o.prototype.unuse=function(i){var s=i.stack,u=i.name,l=i.create;return s&&this._middlewares[s]&&(this._middlewares[s]=this._middlewares[s].filter(function(m){return l?m.create!==l:u?m.name!==u:!1})),this},o.prototype.open=function(){var i=this;return mr(Kt,function(){return Up(i)})},o.prototype._close=function(){var i=this._state,s=kr.indexOf(this);if(s>=0&&kr.splice(s,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}i.isBeingOpened||(i.dbReadyPromise=new z(function(u){i.dbReadyResolve=u}),i.openCanceller=new z(function(u,l){i.cancelOpen=l}))},o.prototype.close=function(i){var s=i===void 0?{disableAutoOpen:!0}:i,u=s.disableAutoOpen,l=this._state;u?(l.isBeingOpened&&l.cancelOpen(new ee.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new ee.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},o.prototype.delete=function(i){var s=this;i===void 0&&(i={disableAutoOpen:!0});var u=arguments.length>0&&typeof arguments[0]!="object",l=this._state;return new z(function(m,h){var v=function(){s.close(i);var y=s._deps.indexedDB.deleteDatabase(s.name);y.onsuccess=Se(function(){Kp(s._deps,s.name),m()}),y.onerror=ht(h),y.onblocked=s._fireOnBlocked};if(u)throw new ee.InvalidArgument("Invalid closeOptions argument to db.delete()");l.isBeingOpened?l.dbReadyPromise.then(v):v()})},o.prototype.backendDB=function(){return this.idbdb},o.prototype.isOpen=function(){return this.idbdb!==null},o.prototype.hasBeenClosed=function(){var i=this._state.dbOpenError;return i&&i.name==="DatabaseClosed"},o.prototype.hasFailed=function(){return this._state.dbOpenError!==null},o.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(o.prototype,"tables",{get:function(){var i=this;return c(this._allTables).map(function(s){return i._allTables[s]})},enumerable:!1,configurable:!0}),o.prototype.transaction=function(){var i=Vp.apply(this,arguments);return this._transaction.apply(this,i)},o.prototype._transaction=function(i,s,u){var l=this,m=X.trans;(!m||m.db!==this||i.indexOf("!")!==-1)&&(m=null);var h=i.indexOf("?")!==-1;i=i.replace("!","").replace("?","");var v,y;try{if(y=s.map(function(O){var w=O instanceof l.Table?O.name:O;if(typeof w!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return w}),i=="r"||i===Zi)v=Zi;else if(i=="rw"||i==ea)v=ea;else throw new ee.InvalidArgument("Invalid transaction mode: "+i);if(m){if(m.mode===Zi&&v===ea)if(h)m=null;else throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");m&&y.forEach(function(O){if(m&&m.storeNames.indexOf(O)===-1)if(h)m=null;else throw new ee.SubTransaction("Table "+O+" not included in parent transaction.")}),h&&m&&!m.active&&(m=null)}}catch(O){return m?m._promise(null,function(w,P){P(O)}):Re(O)}var g=wu.bind(null,this,v,y,m,u);return m?m._promise(v,g,"lock"):X.trans?mr(X.transless,function(){return l._whenReady(g)}):this._whenReady(g)},o.prototype.table=function(i){if(!x(this._allTables,i))throw new ee.InvalidTable("Table ".concat(i," does not exist"));return this._allTables[i]},o})(),sh=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",uh=(function(){function o(i){this._subscribe=i}return o.prototype.subscribe=function(i,s,u){return this._subscribe(!i||typeof i=="function"?{next:i,error:s,complete:u}:i)},o.prototype[sh]=function(){return this},o})(),_o;try{_o={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{_o={indexedDB:null,IDBKeyRange:null}}function Iu(o){var i=!1,s,u=new uh(function(l){var m=Li(o);function h($){var k=Pr();try{m&&Mr();var N=qt(o,$);return m&&(N=N.finally(Ut)),N}finally{k&&Tr()}}var v=!1,y,g={},O={},w={get closed(){return v},unsubscribe:function(){v||(v=!0,y&&y.abort(),P&&zt.storagemutated.unsubscribe(D))}};l.start&&l.start(w);var P=!1,K=function(){return Xi(C)};function b(){return va(O,g)}var D=function($){go(g,$),b()&&K()},C=function(){if(!(v||!_o.indexedDB)){g={};var $={};y&&y.abort(),y=new AbortController;var k={subscr:$,signal:y.signal,requery:K,querier:o,trans:null},N=h(k);Promise.resolve(N).then(function(L){i=!0,s=L,!(v||k.signal.aborted)&&(g={},O=$,!Bi(O)&&!P&&(zt(dn,D),P=!0),Xi(function(){return!v&&l.next&&l.next(L)}))},function(L){i=!1,["DatabaseClosedError","AbortError"].includes(L?.name)||v||Xi(function(){v||l.error&&l.error(L)})})}};return setTimeout(K,0),w});return u.hasValue=function(){return i},u.getValue=function(){return s},u}var vr=Rt;E(vr,r(r({},Gn),{delete:function(o){var i=new vr(o,{addons:[]});return i.delete()},exists:function(o){return new vr(o,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(o){try{return Fp(vr.dependencies).then(o)}catch{return Re(new ee.MissingAPI)}},defineClass:function(){function o(i){p(this,i)}return o},ignoreTransaction:function(o){return X.trans?mr(X.transless,o):o()},vip:pa,async:function(o){return function(){try{var i=wa(o.apply(this,arguments));return!i||typeof i.then!="function"?z.resolve(i):i}catch(s){return Re(s)}}},spawn:function(o,i,s){try{var u=wa(o.apply(s,i||[]));return!u||typeof u.then!="function"?z.resolve(u):u}catch(l){return Re(l)}},currentTransaction:{get:function(){return X.trans||null}},waitFor:function(o,i){var s=z.resolve(typeof o=="function"?vr.ignoreTransaction(o):o).timeout(i||6e4);return X.trans?X.trans.waitFor(s):s},Promise:z,debug:{get:function(){return pt},set:function(o){zs(o)}},derive:A,extend:p,props:E,override:re,Events:fn,on:zt,liveQuery:Iu,extendObservabilitySet:go,getByKeyPath:ne,setByKeyPath:le,delByKeyPath:Be,shallowClone:mt,deepClone:rt,getObjectDiff:ba,cmp:fe,asap:me,minKey:Ji,addons:[],connections:kr,errnames:ji,dependencies:_o,cache:dr,semVer:tu,version:tu.split(".").map(function(o){return parseInt(o)}).reduce(function(o,i,s){return o+i/Math.pow(10,s*2)})})),vr.maxKey=vn(vr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(zt(dn,function(o){if(!Qt){var i;i=new CustomEvent(oa,{detail:o}),Qt=!0,dispatchEvent(i),Qt=!1}}),addEventListener(oa,function(o){var i=o.detail;Qt||Sa(i)}));function Sa(o){var i=Qt;try{Qt=!0,zt.storagemutated.fire(o),xa(o,!0)}finally{Qt=i}}var Qt=!1,Ht,Oa=function(){};typeof BroadcastChannel<"u"&&(Oa=function(){Ht=new BroadcastChannel(oa),Ht.onmessage=function(o){return o.data&&Sa(o.data)}},Oa(),typeof Ht.unref=="function"&&Ht.unref(),zt(dn,function(o){Qt||Ht.postMessage(o)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(o){if(!Rt.disableBfCache&&o.persisted){pt&&console.debug("Dexie: handling persisted pagehide"),Ht?.close();for(var i=0,s=kr;i<s.length;i++){var u=s[i];u.close({disableAutoOpen:!1})}}}),addEventListener("pageshow",function(o){!Rt.disableBfCache&&o.persisted&&(pt&&console.debug("Dexie: handling persisted pageshow"),Oa(),Sa({all:new Le(-1/0,[[]])}))}));function ch(o){return new pn({add:o})}function lh(o){return new pn({remove:o})}function fh(o,i){return new pn({replacePrefix:[o,i]})}z.rejectionMapper=Vm,zs(pt);var mh=Object.freeze({__proto__:null,Dexie:Rt,liveQuery:Iu,Entity:ou,cmp:fe,PropModSymbol:mp,PropModification:pn,replacePrefix:fh,add:ch,remove:lh,default:Rt,RangeSet:Le,mergeRanges:xn,rangesOverlap:vu});return r(Rt,mh,{default:Rt}),Rt})});function vh(e){e.__load_patch("rxjs",(t,r,n)=>{let a=r.__symbol__,c="rxjs.Subscriber.next",f="rxjs.Subscriber.error",p="rxjs.Subscriber.complete",d=Object.defineProperties,_=function(){let R=bn.prototype,I=a("_subscribe"),A=R[I]=R._subscribe;d(bn.prototype,{_zone:{value:null,writable:!0,configurable:!0},_zoneSource:{value:null,writable:!0,configurable:!0},_zoneSubscribe:{value:null,writable:!0,configurable:!0},source:{configurable:!0,get:function(){return this._zoneSource},set:function(F){this._zone=r.current,this._zoneSource=F}},_subscribe:{configurable:!0,get:function(){if(this._zoneSubscribe)return this._zoneSubscribe;if(this.constructor===bn)return A;let F=Object.getPrototypeOf(this);return F&&F._subscribe},set:function(F){this._zone=r.current,F?this._zoneSubscribe=function(){if(this._zone&&this._zone!==r.current){let B=this._zone.run(F,this,arguments);if(typeof B=="function"){let Z=this._zone;return function(){return Z!==r.current?Z.run(B,this,arguments):B.apply(this,arguments)}}else return B}else return F.apply(this,arguments)}:this._zoneSubscribe=F}},subjectFactory:{get:function(){return this._zoneSubjectFactory},set:function(F){let B=this._zone;this._zoneSubjectFactory=function(){return B&&B!==r.current?B.run(F,this,arguments):F.apply(this,arguments)}}}})};n.patchMethod(bn.prototype,"lift",R=>(I,A)=>{let F=R.apply(I,A);return F.operator&&(F.operator._zone=r.current,n.patchMethod(F.operator,"call",B=>(Z,G)=>Z._zone&&Z._zone!==r.current?Z._zone.run(B,Z,G):B.apply(Z,G))),F});let x=function(){d(Ru.prototype,{_zone:{value:null,writable:!0,configurable:!0},_zoneUnsubscribe:{value:null,writable:!0,configurable:!0},_unsubscribe:{get:function(){if(this._zoneUnsubscribe||this._zoneUnsubscribeCleared)return this._zoneUnsubscribe;let R=Object.getPrototypeOf(this);return R&&R._unsubscribe},set:function(R){this._zone=r.current,R?(this._zoneUnsubscribeCleared=!1,this._zoneUnsubscribe=function(){return this._zone&&this._zone!==r.current?this._zone.run(R,this,arguments):R.apply(this,arguments)}):(this._zoneUnsubscribe=R,this._zoneUnsubscribeCleared=!0)}}})},E=function(){let R=Xt.prototype.next,I=Xt.prototype.error,A=Xt.prototype.complete;Object.defineProperty(Xt.prototype,"destination",{configurable:!0,get:function(){return this._zoneDestination},set:function(F){this._zone=r.current,this._zoneDestination=F}}),Xt.prototype.next=function(){let F=r.current,B=this._zone;return B&&B!==F?B.run(R,this,arguments,c):R.apply(this,arguments)},Xt.prototype.error=function(){let F=r.current,B=this._zone;return B&&B!==F?B.run(I,this,arguments,f):I.apply(this,arguments)},Xt.prototype.complete=function(){let F=r.current,B=this._zone;return B&&B!==F?B.run(A,this,arguments,p):A.call(this)}};_(),x(),E()})}vh(Zone);var sc=(()=>{class e{constructor(){}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=Ku({type:e,selectors:[["app-root"]],standalone:!1,decls:2,vars:0,template:function(n,a){n&1&&(Uu(0,"ion-app"),Wu(1,"ion-router-outlet"),Vu())},dependencies:[Zu,ec],encapsulation:2})}return e})();var yh=[{path:"home",loadChildren:()=>import("./chunk-RKVZG2ZS.js").then(e=>e.HomePageModule)},{path:"",redirectTo:"home",pathMatch:"full"}],uc=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=Ao({type:e});static \u0275inj=Ro({imports:[Aa.forRoot(yh,{preloadingStrategy:Gu}),Aa]})}return e})();var gh="@",xh=(()=>{class e{doc;delegate;zone;animationType;moduleImpl;_rendererFactoryPromise=null;scheduler=null;injector=Sn(On);loadingSchedulerFn=Sn(wh,{optional:!0});_engine;constructor(r,n,a,c,f){this.doc=r,this.delegate=n,this.zone=a,this.animationType=c,this.moduleImpl=f}ngOnDestroy(){this._engine?.flush()}loadImpl(){let r=()=>this.moduleImpl??import("./chunk-72AOXERB.js").then(a=>a),n;return this.loadingSchedulerFn?n=this.loadingSchedulerFn(r):n=r(),n.catch(a=>{throw new En(5300,!1)}).then(({\u0275createEngine:a,\u0275AnimationRendererFactory:c})=>{this._engine=a(this.animationType,this.doc);let f=new c(this.delegate,this._engine,this.zone);return this.delegate=f,f})}createRenderer(r,n){let a=this.delegate.createRenderer(r,n);if(a.\u0275type===0)return a;typeof a.throwOnSyntheticProps=="boolean"&&(a.throwOnSyntheticProps=!1);let c=new Ca(a);return n?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(f=>{let p=f.createRenderer(r,n);c.use(p),this.scheduler??=this.injector.get(Nu,null,{optional:!0}),this.scheduler?.notify(10)}).catch(f=>{c.use(a)}),c}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}componentReplaced(r){this._engine?.flush(),this.delegate.componentReplaced?.(r)}static \u0275fac=function(n){ju()};static \u0275prov=Io({token:e,factory:e.\u0275fac})}return e})(),Ca=class{delegate;replay=[];\u0275type=1;constructor(t){this.delegate=t}use(t){if(this.delegate=t,this.replay!==null){for(let r of this.replay)r(t);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(t,r){return this.delegate.createElement(t,r)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}get destroyNode(){return this.delegate.destroyNode}appendChild(t,r){this.delegate.appendChild(t,r)}insertBefore(t,r,n,a){this.delegate.insertBefore(t,r,n,a)}removeChild(t,r,n){this.delegate.removeChild(t,r,n)}selectRootElement(t,r){return this.delegate.selectRootElement(t,r)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,r,n,a){this.delegate.setAttribute(t,r,n,a)}removeAttribute(t,r,n){this.delegate.removeAttribute(t,r,n)}addClass(t,r){this.delegate.addClass(t,r)}removeClass(t,r){this.delegate.removeClass(t,r)}setStyle(t,r,n,a){this.delegate.setStyle(t,r,n,a)}removeStyle(t,r,n){this.delegate.removeStyle(t,r,n)}setProperty(t,r,n){this.shouldReplay(r)&&this.replay.push(a=>a.setProperty(t,r,n)),this.delegate.setProperty(t,r,n)}setValue(t,r){this.delegate.setValue(t,r)}listen(t,r,n,a){return this.shouldReplay(r)&&this.replay.push(c=>c.listen(t,r,n,a)),this.delegate.listen(t,r,n,a)}shouldReplay(t){return this.replay!==null&&t.startsWith(gh)}},wh=new Tu("");function cc(e="animations"){return Bu("NgAsyncAnimations"),Mu([{provide:Fu,useFactory:(t,r,n)=>new xh(t,r,n,e),deps:[ku,Qu,Lu]},{provide:$u,useValue:e==="noop"?"NoopAnimations":"BrowserAnimations"}])}function lc(e,t){let n=!t?.manualCleanup?t?.injector?.get(Da)??Sn(Da):null,a=bh(t?.equal),c;t?.requireSync?c=Ia({kind:0},{equal:a}):c=Ia({kind:1,value:t?.initialValue},{equal:a});let f,p=e.subscribe({next:d=>c.set({kind:1,value:d}),error:d=>{c.set({kind:2,error:d}),f?.()},complete:()=>{f?.()}});if(t?.requireSync&&c().kind===0)throw new En(601,!1);return f=n?.onDestroy(p.unsubscribe.bind(p)),zu(()=>{let d=c();switch(d.kind){case 1:return d.value;case 2:throw d.error;case 0:throw new En(601,!1)}},{equal:t?.equal})}function bh(e=Object.is){return(t,r)=>t.kind===1&&r.kind===1&&e(t.value,r.value)}function yr(e){"@babel/helpers - typeof";return yr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yr(e)}function fc(e,t){if(yr(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(yr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mc(e){var t=fc(e,"string");return yr(t)=="symbol"?t:t+""}function pc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mc(n.key),n)}}function qe(e,t,r){return t&&pc(e.prototype,t),r&&pc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Dn(e){return Array.isArray(e)?e.slice(0):[e]}function gr(e){return Array.isArray(e)}function Po(e,t){var r=0,n=-1;for(var a of e){n=n+1;var c=t(a,n);if(c)r=r+1;else break}return r}function yt(e,t){var r=t.length;if(r!==0){var n=e.length;e.length=n+t.length;for(var a=0;a<r;++a)e[n+a]=t[a]}}function hc(e){return e.filter(function(t,r,n){return n.indexOf(t)===r})}function xr(e){for(var t="",r=0;r<e.length;r++){var n=e[r];if(n==="-")return parseInt(t,10);t+=n}throw new Error("malformatted revision: "+e)}function In(e,t){var r=t?xr(t._rev)+1:1;return r+"-"+e}function dc(e){var t=e.split("."),r=t.length;return r===1?n=>n[e]:n=>{for(var a=n,c=0;c<r;++c){var f=t[c];if(a=a[f],typeof a>"u")return a}return a}}function Ee(e){return Object.assign({},e)}function vc(e){return Object.keys(e)[0]}function Lr(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort((n,a)=>typeof n=="string"&&typeof a=="string"?n.localeCompare(a):typeof n=="object"?1:-1).map(n=>Lr(n,t));if(typeof e=="object"&&!Array.isArray(e)){var r={};return Object.keys(e).sort((n,a)=>n.localeCompare(a)).forEach(n=>{r[n]=Lr(e[n],t)}),r}return e}function Pa(e){if(!e||e===null||typeof e!="object")return e;if(Array.isArray(e)){for(var t=new Array(e.length),r=t.length;r--;)t[r]=Pa(e[r]);return t}var n={};for(var a in e)n[a]=Pa(e[a]);return n}var gt=Pa;function Ge(e,t,r){return Object.defineProperty(e,t,{get:function(){return r}}),r}var To=1;function Fr(){return{lwt:To}}function jr(){return""}function yc(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}function gc(e,t,r){if(t.length!==r.length)return!1;for(var n=0,a=t.length;n<a;){var c=t[n],f=r[n];if(n++,c[e]!==f[e]||c._rev!==f._rev||c._meta.lwt!==f._meta.lwt)return!1}return!0}function Jt(e,t){return Jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},Jt(e,t)}function Ta(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Jt(e,t)}function Mo(e){return Mo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mo(e)}function xc(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function Ma(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ma=function(){return!!e})()}function wc(e,t,r){if(Ma())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var a=new(e.bind.apply(e,n));return r&&Jt(a,r.prototype),a}function Rn(e){var t=typeof Map=="function"?new Map:void 0;return Rn=function(n){if(n===null||!xc(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(n))return t.get(n);t.set(n,a)}function a(){return wc(n,arguments,Mo(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),Jt(a,n)},Rn(e)}var we={isDevMode(){return!1},deepFreezeWhenDevMode(e){return e},tunnelErrorMessage(e){return`
        RxDB Error-Code: `+e+`.
        Hint: Error messages are not included in RxDB core to reduce build size.
        To show the full error messages and to ensure that you do not make any mistakes when using RxDB,
        use the dev-mode plugin when you are in development mode: https://rxdb.info/dev-mode.html?console=error
        `}};function _h(e){var t="";return Object.keys(e).length===0||(t+="-".repeat(20)+`
`,t+=`Parameters:
`,t+=Object.keys(e).map(r=>{var n="[object Object]";try{r==="errors"?n=e[r].map(a=>JSON.stringify(a,Object.getOwnPropertyNames(a))):n=JSON.stringify(e[r],function(a,c){return c===void 0?null:c},2)}catch{}return r+": "+n}).join(`
`),t+=`
`),t}function bc(e,t,r){return`
`+e+`
`+_h(r)}var Eh=(function(e){function t(n,a,c={}){var f,p=bc(a,n,c);return f=e.call(this,p)||this,f.code=n,f.message=p,f.url=ka(n),f.parameters=c,f.rxdb=!0,f}Ta(t,e);var r=t.prototype;return r.toString=function(){return this.message},qe(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])})(Rn(Error)),Sh=(function(e){function t(n,a,c={}){var f,p=bc(a,n,c);return f=e.call(this,p)||this,f.code=n,f.message=p,f.url=ka(n),f.parameters=c,f.rxdb=!0,f}Ta(t,e);var r=t.prototype;return r.toString=function(){return this.message},qe(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}])})(Rn(TypeError));function ka(e){return"https://rxdb.info/errors.html?console=errors#"+e}function _c(e){return`
Find out more about this error here: `+ka(e)+` 
`}function H(e,t){return new Eh(e,we.tunnelErrorMessage(e)+_c(e),t)}function Na(e,t){return new Sh(e,we.tunnelErrorMessage(e)+_c(e),t)}function ko(e){return e&&e.status===409?e:!1}var Oh={409:"document write conflict",422:"schema validation error",510:"attachment data missing"};function No(e){return H("COL20",{name:Oh[e.status],document:e.documentId,writeError:e})}var $o;function Dh(){if($o)return $o;if(typeof crypto>"u"||typeof crypto.subtle>"u"||typeof crypto.subtle.digest!="function")throw H("UT8",{args:{typeof_crypto:typeof crypto,typeof_crypto_subtle:typeof crypto?.subtle,typeof_crypto_subtle_digest:typeof crypto?.subtle?.digest}});return $o=crypto.subtle.digest.bind(crypto.subtle),$o}function Ih(e){return S(this,null,function*(){var t=new TextEncoder().encode(e),r=yield Dh()("SHA-256",t),n=Array.prototype.map.call(new Uint8Array(r),a=>("00"+a.toString(16)).slice(-2)).join("");return n})}var Bo=Ih;function Ec(){return new Promise(e=>setTimeout(e,0))}function Zt(e=0){return new Promise(t=>setTimeout(t,e))}var Rh=Promise.resolve(!0),xt=Promise.resolve(!1),Sc=Promise.resolve(null),At=Promise.resolve();function Kr(e=1e4){return typeof requestIdleCallback=="function"?new Promise(t=>{requestIdleCallback(()=>t(),{timeout:e})}):Zt(0)}var $a=At;function Oc(e=void 0){return $a=$a.then(()=>Kr(e)),$a}function Dc(e,t){return e.reduce((r,n)=>r.then(n),Promise.resolve(t))}var Ic=/\./g;var Rc="abcdefghijklmnopqrstuvwxyz";function er(e=10){for(var t="",r=0;r<e;r++)t+=Rc.charAt(Math.floor(Math.random()*Rc.length));return t}function Lo(e){e+="";var t=e.charAt(0).toUpperCase();return t+e.substr(1)}function wr(e){for(;e.charAt(0)===".";)e=e.substr(1);for(;e.slice(-1)===".";)e=e.slice(0,-1);return e}function qr(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n;if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!qr(e[n],t[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var a=Object.keys(e);if(r=a.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,a[n]))return!1;for(n=r;n--!==0;){var c=a[n];if(!qr(e[c],t[c]))return!1}return!0}return e!==e&&t!==t}var La=e=>{var t=typeof e;return e!==null&&(t==="object"||t==="function")},Ba=new Set(["__proto__","prototype","constructor"]),Ah=new Set("0123456789");function Ac(e){var t=[],r="",n="start",a=!1;for(var c of e)switch(c){case"\\":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");a&&(r+=c),n="property",a=!a;break}case".":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="property";break}if(a){a=!1,r+=c;break}if(Ba.has(r))return[];t.push(r),r="",n="property";break}case"[":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="index";break}if(a){a=!1,r+=c;break}if(n==="property"){if(Ba.has(r))return[];t.push(r),r=""}n="index";break}case"]":{if(n==="index"){t.push(Number.parseInt(r,10)),r="",n="indexEnd";break}if(n==="indexEnd")throw new Error("Invalid character after an index")}default:{if(n==="index"&&!Ah.has(c))throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");n==="start"&&(n="property"),a&&(a=!1,r+="\\"),r+=c}}switch(a&&(r+="\\"),n){case"property":{if(Ba.has(r))return[];t.push(r);break}case"index":throw new Error("Index was not closed");case"start":{t.push("");break}}return t}function Cc(e,t){if(typeof t!="number"&&Array.isArray(e)){var r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function Ch(e,t){if(Cc(e,t))throw new Error("Cannot use string index")}function Ct(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!La(e)||typeof t!="string")return r===void 0?e:r;var n=Ac(t);if(n.length===0)return r;for(var a=0;a<n.length;a++){var c=n[a];if(Cc(e,c)?e=a===n.length-1?void 0:null:e=e[c],e==null){if(a!==n.length-1)return r;break}}return e===void 0?r:e}function Fa(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!La(e)||typeof t!="string")return e;for(var n=e,a=Ac(t),c=0;c<a.length;c++){var f=a[c];Ch(e,f),c===a.length-1?e[f]=r:La(e[f])||(e[f]=typeof a[c+1]=="number"?[]:{}),e=e[f]}return n}function br(e,t){var r=e.get(t);if(typeof r>"u")throw new Error("missing value from map "+t);return r}function Ae(e,t,r,n){var a=e.get(t);return typeof a>"u"?(a=r(),e.set(t,a)):n&&n(a),a}function ve(e){var t=e.split("-"),r="RxDB";return t.forEach(n=>{r+=Lo(n)}),r+="Plugin",new Error(`You are using a function which must be overwritten by a plugin.
        You should either prevent the usage of this function or add the plugin via:
            import { `+r+" } from 'rxdb/plugins/"+e+`';
            addRxPlugin(`+r+`);
        `)}function Pc(e){var t={name:e.name,message:e.message,rxdb:e.rxdb,parameters:e.parameters,extensions:e.extensions,code:e.code,url:e.url,stack:e.stack?e.stack.replace(/\n/g,` 
 `):void 0};return t}var ja=0;function ze(){var e=Date.now();e=e+.01,e<=ja&&(e=ja+.01);var t=parseFloat(e.toFixed(2));return ja=t,t}function ue(e,t){if(!e)throw t||(t=""),new Error("ensureNotFalsy() is falsy: "+t);return e}var Fo={bufferSize:1,refCount:!0};var _r="16.20.0";var jo={};var Ph="6da4936d1425ff3a5c44c02342c6daf791d266be3ae8479b8ec59e261df41b93",qa=16,Ka=xt,Tc=!1;function Ko(){return S(this,null,function*(){return Tc||(Tc=!0,Ka=S(null,null,function*(){return!!(jo.premium&&typeof jo.premium=="string"&&(yield Bo(jo.premium))===Ph)})),Ka})}var Ua={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],createRxState:[],postCloseRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],prePrepareRxQuery:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preStorageWrite:[],preMigrateDocument:[],postMigrateDocument:[],preCloseRxDatabase:[],postRemoveRxDatabase:[],postCleanup:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function Ce(e,t){Ua[e].length>0&&Ua[e].forEach(r=>r(t))}function tr(e,t){return S(this,null,function*(){for(var r of Ua[e])yield r(t)})}function Pt(e,t){var r=t;r=r.replace(Ic,".properties."),r="properties."+r,r=wr(r);var n=Ct(e,r);return n}function Mc(e,t,r){if(typeof t.primaryKey=="string")return r;var n=An(t,r),a=r[e];if(a&&a!==n)throw H("DOC19",{args:{documentData:r,existingPrimary:a,newPrimary:n},schema:t});return r[e]=n,r}function Qe(e){return typeof e=="string"?e:e.key}function An(e,t){if(typeof e.primaryKey=="string")return t[e.primaryKey];var r=e.primaryKey;return r.fields.map(n=>{var a=Ct(t,n);if(typeof a>"u")throw H("DOC18",{args:{field:n,documentData:t}});return a}).join(r.separator)}function kc(e){var t=Lr(e,!0);return t}function Th(e){return["_deleted",e]}function qo(e){e=Ee(e);var t=Qe(e.primaryKey);e.properties=Ee(e.properties),e.additionalProperties=!1,Object.prototype.hasOwnProperty.call(e,"keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=kh,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var r=Va(e);yt(e.required,r),e.required=e.required.filter(c=>!c.includes(".")).filter((c,f,p)=>p.indexOf(c)===f),e.version=e.version||0;var n=e.indexes.map(c=>{var f=gr(c)?c.slice(0):[c];return f.includes(t)||f.push(t),f[0]!=="_deleted"&&f.unshift("_deleted"),f});n.length===0&&n.push(Th(t)),n.push(["_meta.lwt",t]),e.internalIndexes&&e.internalIndexes.map(c=>{n.push(c)});var a=new Set;return n.filter(c=>{var f=c.join(",");return a.has(f)?!1:(a.add(f),!0)}),e.indexes=n,e}var Mh=1e15,kh={type:"object",properties:{lwt:{type:"number",minimum:To,maximum:Mh,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function Va(e){var t=Object.keys(e.properties).filter(n=>e.properties[n].final),r=Qe(e.primaryKey);return t.push(r),typeof e.primaryKey!="string"&&e.primaryKey.fields.forEach(n=>t.push(n)),t}function Nc(e,t){for(var r=Object.keys(e.defaultValues),n=0;n<r.length;++n){var a=r[n];(!Object.prototype.hasOwnProperty.call(t,a)||typeof t[a]>"u")&&(t[a]=e.defaultValues[a])}return t}var Nh=(function(){function e(r,n){if(this.jsonSchema=r,this.hashFunction=n,this.indexes=$h(this.jsonSchema),this.primaryPath=Qe(this.jsonSchema.primaryKey),!r.properties[this.primaryPath].maxLength)throw H("SC39",{schema:r});this.finalFields=Va(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(n,a){this.finalFields.forEach(c=>{if(!qr(n[c],a[c]))throw H("DOC9",{dataBefore:n,dataAfter:a,fieldName:c,schema:this.jsonSchema})})},t.getDocumentPrototype=function(){var n={},a=Pt(this.jsonSchema,"");return Object.keys(a).forEach(c=>{var f=c;n.__defineGetter__(c,function(){if(!(!this.get||typeof this.get!="function")){var p=this.get(f);return p}}),Object.defineProperty(n,c+"$",{get:function(){return this.get$(f)},enumerable:!1,configurable:!1}),Object.defineProperty(n,c+"$$",{get:function(){return this.get$$(f)},enumerable:!1,configurable:!1}),Object.defineProperty(n,c+"_",{get:function(){return this.populate(f)},enumerable:!1,configurable:!1})}),Ge(this,"getDocumentPrototype",()=>n),n},t.getPrimaryOfDocumentData=function(n){return An(this.jsonSchema,n)},qe(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var r={};return Object.entries(this.jsonSchema.properties).filter(([,n])=>Object.prototype.hasOwnProperty.call(n,"default")).forEach(([n,a])=>r[n]=a.default),Ge(this,"defaultValues",r)}},{key:"hash",get:function(){return Ge(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}])})();function $h(e){return(e.indexes||[]).map(t=>gr(t)?t:[t])}function $c(e,t,r=!0){r&&Ce("preCreateRxSchema",e);var n=qo(e);n=kc(n),we.deepFreezeWhenDevMode(n);var a=new Nh(n,t);return Ce("createRxSchema",a),a}function Bc(e){return e.documentData?e.documentData:e.previousDocumentData}function Lc(e){switch(e.operation){case"INSERT":return{operation:e.operation,id:e.documentId,doc:e.documentData,previous:null};case"UPDATE":return{operation:e.operation,id:e.documentId,doc:we.deepFreezeWhenDevMode(e.documentData),previous:e.previousDocumentData?e.previousDocumentData:"UNKNOWN"};case"DELETE":return{operation:e.operation,id:e.documentId,doc:null,previous:e.previousDocumentData}}}var Bh=new Map;function Uo(e){return Ae(Bh,e,()=>{for(var t=new Array(e.events.length),r=e.events,n=e.collectionName,a=e.isLocal,c=we.deepFreezeWhenDevMode,f=0;f<r.length;f++){var p=r[f];t[f]={documentId:p.documentId,collectionName:n,isLocal:a,operation:p.operation,documentData:c(p.documentData),previousDocumentData:c(p.previousDocumentData)}}return t})}var Er="\uFFFF",Sr=Number.MIN_SAFE_INTEGER;function Fc(e,t){var r=t.selector,n=e.indexes?e.indexes.slice(0):[];t.index&&(n=[t.index]);var a=!!t.sort.find(x=>Object.values(x)[0]==="desc"),c=new Set;Object.keys(r).forEach(x=>{var E=Pt(e,x);E&&E.type==="boolean"&&Object.prototype.hasOwnProperty.call(r[x],"$eq")&&c.add(x)});var f=t.sort.map(x=>Object.keys(x)[0]),p=f.filter(x=>!c.has(x)).join(","),d=-1,_;if(n.forEach(x=>{var E=!0,R=!0,I=x.map(G=>{var re=r[G],xe=re?Object.keys(re):[],me={};if(!re||!xe.length){var be=R?Sr:Er;me={startKey:be,endKey:E?Er:Sr,inclusiveStart:!0,inclusiveEnd:!0}}else xe.forEach(ne=>{if(Vo.has(ne)){var le=re[ne],Be=Kh(ne,le);me=Object.assign(me,Be)}});return typeof me.startKey>"u"&&(me.startKey=Sr),typeof me.endKey>"u"&&(me.endKey=Er),typeof me.inclusiveStart>"u"&&(me.inclusiveStart=!0),typeof me.inclusiveEnd>"u"&&(me.inclusiveEnd=!0),R&&!me.inclusiveStart&&(R=!1),E&&!me.inclusiveEnd&&(E=!1),me}),A=I.map(G=>G.startKey),F=I.map(G=>G.endKey),B={index:x,startKeys:A,endKeys:F,inclusiveEnd:E,inclusiveStart:R,sortSatisfiedByIndex:!a&&p===x.filter(G=>!c.has(G)).join(","),selectorSatisfiedByIndex:jh(x,t.selector,A,F)},Z=qh(e,t,B);(Z>=d||t.index)&&(d=Z,_=B)}),!_)throw H("SNH",{query:t});return _}var Vo=new Set(["$eq","$gt","$gte","$lt","$lte"]),Lh=new Set(["$eq","$gt","$gte"]),Fh=new Set(["$eq","$lt","$lte"]);function jh(e,t,r,n){var a=Object.entries(t),c=a.find(([ne,le])=>{if(!e.includes(ne))return!0;var Be=Object.entries(le).find(([mt,nn])=>!Vo.has(mt));return Be});if(c||t.$and||t.$or)return!1;var f=[],p=new Set;for(var[d,_]of Object.entries(t)){if(!e.includes(d))return!1;var x=Object.keys(_).filter(ne=>Lh.has(ne));if(x.length>1)return!1;var E=x[0];if(E&&p.add(d),E!=="$eq"){if(f.length>0)return!1;f.push(E)}}var R=[],I=new Set;for(var[A,F]of Object.entries(t)){if(!e.includes(A))return!1;var B=Object.keys(F).filter(ne=>Fh.has(ne));if(B.length>1)return!1;var Z=B[0];if(Z&&I.add(A),Z!=="$eq"){if(R.length>0)return!1;R.push(Z)}}var G=0;for(var re of e){for(var xe of[p,I]){if(!xe.has(re)&&xe.size>0)return!1;xe.delete(re)}var me=r[G],be=n[G];if(me!==be&&p.size>0&&I.size>0)return!1;G++}return!0}function Kh(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}function qh(e,t,r){var n=0,a=x=>{x>0&&(n=n+x)},c=10,f=Po(r.startKeys,x=>x!==Sr&&x!==Er);a(f*c);var p=Po(r.startKeys,x=>x!==Er&&x!==Sr);a(p*c);var d=Po(r.startKeys,(x,E)=>x===r.endKeys[E]);a(d*c*1.5);var _=r.sortSatisfiedByIndex?5:0;return a(_),n}var He=class extends Error{},Cn=Symbol("missing"),qc=Object.freeze(new Error("mingo: cycle detected while processing object/array")),Ho=e=>{let t=Wo(e),r=0,n=t.length;for(;n;)r=(r<<5)-r^t.charCodeAt(--n);return r>>>0},rr=e=>typeof e!="object"&&typeof e!="function"||e===null,Uc=e=>rr(e)||Ve(e)||wt(e),Vc={undefined:1,null:2,number:3,string:4,symbol:5,object:6,array:7,arraybuffer:8,boolean:9,date:10,regexp:11,function:12},Te=(e,t)=>{e===Cn&&(e=void 0),t===Cn&&(t=void 0);let[r,n]=[e,t].map(a=>Vc[Mt(a)]||0);return r!==n?r-n:Ue(e,t)?0:e<t?-1:e>t?1:0},lt=class e extends Map{#e=Ho;#r=new Map;#t=t=>{let r=this.#e(t);return[(this.#r.get(r)||[]).find(n=>Ue(n,t)),r]};constructor(){super()}static init(t){let r=new e;return t&&(r.#e=t),r}clear(){super.clear(),this.#r.clear()}delete(t){if(rr(t))return super.delete(t);let[r,n]=this.#t(t);return super.delete(r)?(this.#r.set(n,this.#r.get(n).filter(a=>!Ue(a,r))),!0):!1}get(t){if(rr(t))return super.get(t);let[r,n]=this.#t(t);return super.get(r)}has(t){if(rr(t))return super.has(t);let[r,n]=this.#t(t);return super.has(r)}set(t,r){if(rr(t))return super.set(t,r);let[n,a]=this.#t(t);if(super.has(n))super.set(n,r);else{super.set(t,r);let c=this.#r.get(a)||[];c.push(t),this.#r.set(a,c)}return this}get size(){return super.size}};function j(e,t){if(!e)throw new He(t)}var Uh=Object.keys(Vc).reduce((e,t)=>(e["[object "+t[0].toUpperCase()+t.substring(1)+"]"]=t,e),{});function Mt(e){let t=Object.prototype.toString.call(e);return t==="[object Object]"?e?.constructor?.name?.toLowerCase()||"object":Uh[t]||t.substring(8,t.length-1).toLowerCase()}var kt=e=>typeof e=="boolean",ce=e=>typeof e=="string",Vh=e=>typeof e=="symbol",ie=e=>!isNaN(e)&&typeof e=="number";var V=Array.isArray;function de(e){if(!e)return!1;let t=Object.getPrototypeOf(e);return(t===Object.prototype||t===null)&&Mt(e)==="object"}var Wc=e=>!rr(e),Ve=e=>e instanceof Date,wt=e=>e instanceof RegExp,Pn=e=>typeof e=="function",U=e=>e==null,bt=(e,t=!0)=>!!e||t&&e==="",Je=e=>U(e)||ce(e)&&!e||V(e)&&e.length===0||de(e)&&Object.keys(e).length===0,_t=e=>V(e)?e:[e],it=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),Wh=e=>typeof ArrayBuffer<"u"&&ArrayBuffer.isView(e),Tt=(e,t)=>{if(U(e)||kt(e)||ie(e)||ce(e))return e;if(Ve(e))return new Date(e);if(wt(e))return new RegExp(e);if(Wh(e)){let r=e.constructor;return new r(e)}if(t instanceof Set||(t=new Set),t.has(e))throw qc;t.add(e);try{if(V(e)){let r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=Tt(e[n],t);return r}if(de(e)){let r={};for(let n of Object.keys(e))r[n]=Tt(e[n],t);return r}}finally{t.delete(e)}return e},jc=e=>e===Cn;function Yo(e,t){if(jc(e)||U(e))return t;if(jc(t)||U(t))return e;if(rr(e)||rr(t))return t;V(e)&&V(t)&&j(e.length===t.length,"arrays must be of equal length to merge.");for(let r of Object.keys(t))e[r]=Yo(e[r],t[r]);return e}function za(e,t=Ho){let r=[lt.init(t),lt.init(t)];if(e.length===0)return[];if(e.some(n=>n.length===0))return[];if(e.length===1)return[...e];e[e.length-1].forEach(n=>r[0].set(n,!0));for(let n=e.length-2;n>-1;n--){if(e[n].forEach(a=>{r[0].has(a)&&r[1].set(a,!0)}),r[1].size===0)return[];r.reverse(),r[1].clear()}return Array.from(r[0].keys())}function or(e,t=1){let r=new Array;function n(a,c){for(let f=0,p=a.length;f<p;f++)V(a[f])&&(c>0||c<0)?n(a[f],Math.max(-1,c-1)):r.push(a[f])}return n(e,t),r}function zh(e){let t={};for(;e;){for(let r of Object.getOwnPropertyNames(e))r in t||(t[r]=e[r]);e=Object.getPrototypeOf(e)}return t}function zc(e){for(;e;){if(Object.getOwnPropertyNames(e).includes("toString"))return e.toString!==Object.prototype.toString;e=Object.getPrototypeOf(e)}return!1}function Ue(e,t){if(e===t||Object.is(e,t))return!0;if(e===null||t===null||typeof e!=typeof t||typeof e!="object"||e.constructor!==t.constructor)return!1;if(e instanceof Date)return+e==+t;if(e instanceof RegExp)return e.toString()===t.toString();let r=e.constructor;if(r===Array||r===Object){let n=Object.keys(e).sort(),a=Object.keys(t).sort();if(n.length!==a.length)return!1;for(let c=0,f=n[c];c<n.length;f=n[++c])if(f!==a[c]||!Ue(e[f],t[f]))return!1;return!0}return zc(e)&&e.toString()===t.toString()}var Wo=(e,t)=>{if(e===null)return"null";if(e===void 0)return"undefined";if(ce(e)||ie(e)||kt(e))return JSON.stringify(e);if(Ve(e))return e.toISOString();if(wt(e)||Vh(e)||Pn(e))return e.toString();if(t instanceof Set||(t=new Set),t.has(e))throw qc;try{if(t.add(e),V(e))return"["+e.map(n=>Wo(n,t)).join(",")+"]";if(de(e))return"{"+Object.keys(e).sort().map(a=>`${a}:${Wo(e[a],t)}`).join()+"}";let r=zc(e)?e.toString():Wo(zh(e),t);return Mt(e)+"("+r+")"}finally{t.delete(e)}};function Qc(e,t){return U(e)?null:(t=t||Ho,t(e))}function Xo(e,t,r=Ho){if(e.length<1)return new Map;let n=new Map,a=new Map;for(let c=0;c<e.length;c++){let f=e[c],p=t(f,c),d=Qc(p,r);if(d===null)a.has(null)?a.get(null).push(f):a.set(null,[f]);else{let _=n.has(d)?n.get(d).find(x=>Ue(x,p)):null;U(_)?(a.set(p,[f]),n.has(d)?n.get(d).push(p):n.set(d,[p])):a.get(_).push(f)}}return a}function Wa(e,t){return Wc(e)?e[t]:void 0}function Qh(e,t){if(t<1)return e;for(;t--&&e.length===1;)e=e[0];return e}function je(e,t,r){let n=0;function a(f,p){let d=f;for(let _=0;_<p.length;_++){let x=p[_];if(/^\d+$/.exec(x)===null&&V(d)){if(_===0&&n>0)break;n+=1;let R=p.slice(_);d=d.reduce((I,A)=>{let F=a(A,R);return F!==void 0&&I.push(F),I},[]);break}else d=Wa(d,x);if(d===void 0)break}return d}let c=Uc(e)?e:a(e,t.split("."));return V(c)&&r?.unwrapArray?Qh(c,n):c}function nr(e,t,r){let n=t.indexOf("."),a=n==-1?t:t.substring(0,n),c=t.substring(n+1),f=n!=-1;if(V(e)){let _=/^\d+$/.test(a),x=_&&r?.preserveIndex?[...e]:[];if(_){let E=parseInt(a),R=Wa(e,E);f&&(R=nr(R,c,r)),r?.preserveIndex?x[E]=R:x.push(R)}else for(let E of e){let R=nr(E,t,r);r?.preserveMissing?x.push(R??Cn):(R!=null||r?.preserveIndex)&&x.push(R)}return x}let p=r?.preserveKeys?he({},e):{},d=Wa(e,a);if(f&&(d=nr(d,c,r)),d!==void 0)return p[a]=d,p}function zo(e){if(V(e))for(let t=e.length-1;t>=0;t--)e[t]===Cn?e.splice(t,1):zo(e[t]);else if(de(e))for(let t in e)it(e,t)&&zo(e[t])}var Kc=/^\d+$/;function Qo(e,t,r,n){let a=t.split("."),c=a[0],f=a.slice(1).join(".");if(a.length===1)(de(e)||V(e)&&Kc.test(c))&&r(e,c);else{n?.buildGraph&&U(e[c])&&(e[c]={});let p=e[c];if(!p)return;let d=!!(a.length>1&&Kc.test(a[1]));V(p)&&n?.descendArray&&!d?p.forEach(_=>Qo(_,f,r,n)):Qo(p,f,r,n)}}function Tn(e,t,r){Qo(e,t,(n,a)=>{n[a]=Pn(r)?r(n[a]):r},{buildGraph:!0})}function Mn(e,t,r){Qo(e,t,(n,a)=>{if(V(n)){if(/^\d+$/.test(a))n.splice(parseInt(a),1);else if(r&&r.descendArray)for(let c of n)de(c)&&delete c[a]}else de(n)&&delete n[a]},r)}var Hh=/^\$[a-zA-Z0-9_]+$/;function at(e){return Hh.test(e)}function Go(e){if(Uc(e))return wt(e)?{$regex:e}:{$eq:e};if(Wc(e)){if(!Object.keys(e).some(at))return{$eq:e};if(it(e,"$regex")){let t=he({},e);return t.$regex=new RegExp(e.$regex,e.$options),delete t.$options,t}}return e}var Vr=(e=>(e[e.CLONE_OFF=0]="CLONE_OFF",e[e.CLONE_INPUT=1]="CLONE_INPUT",e[e.CLONE_OUTPUT=2]="CLONE_OUTPUT",e[e.CLONE_ALL=3]="CLONE_ALL",e))(Vr||{}),De=class e{#e;#r;#t;constructor(t,r,n){this.#e=t,this.update(r,n)}static init(t,r,n){return t instanceof e?new e(t.#e,t.root??r,Oe(he(he({},t.#t),n),{variables:Object.assign({},t.#t?.variables,n?.variables)})):new e(t,r,n)}update(t,r){this.#r=t;let n=Object.assign({},this.#t?.variables,r?.variables);return Object.keys(n).length?this.#t=Oe(he({},r),{variables:n}):this.#t=r??{},this}getOptions(){return Object.freeze(Oe(he({},this.#e),{context:Ur.from(this.#e.context)}))}get root(){return this.#r}get local(){return this.#t}get idKey(){return this.#e.idKey}get collation(){return this.#e?.collation}get processingMode(){return this.#e?.processingMode||0}get useStrictMode(){return this.#e?.useStrictMode}get scriptEnabled(){return this.#e?.scriptEnabled}get useGlobalContext(){return this.#e?.useGlobalContext}get hashFunction(){return this.#e?.hashFunction}get collectionResolver(){return this.#e?.collectionResolver}get jsonSchemaValidator(){return this.#e?.jsonSchemaValidator}get variables(){return this.#e?.variables}get context(){return this.#e?.context}};function kn(e){return e instanceof De?e.getOptions():Object.freeze(Oe(he({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:0},e),{context:e?.context?Ur.from(e?.context):Ur.init()}))}var Ur=class e{#e=new Map;constructor(){}static init(){return new e}static from(t){let r=e.init();return U(t)||t.#e.forEach((n,a)=>r.addOperators(a,n)),r}addOperators(t,r){this.#e.has(t)||this.#e.set(t,{});for(let[n,a]of Object.entries(r))this.getOperator(t,n)||(this.#e.get(t)[n]=a);return this}getOperator(t,r){return(this.#e.get(t)??{})[r]??null}addAccumulatorOps(t){return this.addOperators("accumulator",t)}addExpressionOps(t){return this.addOperators("expression",t)}addQueryOps(t){return this.addOperators("query",t)}addPipelineOps(t){return this.addOperators("pipeline",t)}addProjectionOps(t){return this.addOperators("projection",t)}addWindowOps(t){return this.addOperators("window",t)}},Or=Ur.init();function Qa(e,t){for(let[r,n]of Object.entries(t)){j(Pn(n)&&at(r),`'${r}' is not a valid operator`);let a=Nt(e,r,null);j(!a||n===a,`${r} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case"accumulator":Or.addAccumulatorOps(t);break;case"expression":Or.addExpressionOps(t);break;case"pipeline":Or.addPipelineOps(t);break;case"projection":Or.addProjectionOps(t);break;case"query":Or.addQueryOps(t);break;case"window":Or.addWindowOps(t);break}}function Nt(e,t,r){let{context:n,useGlobalContext:a}=r||{},c=n?n.getOperator(e,t):null;return!c&&a?Or.getOperator(e,t):c}function M(e,t,r,n){let a=De.init(n,e);return r&&at(r)?Hc(e,t,r,a):Jo(e,t,a)}var Yh=["$$ROOT","$$CURRENT","$$REMOVE","$$NOW"];function Jo(e,t,r){if(ce(t)&&t.length>0&&t[0]==="$"){if(Xh.includes(t))return t;let n=r.root,a=t.split(".");if(Yh.includes(a[0])){switch(a[0]){case"$$ROOT":break;case"$$CURRENT":n=e;break;case"$$REMOVE":n=void 0;break;case"$$NOW":n=new Date;break}t=t.slice(a[0].length+1)}else if(a[0].slice(0,2)==="$$"){n=Object.assign({},r.variables,{this:e},r?.local?.variables);let c=a[0].slice(2);j(it(n,c),`Use of undefined variable: ${c}`),t=t.slice(2)}else t=t.slice(1);return t===""?n:je(n,t)}if(V(t))return t.map(n=>Jo(e,n,r));if(de(t)){let n={},a=Object.entries(t);for(let[c,f]of a){if(at(c))return j(a.length==1,"expression must have single operator."),Hc(e,f,c,r);n[c]=Jo(e,f,r)}return n}return t}function Hc(e,t,r,n){let a=Nt("expression",r,n);if(a)return a(e,t,n);let c=Nt("accumulator",r,n);return j(!!c,`accumulator '${r}' is not registered.`),V(e)||(e=Jo(e,t,n),t=null),j(V(e),`arguments must resolve to array for ${r}.`),c(e,t,n)}var Xh=["$$KEEP","$$PRUNE","$$DESCEND"];function Ne(e){return e instanceof Nn?e:new Nn(e)}function $n(...e){let t=0;return Ne(()=>{for(;t<e.length;){let r=e[t].next();if(!r.done)return r;t++}return{done:!0}})}function Gh(e){return!!e&&typeof e=="object"&&e?.next instanceof Function}function Jh(e,t){let r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}var Ha=new Error;function Zh(e,t,r){let n=!1,a=-1,c=0;return function(f){try{e:for(;!n;){let p=e();a++;let d=-1,_=t.length,x=!1;for(;++d<_;){let E=t[d];switch(E.action){case 0:p=E.func(p,a);break;case 1:if(!E.func(p,a))continue e;break;case 2:--E.count,E.count||(x=!0);break;case 3:--E.count,E.count||Jh(t,d);continue e;default:break e}}if(n=x,f)r[c++]=p;else return{value:p,done:!1}}}catch(p){if(p!==Ha)throw p}return n=!0,{done:n}}}var Nn=class{constructor(t){this.#e=[],this.#r=[],this.isDone=!1;let r;if(t instanceof Function&&(t={next:t}),Gh(t)){let n=t;r=()=>{let a=n.next();if(a.done)throw Ha;return a.value}}else if(V(t)){let n=t,a=n.length,c=0;r=()=>{if(c<a)return n[c++];throw Ha}}else if(!(t instanceof Function))throw new He("Lazy must be initialized with an array, generator, or function.");this.#t=Zh(r,this.#e,this.#r)}#e;#r;#t;push(t,r){return typeof r=="function"?this.#e.push({action:t,func:r}):typeof r=="number"&&this.#e.push({action:t,count:r}),this}next(){return this.#t()}map(t){return this.push(0,t)}filter(t){return this.push(1,t)}take(t){return t>0?this.push(2,t):this}drop(t){return t>0?this.push(3,t):this}transform(t){let r=this,n;return Ne(()=>(n||(n=Ne(t(r.value()))),n.next()))}value(){return this.isDone||(this.isDone=this.#t(!0).done),this.#r}each(t){for(;;){let r=this.next();if(r.done)break;if(t(r.value)===!1)return!1}return!0}reduce(t,r){let n=this.next();for(r===void 0&&!n.done&&(r=n.value,n=this.next());!n.done;)r=t(r,n.value),n=this.next();return r}size(){return this.reduce((t,r)=>++t,0)}[Symbol.iterator](){return this}};var Yc=(e,t,r)=>e.take(t);var Bn=(e,t,r)=>Je(t)?e:(Gc(t,r),e.map(Xc(t,De.init(r))));function Xc(e,t,r=!0){let n=t.idKey,a=Object.keys(e),c=new Array,f=new Array,p={};for(let I of a){let A=e[I];if(ie(A)||kt(A))A?f.push(I):c.push(I);else if(V(A))p[I]=F=>A.map(B=>M(F,B,null,t.update(F))??null);else if(de(A)){let F=Object.keys(A),B=F.length==1?F[0]:"",Z=Nt("projection",B,t);Z?B==="$slice"&&!_t(A[B]).every(ie)?p[I]=re=>M(re,A,I,t.update(re)):p[I]=re=>Z(re,A[B],I,t.update(re)):at(B)?p[I]=G=>M(G,A[B],B,t):(Gc(A,t),p[I]=G=>{if(!it(G,I))return M(G,A,null,t);r&&t.update(G);let re=je(G,I),xe=Xc(A,t,!1);return V(re)?re.map(xe):de(re)?xe(re):xe(G)})}else p[I]=ce(A)&&A[0]==="$"?F=>M(F,A,I,t):F=>A}let d=Object.keys(p),_=c.includes(n);if(r&&_&&c.length===1&&!f.length&&!d.length)return I=>{let A=he({},I);return delete A[n],A};let E=r&&!_&&!f.includes(n),R={preserveMissing:!0};return I=>{let A={};if(c.length&&!f.length){Yo(A,I);for(let F of c)Mn(A,F,{descendArray:!0})}for(let F of f){let B=nr(I,F,R)??{};Yo(A,B)}f.length&&zo(A);for(let F of d){let B=p[F](I);B===void 0?Mn(A,F,{descendArray:!0}):Tn(A,F,B)}return E&&it(I,n)&&(A[n]=je(I,n)),A}}function Gc(e,t){let r=!1,n=!1;for(let[a,c]of Object.entries(e))j(!a.startsWith("$"),"Field names may not start with '$'."),j(!a.endsWith(".$"),"Positional projection operator '$' is not supported."),a!==t?.idKey&&(c===0||c===!1?r=!0:(c===1||c===!0)&&(n=!0),j(!(r&&n),"Projection cannot have a mix of inclusion and exclusion."))}var Jc=(e,t,r)=>e.drop(t);var Et=(e,t,r)=>{if(Je(t)||!de(t))return e;let n=Te,a=r.collation;return de(a)&&ce(a.locale)&&(n=td(a)),e.transform(c=>{let f=Object.keys(t);for(let p of f.reverse()){let d=Xo(c,E=>je(E,p),r.hashFunction),_=Array.from(d.keys()).sort(n);t[p]===-1&&_.reverse();let x=0;for(let E of _)for(let R of d.get(E))c[x++]=R;j(x==c.length,"bug: counter must match collection size.")}return c})},ed={1:"base",2:"accent",3:"variant"};function td(e){let t={sensitivity:ed[e.strength||3],caseFirst:e.caseFirst==="off"?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:e.alternate==="shifted"};(e.caseLevel||!1)===!0&&(t.sensitivity==="base"&&(t.sensitivity="case"),t.sensitivity==="accent"&&(t.sensitivity="variant"));let r=new Intl.Collator(e.locale,t);return(n,a)=>{if(!ce(n)||!ce(a))return Te(n,a);let c=r.compare(n,a);return c<0?-1:c>0?1:0}}var rd={$sort:Et,$skip:Jc,$limit:Yc},Zo=class{#e;#r;#t;#o;#a={};#n=null;#i=[];constructor(t,r,n,a){this.#e=t,this.#r=r,this.#t=n,this.#o=a}fetch(){if(this.#n)return this.#n;this.#n=Ne(this.#e).filter(this.#r);let t=this.#o.processingMode;t&Vr.CLONE_INPUT&&this.#n.map(Tt);for(let r of["$sort","$skip","$limit"])it(this.#a,r)&&(this.#n=rd[r](this.#n,this.#a[r],this.#o));return Object.keys(this.#t).length&&(this.#n=Bn(this.#n,this.#t,this.#o)),t&Vr.CLONE_OUTPUT&&this.#n.map(Tt),this.#n}fetchAll(){let t=Ne([...this.#i]);return this.#i=[],$n(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.#a.$skip=t,this}limit(t){return this.#a.$limit=t,this}sort(t){return this.#a.$sort=t,this}collation(t){return this.#o=Oe(he({},this.#o),{collation:t}),this}next(){if(this.#i.length>0)return this.#i.pop();let t=this.fetch().next();if(!t.done)return t.value}hasNext(){if(this.#i.length>0)return!0;let t=this.fetch().next();return t.done?!1:(this.#i.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}};var nd=new Set(Array.from(["$and","$or","$nor","$expr","$jsonSchema"])),Ze=class{#e;#r;#t;constructor(t,r){this.#t=Tt(t),this.#r=kn(r),this.#e=[],this.compile()}compile(){j(de(this.#t),`query criteria must be an object: ${JSON.stringify(this.#t)}`);let t={};for(let[r,n]of Object.entries(this.#t)){if(r==="$where")j(this.#r.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true."),Object.assign(t,{field:r,expr:n});else if(nd.has(r))this.processOperator(r,r,n);else{j(!at(r),`unknown top level operator: ${r}`);for(let[a,c]of Object.entries(Go(n)))this.processOperator(r,a,c)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,r,n){let a=Nt("query",r,this.#r);j(!!a,`unknown query operator ${r}`),this.#e.push(a(t,n,this.#r))}test(t){return this.#e.every(r=>r(t))}find(t,r){return new Zo(t,n=>this.test(n),r||{},this.#r)}remove(t){return t.reduce((r,n)=>(this.test(n)||r.push(n),r),[])}};var vw=Object.freeze({R5:[10,16,25,40,63],R10:[100,125,160,200,250,315,400,500,630,800],R20:[100,112,125,140,160,180,200,224,250,280,315,355,400,450,500,560,630,710,800,900],R40:[100,106,112,118,125,132,140,150,160,170,180,190,200,212,224,236,250,265,280,300,315,355,375,400,425,450,475,500,530,560,600,630,670,710,750,800,850,900,950],R80:[103,109,115,122,128,136,145,155,165,175,185,195,206,218,230,243,258,272,290,307,325,345,365,387,412,437,462,487,515,545,575,615,650,690,730,775,825,875,925,975],"1-2-5":[10,20,50],E6:[10,15,22,33,47,68],E12:[10,12,15,18,22,27,33,39,47,56,68,82],E24:[10,11,12,13,15,16,18,20,22,24,27,30,33,36,39,43,47,51,56,62,68,75,82,91],E48:[100,105,110,115,121,127,133,140,147,154,162,169,178,187,196,205,215,226,237,249,261,274,287,301,316,332,348,365,383,402,422,442,464,487,511,536,562,590,619,649,681,715,750,787,825,866,909,953],E96:[100,102,105,107,110,113,115,118,121,124,127,130,133,137,140,143,147,150,154,158,162,165,169,174,178,182,187,191,196,200,205,210,215,221,226,232,237,243,249,255,261,267,274,280,287,294,301,309,316,324,332,340,348,357,365,374,383,392,402,412,422,432,442,453,464,475,487,499,511,523,536,549,562,576,590,604,619,634,649,665,681,698,715,732,750,768,787,806,825,845,866,887,909,931,953,976],E192:[100,101,102,104,105,106,107,109,110,111,113,114,115,117,118,120,121,123,124,126,127,129,130,132,133,135,137,138,140,142,143,145,147,149,150,152,154,156,158,160,162,164,165,167,169,172,174,176,178,180,182,184,187,189,191,193,196,198,200,203,205,208,210,213,215,218,221,223,226,229,232,234,237,240,243,246,249,252,255,258,261,264,267,271,274,277,280,284,287,291,294,298,301,305,309,312,316,320,324,328,332,336,340,344,348,352,357,361,365,370,374,379,383,388,392,397,402,407,412,417,422,427,432,437,442,448,453,459,464,470,475,481,487,493,499,505,511,517,523,530,536,542,549,556,562,569,576,583,590,597,604,612,619,626,634,642,649,657,665,673,681,690,698,706,715,723,732,741,750,759,768,777,787,796,806,816,825,835,845,856,866,876,887,898,909,920,931,942,953,965,976,988]});var el=7;var Wr=1e3*60*60*24,tl={week:Wr*el,day:Wr,hour:1e3*60*60,minute:1e3*60,second:1e3,millisecond:1},od=["monday","mon","tuesday","tue","wednesday","wed","thursday","thu","friday","fri","saturday","sat","sunday","sun"],id=new Set(od),Ow=Object.freeze({mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sun:7});var rl=Object.freeze({"%Y":{name:"year",padding:4,re:/([0-9]{4})/},"%G":{name:"year",padding:4,re:/([0-9]{4})/},"%m":{name:"month",padding:2,re:/(0[1-9]|1[012])/},"%d":{name:"day",padding:2,re:/(0[1-9]|[12][0-9]|3[01])/},"%H":{name:"hour",padding:2,re:/([01][0-9]|2[0-3])/},"%M":{name:"minute",padding:2,re:/([0-5][0-9])/},"%S":{name:"second",padding:2,re:/([0-5][0-9]|60)/},"%L":{name:"millisecond",padding:3,re:/([0-9]{3})/},"%u":{name:"weekday",padding:1,re:/([1-7])/},"%U":{name:"week",padding:2,re:/([1-4][0-9]?|5[0-3]?)/},"%V":{name:"isoWeek",padding:2,re:/([1-4][0-9]?|5[0-3]?)/},"%z":{name:"timezone",padding:2,re:/(([+-][01][0-9]|2[0-3]):?([0-5][0-9])?)/},"%Z":{name:"minuteOffset",padding:3,re:/([+-][0-9]{3})/}});var $w=Object.freeze({});var n0={week:Wr*7,day:Wr,hour:Wr/24,minute:6e4,second:1e3,millisecond:1};function ge(e){return(r,n,a)=>{let c={unwrapArray:!0},f=Math.max(1,r.split(".").length-1);return p=>{let d=je(p,r,c);return e(d,n,Oe(he({},a),{depth:f}))}}}function Ye(e){return(t,r,n)=>{let a=M(t,r,null,n);return e(...a)}}function Ln(e,t,r){return Ue(e,t)||U(e)&&U(t)?!0:V(e)?e.some(n=>Ue(n,t))||or(e,r?.depth).some(n=>Ue(n,t)):!1}function ei(e,t,r){return!Ln(e,t,r)}function Xa(e,t,r){return U(e)?t.some(n=>n===null):za([_t(e),t],r?.hashFunction).length>0}function ti(e,t,r){return!Xa(e,t,r)}function ri(e,t,r){return ai(e,t,(n,a)=>Te(n,a)<0)}function ni(e,t,r){return ai(e,t,(n,a)=>Te(n,a)<=0)}function oi(e,t,r){return ai(e,t,(n,a)=>Te(n,a)>0)}function ii(e,t,r){return ai(e,t,(n,a)=>Te(n,a)>=0)}function sl(e,t,r){return _t(e).some(n=>t.length===2&&n%t[0]===t[1])}function ul(e,t,r){let n=_t(e),a=c=>ce(c)&&bt(t.exec(c),r?.useStrictMode);return n.some(a)||or(n,1).some(a)}function cl(e,t,r){if(!V(e)||!V(t)||!e.length||!t.length)return!1;let n=!0;for(let a of t){if(!n)break;de(a)&&Object.keys(a).includes("$elemMatch")?n=Ga(e,a.$elemMatch,r):wt(a)?n=e.some(c=>typeof c=="string"&&a.test(c)):n=e.some(c=>Ue(a,c))}return n}function ll(e,t,r){return Array.isArray(e)&&e.length===t}function yd(e){return at(e)&&["$and","$or","$nor"].indexOf(e)===-1}function Ga(e,t,r){if(V(e)&&!Je(e)){let n=f=>f,a=t;Object.keys(t).every(yd)&&(a={temp:t},n=f=>({temp:f}));let c=new Ze(a,r);for(let f=0,p=e.length;f<p;f++)if(c.test(n(e[f])))return!0}return!1}var il=e=>e===null,gd={array:V,boolean:kt,bool:kt,date:Ve,number:ie,int:ie,long:ie,double:ie,decimal:ie,null:il,object:de,regexp:wt,regex:wt,string:ce,undefined:U,function:e=>{throw new He("unsupported type key `function`.")},1:ie,2:ce,3:de,4:V,6:U,8:kt,9:Ve,10:il,11:wt,16:ie,18:ie,19:ie};function al(e,t,r){let n=gd[t];return n?n(e):!1}function fl(e,t,r){return V(t)?t.findIndex(n=>al(e,n,r))>=0:al(e,t,r)}function ai(e,t,r){return _t(e).some(n=>Mt(n)===Mt(t)&&r(n,t))}var xO=Ye(ti);var zr=(e,t)=>(r,n,a)=>{j(V(n),`${e}: expression must be an array.`);let c=M(r,n,null,a);return c.some(U)?null:(j(c.every(ie),`${e}: expression must evalue to array of numbers.`),t(c))};var vD=zr("$bitAnd",e=>e.reduce((t,r)=>t&r,-1));var _D=zr("$bitOr",e=>e.reduce((t,r)=>t|r,0));var OD=zr("$bitXor",e=>e.reduce((t,r)=>t^r,0));var YD=Ye(Ln);var JD=Ye(oi);var tI=Ye(ii);var oI=Ye(ri);var sI=Ye(ni);var lI=Ye(ei);var ml=(e,t)=>{let r={};return e.split("").forEach((n,a)=>r[n]=t*(a+1)),r},VI=Oe(he(he({},ml("ABCDEFGHIKLM",1)),ml("NOPQRSTUVWXY",-1)),{Z:0});var vl={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function _e(e,t=vl){let r=Object.assign({},vl,t),n=new Set(Object.keys(r));return(a,c,f)=>{let p=M(a,c,null,f);if(n.has(`${p}`)){let d=r[`${p}`];if(d instanceof Error)throw new He(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return d}return e(p)}}var iP=_e(Math.acos,{Infinity:1/0,0:new Error});var uP=_e(Math.acosh,{Infinity:1/0,0:new Error});var fP=_e(Math.asin);var hP=_e(Math.asinh,{Infinity:1/0,"-Infinity":-1/0});var yP=_e(Math.atan);var EP=_e(Math.atanh,{1:1/0,"-1":-1/0});var DP=_e(Math.cos);var AP=_e(Math.cosh,{"-Infinity":1/0,Infinity:1/0});var Id=Math.PI/180,TP=_e(e=>e*Id,{Infinity:1/0,"-Infinity":1/0});var Rd=180/Math.PI,NP=_e(e=>e*Rd,{Infinity:1/0,"-Infinity":-1/0});var LP=_e(Math.sin);var KP=_e(Math.sinh,{"-Infinity":-1/0,Infinity:1/0});var VP=_e(Math.tan);var Ad=Number.MAX_SAFE_INTEGER,Cd=Number.MIN_SAFE_INTEGER;var gl=(e,t,r)=>{j(V(t),"Invalid expression: $and expects value to be an Array.");let n=t.map(a=>new Ze(a,r));return a=>n.every(c=>c.test(a))};var ui=(e,t,r)=>{j(V(t),"Invalid expression. $or expects value to be an Array");let n=t.map(a=>new Ze(a,r));return a=>n.some(c=>c.test(a))};var xl=(e,t,r)=>{j(V(t),"Invalid expression. $nor expects value to be an array.");let n=ui("$or",t,r);return a=>!n(a)};var wl=(e,t,r)=>{let n={};n[e]=Go(t);let a=new Ze(n,r);return c=>!a.test(c)};var Ja=ge(Ln);var Za=ge(oi);var es=ge(ii);var ts=ge(Xa);var rs=ge(ri);var ns=ge(ni);var os=ge(ei);var is=ge(ti);var bl=ge(sl);var _l=ge(ul);var zN=ge(cl);var El=ge(Ga);var Sl=ge(ll);var Ol=(e,t,r)=>{let n=e.includes("."),a=!!t;return!n||e.match(/\.\d+$/)?c=>je(c,e)!==void 0===a:c=>{let f=nr(c,e,{preserveIndex:!0}),p=je(f,e.substring(0,e.lastIndexOf(".")));return V(p)?p.some(d=>d!==void 0)===a:p!==void 0===a}};var Dl=ge(fl);var Il=!1;function Rl(e){return Il||(Qa("pipeline",{$sort:Et,$project:Bn}),Qa("query",{$and:gl,$eq:Ja,$elemMatch:El,$exists:Ol,$gt:Za,$gte:es,$in:ts,$lt:rs,$lte:ns,$ne:os,$nin:is,$mod:bl,$nor:xl,$not:wl,$or:ui,$regex:_l,$size:Sl,$type:Dl}),Il=!0),new Ze(e)}function Qr(e,t){var r=Qe(e.primaryKey);t=Ee(t);var n=gt(t);if(typeof n.skip!="number"&&(n.skip=0),n.selector?(n.selector=n.selector,Object.entries(n.selector).forEach(([E,R])=>{(typeof R!="object"||R===null)&&(n.selector[E]={$eq:R})})):n.selector={},n.index){var a=Dn(n.index);a.includes(r)||a.push(r),n.index=a}if(n.sort){var x=n.sort.find(E=>vc(E)===r);x||(n.sort=n.sort.slice(0),n.sort.push({[r]:"asc"}))}else if(n.index)n.sort=n.index.map(E=>({[E]:"asc"}));else{if(e.indexes){var c=new Set;Object.entries(n.selector).forEach(([E,R])=>{var I=!1;typeof R=="object"&&R!==null?I=!!Object.keys(R).find(A=>Vo.has(A)):I=!0,I&&c.add(E)});var f=-1,p;e.indexes.forEach(E=>{var R=gr(E)?E:[E],I=R.findIndex(A=>!c.has(A));I>0&&I>f&&(f=I,p=R)}),p&&(n.sort=p.map(E=>({[E]:"asc"})))}if(!n.sort)if(e.indexes&&e.indexes.length>0){var d=e.indexes[0],_=gr(d)?d:[d];n.sort=_.map(E=>({[E]:"asc"}))}else n.sort=[{[r]:"asc"}]}return n}function Hr(e,t){if(!t.sort)throw H("SNH",{query:t});var r=[];t.sort.forEach(a=>{var c=Object.keys(a)[0],f=Object.values(a)[0];r.push({key:c,direction:f,getValueFn:dc(c)})});var n=(a,c)=>{for(var f=0;f<r.length;++f){var p=r[f],d=p.getValueFn(a),_=p.getValueFn(c);if(d!==_){var x=p.direction==="asc"?Te(d,_):Te(_,d);return x}}};return n}function ir(e,t){if(!t.sort)throw H("SNH",{query:t});var r=Rl(t.selector),n=a=>r.test(a);return n}function Yr(e,t){return S(this,null,function*(){var r=yield e.exec();if(!r)return null;if(Array.isArray(r))return Promise.all(r.map(a=>t(a)));if(r instanceof Map)return Promise.all([...r.values()].map(a=>t(a)));var n=yield t(r);return n})}function ci(e,t){if(!t.sort)throw H("SNH",{query:t});var r=Fc(e,t);return{query:t,queryPlan:r}}var Al="_rxdb_internal";function ss(e,t){return S(this,null,function*(){var r=yield e.findDocumentsById([t],!1),n=r[0];if(n)return n})}function Xr(e,t,r,n){if(n)throw n.status===409?H("CONFLICT",{collection:e.name,id:t,writeError:n,data:r}):n.status===422?H("VD2",{collection:e.name,id:t,writeError:n,data:r}):n}function li(e,t,r,n,a,c,f){for(var p=!!e.schema.attachments,d=[],_=[],x=[],E=er(10),R={id:E,events:[],checkpoint:null,context:a},I=R.events,A=[],F=[],B=[],Z=r.size>0,G,re=n.length,xe=function(){var be=n[me],ne=be.document,le=be.previous,Be=ne[t],mt=ne._deleted,nn=le&&le._deleted,Lt=void 0;Z&&(Lt=r.get(Be));var Dt;if(Lt){var Bi=Lt._rev;if(!le||le&&Bi!==le._rev){var sr={isError:!0,status:409,documentId:Be,writeRow:be,documentInDb:Lt};return x.push(sr),1}var rt=p?as(be):be;p&&(mt?le&&Object.keys(le._attachments).forEach(Ke=>{F.push({documentId:Be,attachmentId:Ke,digest:ue(le)._attachments[Ke].digest})}):(Object.entries(ne._attachments).find(([Ke,Pe])=>{var st=le?le._attachments[Ke]:void 0;return!st&&!Pe.data&&(Dt={documentId:Be,documentInDb:Lt,isError:!0,status:510,writeRow:be,attachmentId:Ke}),!0}),Dt||Object.entries(ne._attachments).forEach(([Ke,Pe])=>{var st=le?le._attachments[Ke]:void 0;if(!st)A.push({documentId:Be,attachmentId:Ke,attachmentData:Pe,digest:Pe.digest});else{var ut=rt.document._attachments[Ke].digest;Pe.data&&st.digest!==ut&&B.push({documentId:Be,attachmentId:Ke,attachmentData:Pe,digest:Pe.digest})}}))),Dt?x.push(Dt):(p?(_.push(as(rt)),f&&f(ne)):(_.push(rt),f&&f(ne)),G=rt);var Ft=null,on=null,jt=null;if(nn&&!mt)jt="INSERT",Ft=p?St(ne):ne;else if(le&&!nn&&!mt)jt="UPDATE",Ft=p?St(ne):ne,on=le;else if(mt)jt="DELETE",Ft=ue(ne),on=le;else throw H("SNH",{args:{writeRow:be}});var an={documentId:Be,documentData:Ft,previousDocumentData:on,operation:jt};I.push(an)}else{var Hn=!!mt;if(p&&Object.entries(ne._attachments).forEach(([Ke,Pe])=>{Pe.data?A.push({documentId:Be,attachmentId:Ke,attachmentData:Pe,digest:Pe.digest}):(Dt={documentId:Be,isError:!0,status:510,writeRow:be,attachmentId:Ke},x.push(Dt))}),Dt||(p?(d.push(as(be)),c&&c(ne)):(d.push(be),c&&c(ne)),G=be),!Hn){var Yn={documentId:Be,operation:"INSERT",documentData:p?St(ne):ne,previousDocumentData:p&&le?St(le):le};I.push(Yn)}}},me=0;me<re;me++)xe();return{bulkInsertDocs:d,bulkUpdateDocs:_,newestRow:G,errors:x,eventBulk:R,attachmentsAdd:A,attachmentsRemove:F,attachmentsUpdate:B}}function as(e){return{previous:e.previous,document:St(e.document)}}function Nd(e){return atob(e).length}function $d(e){var t=e.data;if(!t)return e;var r={length:Nd(t),digest:e.digest,type:e.type};return r}function St(e){if(!e._attachments||Object.keys(e._attachments).length===0)return e;var t=Ee(e);return t._attachments={},Object.entries(e._attachments).forEach(([r,n])=>{t._attachments[r]=$d(n)}),t}function Dr(e){return Object.assign({},e,{_meta:Ee(e._meta)})}function fi(e,t,r){we.deepFreezeWhenDevMode(r);var n=Qe(t.schema.primaryKey),a={originalStorageInstance:t,schema:t.schema,internals:t.internals,collectionName:t.collectionName,databaseName:t.databaseName,options:t.options,bulkWrite(f,p){return S(this,null,function*(){for(var d=e.token,_=new Array(f.length),x=ze(),E=0;E<f.length;E++){var R=f[E],I=Dr(R.document);I._meta.lwt=x;var A=R.previous;I._rev=In(d,A),_[E]={document:I,previous:A}}Ce("preStorageWrite",{storageInstance:this.originalStorageInstance,rows:_});var F=yield e.lockedRun(()=>t.bulkWrite(_,p)),B={error:[]};Cl.set(B,_);var Z=F.error.length===0?[]:F.error.filter(ne=>ne.status===409&&!ne.writeRow.previous&&!ne.writeRow.document._deleted&&ue(ne.documentInDb)._deleted?!0:(B.error.push(ne),!1));if(Z.length>0){var G=new Set,re=Z.map(ne=>(G.add(ne.documentId),{previous:ne.documentInDb,document:Object.assign({},ne.writeRow.document,{_rev:In(e.token,ne.documentInDb)})})),xe=yield e.lockedRun(()=>t.bulkWrite(re,p));yt(B.error,xe.error);var me=ft(n,_,B,G),be=ft(n,re,xe);return yt(me,be),B}return B})},query(f){return e.lockedRun(()=>t.query(f))},count(f){return e.lockedRun(()=>t.count(f))},findDocumentsById(f,p){return e.lockedRun(()=>t.findDocumentsById(f,p))},getAttachmentData(f,p,d){return e.lockedRun(()=>t.getAttachmentData(f,p,d))},getChangedDocumentsSince:t.getChangedDocumentsSince?(f,p)=>e.lockedRun(()=>t.getChangedDocumentsSince(ue(f),p)):void 0,cleanup(f){return e.lockedRun(()=>t.cleanup(f))},remove(){return e.storageInstances.delete(a),e.lockedRun(()=>t.remove())},close(){return e.storageInstances.delete(a),e.lockedRun(()=>t.close())},changeStream(){return t.changeStream()}};return e.storageInstances.add(a),a}function mi(e){if(e.schema.keyCompression)throw H("UT5",{args:{params:e}});if(Bd(e.schema))throw H("UT6",{args:{params:e}});if(e.schema.attachments&&e.schema.attachments.compression)throw H("UT7",{args:{params:e}})}function Bd(e){return!!(e.encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)}var Cl=new WeakMap,Ld=new WeakMap;function ft(e,t,r,n){return Ae(Ld,r,()=>{var a=[],c=Cl.get(r);if(c||(c=t),r.error.length>0||n){for(var f=n||new Set,p=0;p<r.error.length;p++){var d=r.error[p];f.add(d.documentId)}for(var _=0;_<c.length;_++){var x=c[_].document;f.has(x[e])||a.push(St(x))}}else{a.length=t.length-r.error.length;for(var E=0;E<c.length;E++){var R=c[E].document;a[E]=St(R)}}return a})}var Pl=(function(){function e(r,n,a,c){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=r,this.primaryPath=n,this.preWrite=a,this.postWrite=c}var t=e.prototype;return t.addWrite=function(n,a){var c=n[this.primaryPath],f=Ae(this.queueByDocId,c,()=>[]),p=new Promise((d,_)=>{var x={lastKnownDocumentState:n,modifier:a,resolve:d,reject:_};ue(f).push(x),this.triggerRun()});return p},t.triggerRun=function(){return S(this,null,function*(){if(!(this.isRunning===!0||this.queueByDocId.size===0)){this.isRunning=!0;var n=[],a=this.queueByDocId;this.queueByDocId=new Map,yield Promise.all(Array.from(a.entries()).map(d=>S(this,[d],function*([f,p]){var _=Fd(p.map(R=>R.lastKnownDocumentState)),x=_;for(var E of p)try{x=yield E.modifier(gt(x))}catch(R){E.reject(R),E.reject=()=>{},E.resolve=()=>{}}try{yield this.preWrite(x,_)}catch(R){p.forEach(I=>I.reject(R));return}n.push({previous:_,document:x})})));var c=n.length>0?yield this.storageInstance.bulkWrite(n,"incremental-write"):{error:[]};return yield Promise.all(ft(this.primaryPath,n,c).map(f=>{var p=f[this.primaryPath];this.postWrite(f);var d=br(a,p);d.forEach(_=>_.resolve(f))})),c.error.forEach(f=>{var p=f.documentId,d=br(a,p),_=ko(f);if(_){var x=Ae(this.queueByDocId,p,()=>[]);d.reverse().forEach(R=>{R.lastKnownDocumentState=ue(_.documentInDb),ue(x).unshift(R)})}else{var E=No(f);d.forEach(R=>R.reject(E))}}),this.isRunning=!1,this.triggerRun()}})},e})();function us(e){var t=r=>S(null,null,function*(){var n=yc(r);n._deleted=r._deleted;var a=yield e(n),c=Object.assign({},a,{_meta:r._meta,_attachments:r._attachments,_rev:r._rev,_deleted:typeof a._deleted<"u"?a._deleted:r._deleted});return typeof c._deleted>"u"&&(c._deleted=!1),c});return t}function Fd(e){var t=e[0],r=xr(t._rev);return e.forEach(n=>{var a=xr(n._rev);a>r&&(t=n,r=a)}),t}var cs={get primaryPath(){var e=this;if(e.isInstanceOfRxDocument)return e.collection.schema.primaryPath},get primary(){var e=this;if(e.isInstanceOfRxDocument)return e._data[e.primaryPath]},get revision(){var e=this;if(e.isInstanceOfRxDocument)return e._data._rev},get deleted$(){var e=this;if(e.isInstanceOfRxDocument)return e.$.pipe(ot(t=>t._data._deleted))},get deleted$$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.deleted$,e.getLatest().deleted,e.collection.database)},get deleted(){var e=this;if(e.isInstanceOfRxDocument)return e._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){var e=this,t=this.primary;return e.collection.eventBulks$.pipe(ke(r=>!r.isLocal),ot(r=>r.events.find(n=>n.documentId===t)),ke(r=>!!r),ot(r=>Bc(ue(r))),Do(e.collection._docCache.getLatestDocumentData(t)),_n((r,n)=>r._rev===n._rev),ot(r=>this.collection._docCache.getCachedRxDocument(r)),Oo(Fo))},get $$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.$,e.getLatest()._data,e.collection.database)},get$(e){if(we.isDevMode()){if(e.includes(".item."))throw H("DOC1",{path:e});if(e===this.primaryPath)throw H("DOC2");if(this.collection.schema.finalFields.includes(e))throw H("DOC3",{path:e});var t=Pt(this.collection.schema.jsonSchema,e);if(!t)throw H("DOC4",{path:e})}return this.$.pipe(ot(r=>Ct(r,e)),_n())},get$$(e){var t=this.get$(e),r=this.collection.database.getReactivityFactory();return r.fromObservable(t,this.getLatest().get(e),this.collection.database)},populate(e){var t=Pt(this.collection.schema.jsonSchema,e),r=this.get(e);if(!r)return Sc;if(!t)throw H("DOC5",{path:e});if(!t.ref)throw H("DOC6",{path:e,schemaObj:t});var n=this.collection.database.collections[t.ref];if(!n)throw H("DOC7",{ref:t.ref,path:e,schemaObj:t});return t.type==="array"?n.findByIds(r).exec().then(a=>{var c=a.values();return Array.from(c)}):n.findOne(r).exec()},get(e){return kl(this,e)},toJSON(e=!1){if(e)return we.deepFreezeWhenDevMode(this._data);var t=Ee(this._data);return delete t._rev,delete t._attachments,delete t._deleted,delete t._meta,we.deepFreezeWhenDevMode(t)},toMutableJSON(e=!1){return gt(this.toJSON(e))},update(e){throw ve("update")},incrementalUpdate(e){throw ve("update")},updateCRDT(e){throw ve("crdt")},putAttachment(){throw ve("attachments")},putAttachmentBase64(){throw ve("attachments")},getAttachment(){throw ve("attachments")},allAttachments(){throw ve("attachments")},get allAttachments$(){throw ve("attachments")},modify(e,t){return S(this,null,function*(){var r=this._data,n=yield us(e)(r);return this._saveData(n,r)})},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,us(e)).then(r=>this.collection._docCache.getCachedRxDocument(r))},patch(e){var t=this._data,r=gt(t);return Object.entries(e).forEach(([n,a])=>{r[n]=a}),this._saveData(r,t)},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([r,n])=>{t[r]=n}),t))},_saveData(e,t){return S(this,null,function*(){if(e=Ee(e),this._data._deleted)throw H("DOC11",{id:this.primary,document:this});yield ls(this.collection,e,t);var r=[{previous:t,document:e}],n=yield this.collection.storageInstance.bulkWrite(r,"rx-document-save-data"),a=n.error[0];return Xr(this.collection,this.primary,e,a),yield this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument(ft(this.collection.schema.primaryPath,r,n)[0])})},remove(){return S(this,null,function*(){if(this.deleted)return Promise.reject(H("DOC13",{document:this,id:this.primary}));var e=yield this.collection.bulkRemove([this]);if(e.error.length>0){var t=e.error[0];Xr(this.collection,this.primary,this._data,t)}return e.success[0]})},incrementalRemove(){return this.incrementalModify(e=>S(this,null,function*(){return yield this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e})).then(e=>S(this,null,function*(){return yield this.collection._runHooks("post","remove",e._data,e),e}))},close(){throw H("DOC14")}};function Tl(e=cs){var t=function(n,a){this.collection=n,this._data=a,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0};return t.prototype=e,t}function Ml(e,t,r){var n=new e(t,r);return Ce("createRxDocument",n),n}function ls(e,t,r){return t._meta=Object.assign({},r._meta,t._meta),we.isDevMode()&&e.schema.validateChange(r,t),e._runHooks("pre","save",t,r)}function kl(e,t){return Ae(e._propertyCache,t,()=>{var r=Ct(e._data,t);if(typeof r!="object"||r===null||Array.isArray(r))return we.deepFreezeWhenDevMode(r);var n=new Proxy(Ee(r),{get(a,c){if(typeof c!="string")return a[c];var f=c.charAt(c.length-1);if(f==="$")if(c.endsWith("$$")){var p=c.slice(0,-2);return e.get$$(wr(t+"."+p))}else{var d=c.slice(0,-1);return e.get$(wr(t+"."+d))}else if(f==="_"){var _=c.slice(0,-1);return e.populate(wr(t+"."+_))}else{var x=a[c];return typeof x=="number"||typeof x=="string"||typeof x=="boolean"?x:kl(e,wr(t+"."+c))}}});return n})}function pi(e){return e[e.length-1]}function jd(e){let t=typeof e;return e!==null&&(t==="object"||t==="function")}function fs(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!jd(e)||typeof t!="string")return r===void 0?e:r;let n=t.split(".");if(n.length===0)return r;for(let a=0;a<n.length;a++){let c=n[a];if(Kd(e,c)?e=a===n.length-1?void 0:null:e=e[c],e==null){if(a!==n.length-1)return r;break}}return e===void 0?r:e}function Kd(e,t){if(typeof t!="number"&&Array.isArray(e)){let r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}var ms=e=>!!e.queryParams.limit,Nl=e=>e.queryParams.limit===1,$l=e=>!!(e.queryParams.skip&&e.queryParams.skip>0),Bl=e=>e.changeEvent.operation==="DELETE",Ll=e=>e.changeEvent.operation==="INSERT",Fl=e=>e.changeEvent.operation==="UPDATE",jl=e=>ms(e)&&e.previousResults.length>=e.queryParams.limit,Kl=e=>{let t=e.queryParams.sortFields,r=e.changeEvent.previous,n=e.changeEvent.doc;if(!n)return!1;if(!r)return!0;for(let a=0;a<t.length;a++){let c=t[a],f=fs(r,c),p=fs(n,c);if(f!==p)return!0}return!1},ql=e=>{let t=e.changeEvent.id;if(e.keyDocumentMap)return e.keyDocumentMap.has(t);{let r=e.queryParams.primaryKey,n=e.previousResults;for(let a=0;a<n.length;a++)if(n[a][r]===t)return!0;return!1}},Ul=e=>{let t=e.previousResults[0];return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Vl=e=>{let t=pi(e.previousResults);return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Wl=e=>{let t=e.changeEvent.previous;if(!t)return!1;let r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},zl=e=>{let t=e.changeEvent.previous;if(!t)return!1;let r=pi(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},Ql=e=>{let t=e.changeEvent.doc;if(!t)return!1;let r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},Hl=e=>{let t=e.changeEvent.doc;if(!t)return!1;let r=pi(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},Yl=e=>{let t=e.changeEvent.previous;return t?e.queryParams.queryMatcher(t):!1},Xl=e=>{let t=e.changeEvent.doc;return t?e.queryParams.queryMatcher(t):!1},Gl=e=>e.previousResults.length===0;var Jl={0:Ll,1:Fl,2:Bl,3:ms,4:Nl,5:$l,6:Gl,7:jl,8:Ul,9:Vl,10:Kl,11:ql,12:Wl,13:zl,14:Ql,15:Hl,16:Yl,17:Xl};function Zl(e,t,r,n){var a=e.length,c=a-1,f=0;if(a===0)return e.push(t),0;for(var p;n<=c;)f=n+(c-n>>1),p=e[f],r(p,t)<=0?n=f+1:c=f-1;return r(p,t)<=0&&f++,e.splice(f,0,t),f}var ef=e=>{},hi=e=>{e.previousResults.unshift(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},di=e=>{e.previousResults.push(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},vi=e=>{let t=e.previousResults.shift();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},yi=e=>{let t=e.previousResults.pop();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},tf=e=>{vi(e),di(e)},rf=e=>{yi(e),hi(e)},nf=e=>{vi(e),hi(e)},of=e=>{yi(e),di(e)},ps=e=>{e.keyDocumentMap&&e.keyDocumentMap.delete(e.changeEvent.id);let t=e.queryParams.primaryKey,r=e.previousResults;for(let n=0;n<r.length;n++)if(r[n][t]===e.changeEvent.id){r.splice(n,1);break}},af=e=>{let t=e.changeEvent.doc,r=e.queryParams.primaryKey,n=e.previousResults;for(let a=0;a<n.length;a++)if(n[a][r]===e.changeEvent.id){n[a]=t,e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,t);break}},sf=e=>{let t={_id:"wrongHuman"+new Date().getTime()};e.previousResults.length=0,e.previousResults.push(t),e.keyDocumentMap&&(e.keyDocumentMap.clear(),e.keyDocumentMap.set(t._id,t))},hs=e=>{let t=e.changeEvent.id,r=e.changeEvent.doc;if(e.keyDocumentMap){if(e.keyDocumentMap.has(t))return;e.keyDocumentMap.set(t,r)}else if(e.previousResults.find(a=>a[e.queryParams.primaryKey]===t))return;Zl(e.previousResults,r,e.queryParams.sortComparator,0)},uf=e=>{ps(e),hs(e)},cf=e=>{throw new Error("Action runFullQueryAgain must be implemented by yourself")},lf=e=>{throw new Error("Action unknownAction should never be called")};var ff=["doNothing","insertFirst","insertLast","removeFirstItem","removeLastItem","removeFirstInsertLast","removeLastInsertFirst","removeFirstInsertFirst","removeLastInsertLast","removeExisting","replaceExisting","alwaysWrong","insertAtSortPosition","removeExistingAndInsertAtSortPosition","runFullQueryAgain","unknownAction"],mf={doNothing:ef,insertFirst:hi,insertLast:di,removeFirstItem:vi,removeLastItem:yi,removeFirstInsertLast:tf,removeLastInsertFirst:rf,removeFirstInsertFirst:nf,removeLastInsertLast:of,removeExisting:ps,replaceExisting:af,alwaysWrong:sf,insertAtSortPosition:hs,removeExistingAndInsertAtSortPosition:uf,runFullQueryAgain:cf,unknownAction:lf};function gi(e){return e.charCodeAt(0)-40}function pf(e){return e?"1":"0"}function qd(e=6){let t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length;for(let a=0;a<e;a++)t+=r.charAt(Math.floor(Math.random()*n));return t}var cB=qd(4);function ds(e,t){let r=[];for(let n=0,a=e.length;n<a;n+=t)r.push(e.substring(n,n+t));return r}function hf(e){let t=new Map,n=2+parseInt(e.charAt(0)+e.charAt(1),10)*2,a=e.substring(2,n),c=ds(a,2);for(let F=0;F<c.length;F++){let B=c[F],Z=B.charAt(0),G=gi(B.charAt(1));t.set(Z,G)}let f=e.substring(n,e.length-3),p=ds(f,4);for(let F=0;F<p.length;F++){let B=p[F],Z=B.charAt(0),G=B.charAt(1),re=B.charAt(2),xe=gi(B.charAt(3));if(!t.has(G))throw new Error("missing node with id "+G);if(!t.has(re))throw new Error("missing node with id "+re);let me=t.get(G),be=t.get(re),ne={l:xe,0:me,1:be};t.set(Z,ne)}let d=e.slice(-3),_=d.charAt(0),x=d.charAt(1),E=gi(d.charAt(2)),R=t.get(_),I=t.get(x);return{l:E,0:R,1:I}}function df(e,t,r){let n=e,a=e.l;for(;;){let c=t[a](r),f=pf(c);if(n=n[f],typeof n=="number"||typeof n=="string")return n;a=n.l}}var Ud="14a1b,c+d2e5f0g/h.i4j*k-l)m(n6oeh6pnm6qen6ril6snh6tin6ubo9vce9wmh9xns9yne9zmi9{cm9|ad9}cp9~aq9\x7Fae9\xA1bf9\xA2bq9\xA3cg9\xA4ck9\xA5cn9\xA6nd9\xA7np9\xA8nq9\xA9nf9\xAAng9\xABnm9\xACnk9\xADmr9\xAEms9\xAFmt9\xB0mj9\xB1mk9\xB2ml9\xB3mn9\xB4mc8\xB5\xB3{8\xB6\xAF}8\xB7\xB0\xA48\xB8\xB3\xA78\xB9mn8\xBA\xB3\xAB8\xBB\xB3m8\xBCm\xB44\xBDz\xB24\xBE\xB3w4\xBFz\xB54\xC0\xAF\xB64\xC1\xB0\xB74\xC2\xB3\xBA4\xC3\xB3\xB84\xC4m\xB94\xC5v\xA47\xC6yn7\xC7\xC0\xC17\xC8~\x7F7\xC9\xA5\xA47\xCA\xC3\xC47\xCB\xA8n7\xCC\xBA\xB97\xCD\xAD\xB07\xCE\xAEm7\xCF\xAF\xB07\xD0\xB1m7\xD1\xB3m7\xD2\xBCm5\xD3\xC4m5\xD4\xB9m5\xD5\xBD\xB05\xD6\xBEm5\xD7\xBF\xB05\xD8\xC7\xCF5\xD9\xC2m5\xDA\xCA\xD15\xDB\xB1m5\xDC\xBAm5\xDD\xCC\xD15\xDE\xD5\xCD2\xDF|\x7F2\xE0\xA1u2\xE1\xA3\xC52\xE2\xD6\xCE2\xE3\xA6\xC62\xE4\xA9x2\xE5\xAA\xC62\xE6\xD7\xD82\xE7|\xC82\xE8\xA1\xA22\xE9\xA3\xC92\xEA\xA4\xA52\xEB\xD9\xDA2\xEC\xA6\xCB2\xED\xA9n2\xEE\xAAn2\xEF\xDB\xD02\xF0\xDC\xDD2\xF1\xACn2\xF2\xD2\xD3/\xF3an/\xF4bn/\xF5cn/\xF6\xDE\xE2/\xF7\xDF\xE3/\xF8\xE0\xE4/\xF9\xE1\xE5/\xFA\xE6\xEB/\xFB\xE7\xEC/\xFC\xE8\xED/\xFD\xE9\xEE/\xFE\xCD\xCE/\xFF\xCF\xD1/\u0100\xF2\xD4,\u0101cn,\u0102\xF6\xEF,\u0103\xA4\xF1,\u0104\xFA\xF0,\u0105\xEA\xF1,\u0106\xFE\xD0,\u0107\xFF\xD1,\u0108ac0\u0109bc0\u010A\xF3\xF50\u010B\xF4\u01010\u010C\xDF\xE10\u010D\xE0\xA40\u010E\xE7\xE90\u010F\xE8\xEA0\u0110\xF7\xF90\u0111\xF8\u01030\u0112\xFB\xFD0\u0113\xFC\u01050\u0114m\xD2-\u0115m\u0100-\u0116\xDE\xE6-\u0117\u010C\u010E-\u0118\u010D\u010F-\u0119\u0102\u0104-\u011A\u0110\u0112-\u011B\u0111\u0113-\u011C\xB2\xBB-\u011D\xCD\xCF-\u011E\u0106\u0107-\u011F\xB2\xB3-\u0120\u0114\u01083\u0121\u0115\u010A3\u0122\u0116\u01173\u0123\u0119\u011A3\u0124\u0122\u011D(\u0125\u011C\u011F(\u0126\u0123\u011E(\u0127\u0120\u0121+\u0128\u0109\u010B+\u0129\u0124\u0126+\u012A\u0118\u011B+\u012B\u0127\u01281\u012C\u0129\u012A1\u012D\u012C\u012B*\u012E\u0125m*\u012D\u012E.",vs;function Vd(){return vs||(vs=hf(Ud)),vs}var vf=e=>df(Vd(),Jl,e);function yf(e){let t=vf(e);return ff[t]}function gf(e,t,r,n,a){let c=mf[e];return c({queryParams:t,changeEvent:r,previousResults:n,keyDocumentMap:a}),n}function Wd(e,t){return!t.sort||t.sort.length===0?[e]:t.sort.map(r=>Object.keys(r)[0])}var zd=new WeakMap;function Qd(e){return Ae(zd,e,()=>{var t=e.collection,r=Qr(t.storageInstance.schema,gt(e.mangoQuery)),n=t.schema.primaryPath,a=Hr(t.schema.jsonSchema,r),c=(_,x)=>{var E={docA:_,docB:x,rxQuery:e};return a(E.docA,E.docB)},f=ir(t.schema.jsonSchema,r),p=_=>{var x={doc:_,rxQuery:e};return f(x.doc)},d={primaryKey:e.collection.schema.primaryPath,skip:r.skip,limit:r.limit,sortFields:Wd(n,r),sortComparator:c,queryMatcher:p};return d})}function xf(e,t){if(!e.collection.database.eventReduce)return{runFullQueryAgain:!0};for(var r=Qd(e),n=ue(e._result).docsData.slice(0),a=ue(e._result).docsDataMap,c=!1,f=[],p=0;p<t.length;p++){var d=t[p],_=Lc(d);_&&f.push(_)}var x=f.find(E=>{var R={queryParams:r,changeEvent:E,previousResults:n,keyDocumentMap:a},I=yf(R);if(I==="runFullQueryAgain")return!0;if(I!=="doNothing")return c=!0,gf(I,r,E,n,a),!1});return x?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:c,newResults:n}}var Hd=(function(){function e(){this._map=new Map}var t=e.prototype;return t.getByQuery=function(n){var a=n.toString(),c=Ae(this._map,a,()=>n);return c},e})();function bf(){return new Hd}function wf(e,t){t.uncached=!0;var r=t.toString();e._map.delete(r)}function Yd(e){return e.refCount$.observers.length}var Xd=100,Gd=30*1e3,Jd=(e,t)=>(r,n)=>{if(!(n._map.size<e)){var a=ze()-t,c=[],f=Array.from(n._map.values());for(var p of f)if(!(Yd(p)>0)){if(p._lastEnsureEqual===0&&p._creationTime<a){wf(n,p);continue}c.push(p)}var d=c.length-e;if(!(d<=0)){var _=c.sort((E,R)=>E._lastEnsureEqual-R._lastEnsureEqual),x=_.slice(0,d);x.forEach(E=>wf(n,E))}}},gs=Jd(Xd,Gd),ys=new WeakSet;function _f(e){ys.has(e)||(ys.add(e),Ec().then(()=>Oc(200)).then(()=>{e.closed||e.cacheReplacementPolicy(e,e._queryCache),ys.delete(e)}))}var Sf=(function(){function e(r,n,a){this.cacheItemByDocId=new Map,this.tasks=new Set,this.registry=typeof FinalizationRegistry=="function"?new FinalizationRegistry(c=>{var f=c.docId,p=this.cacheItemByDocId.get(f);p&&(p[0].delete(c.revisionHeight+c.lwt+""),p[0].size===0&&this.cacheItemByDocId.delete(f))}):void 0,this.primaryPath=r,this.changes$=n,this.documentCreator=a,n.subscribe(c=>{this.tasks.add(()=>{for(var f=this.cacheItemByDocId,p=0;p<c.length;p++){var d=c[p],_=f.get(d.documentId);if(_){var x=d.documentData;x||(x=d.previousDocumentData),_[1]=x}}}),this.tasks.size<=1&&Kr().then(()=>{this.processTasks()})})}var t=e.prototype;return t.processTasks=function(){if(this.tasks.size!==0){var n=Array.from(this.tasks);n.forEach(a=>a()),this.tasks.clear()}},t.getLatestDocumentData=function(n){this.processTasks();var a=br(this.cacheItemByDocId,n);return a[1]},t.getLatestDocumentDataIfExists=function(n){this.processTasks();var a=this.cacheItemByDocId.get(n);if(a)return a[1]},qe(e,[{key:"getCachedRxDocuments",get:function(){var r=Ef(this);return Ge(this,"getCachedRxDocuments",r)}},{key:"getCachedRxDocument",get:function(){var r=Ef(this);return Ge(this,"getCachedRxDocument",n=>r([n])[0])}}])})();function Ef(e){var t=e.primaryPath,r=e.cacheItemByDocId,n=e.registry,a=we.deepFreezeWhenDevMode,c=e.documentCreator,f=p=>{for(var d=new Array(p.length),_=[],x=0;x<p.length;x++){var E=p[x],R=E[t],I=xr(E._rev),A=void 0,F=void 0,B=r.get(R);B?(A=B[0],F=A.get(I+E._meta.lwt+"")):(A=new Map,B=[A,E],r.set(R,B));var Z=F?F.deref():void 0;Z||(E=a(E),Z=c(E),A.set(I+E._meta.lwt+"",ev(Z)),n&&_.push(Z)),d[x]=Z}return _.length>0&&n&&(e.tasks.add(()=>{for(var G=0;G<_.length;G++){var re=_[G];n.register(re,{docId:re.primary,revisionHeight:xr(re.revision),lwt:re._data._meta.lwt})}}),e.tasks.size<=1&&Kr().then(()=>{e.processTasks()})),d};return f}function jn(e,t){var r=e.getCachedRxDocuments;return r(t)}var Zd=typeof WeakRef=="function",ev=Zd?tv:rv;function tv(e){return new WeakRef(e)}function rv(e){return{deref(){return e}}}var xs=(function(){function e(r,n,a){this.time=ze(),this.query=r,this.count=a,this.documents=jn(this.query.collection._docCache,n)}var t=e.prototype;return t.getValue=function(n){var a=this.query.op;if(a==="count")return this.count;if(a==="findOne"){var c=this.documents.length===0?null:this.documents[0];if(!c&&n)throw H("QU10",{collection:this.query.collection.name,query:this.query.mangoQuery,op:a});return c}else return a==="findByIds"?this.docsMap:this.documents.slice(0)},qe(e,[{key:"docsData",get:function(){return Ge(this,"docsData",this.documents.map(r=>r._data))}},{key:"docsDataMap",get:function(){var r=new Map;return this.documents.forEach(n=>{r.set(n.primary,n._data)}),Ge(this,"docsDataMap",r)}},{key:"docsMap",get:function(){for(var r=new Map,n=this.documents,a=0;a<n.length;a++){var c=n[a];r.set(c.primary,c)}return Ge(this,"docsMap",r)}}])})();var nv=0,ov=function(){return++nv},iv=(function(){function e(r,n,a,c={}){this.id=ov(),this._execOverDatabaseCount=0,this._creationTime=ze(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new So(null),this._result=null,this._latestChangeEvent=-1,this._ensureEqualQueue=xt,this.op=r,this.mangoQuery=n,this.collection=a,this.other=c,n||(this.mangoQuery=Kn()),this.isFindOneByIdQuery=cv(this.collection.schema.primaryPath,n)}var t=e.prototype;return t._setResultData=function(n){if(typeof n>"u")throw H("QU18",{database:this.collection.database.name,collection:this.collection.name});if(typeof n=="number"){this._result=new xs(this,[],n);return}else n instanceof Map&&(n=Array.from(n.values()));var a=new xs(this,n,n.length);this._result=a},t._execOverDatabase=function(){return S(this,null,function*(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,this.op==="count"){var n=this.getPreparedQuery(),a=yield this.collection.storageInstance.count(n);if(a.mode==="slow"&&!this.collection.database.allowSlowCount)throw H("QU14",{collection:this.collection,queryObj:this.mangoQuery});return a.count}if(this.op==="findByIds"){var c=ue(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,f=new Map,p=[];if(c.forEach(x=>{var E=this.collection._docCache.getLatestDocumentDataIfExists(x);if(E){if(!E._deleted){var R=this.collection._docCache.getCachedRxDocument(E);f.set(x,R)}}else p.push(x)}),p.length>0){var d=yield this.collection.storageInstance.findDocumentsById(p,!1);d.forEach(x=>{var E=this.collection._docCache.getCachedRxDocument(x);f.set(E.primary,E)})}return f}var _=uv(this);return _.then(x=>x)})},t.exec=function(n){return S(this,null,function*(){if(n&&this.op!=="findOne")throw H("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});yield Of(this);var a=ue(this._result);return a.getValue(n)})},t.toString=function(){var n=Lr({op:this.op,query:Qr(this.collection.schema.jsonSchema,this.mangoQuery),other:this.other},!0),a=JSON.stringify(n);return this.toString=()=>a,a},t.getPreparedQuery=function(){var n={rxQuery:this,mangoQuery:Qr(this.collection.schema.jsonSchema,this.mangoQuery)};n.mangoQuery.selector._deleted={$eq:!1},n.mangoQuery.index&&n.mangoQuery.index.unshift("_deleted"),Ce("prePrepareQuery",n);var a=ci(this.collection.schema.jsonSchema,n.mangoQuery);return this.getPreparedQuery=()=>a,a},t.doesDocumentDataMatch=function(n){return n._deleted?!1:this.queryMatcher(n)},t.remove=function(){return S(this,null,function*(){var n=yield this.exec();if(Array.isArray(n)){var a=yield this.collection.bulkRemove(n);if(a.error.length>0)throw No(a.error[0]);return a.success}else return n.remove()})},t.incrementalRemove=function(){return Yr(this.asRxQuery,n=>n.incrementalRemove())},t.update=function(n){throw ve("update")},t.patch=function(n){return Yr(this.asRxQuery,a=>a.patch(n))},t.incrementalPatch=function(n){return Yr(this.asRxQuery,a=>a.incrementalPatch(n))},t.modify=function(n){return Yr(this.asRxQuery,a=>a.modify(n))},t.incrementalModify=function(n){return Yr(this.asRxQuery,a=>a.incrementalModify(n))},t.where=function(n){throw ve("query-builder")},t.sort=function(n){throw ve("query-builder")},t.skip=function(n){throw ve("query-builder")},t.limit=function(n){throw ve("query-builder")},qe(e,[{key:"$",get:function(){if(!this._$){var r=this.collection.eventBulks$.pipe(ke(n=>!n.isLocal),Do(null),Br(()=>Of(this)),ot(()=>this._result),Oo(Fo),_n((n,a)=>!!(n&&n.time===ue(a).time)),ke(n=>!!n),ot(n=>ue(n).getValue()));this._$=Cu(r,this.refCount$.pipe(ke(()=>!1)))}return this._$}},{key:"$$",get:function(){var r=this.collection.database.getReactivityFactory();return r.fromObservable(this.$,void 0,this.collection.database)}},{key:"queryMatcher",get:function(){var r=this.collection.schema.jsonSchema,n=Qr(this.collection.schema.jsonSchema,this.mangoQuery);return Ge(this,"queryMatcher",ir(r,n))}},{key:"asRxQuery",get:function(){return this}}])})();function Kn(){return{selector:{}}}function av(e){return e.collection._queryCache.getByQuery(e)}function Gr(e,t,r,n){Ce("preCreateRxQuery",{op:e,queryObj:t,collection:r,other:n});var a=new iv(e,t,r,n);return a=av(a),_f(r),a}function Df(e){var t=e.asRxQuery.collection._changeEventBuffer.getCounter();return e._latestChangeEvent>=t}function Of(e){return S(this,null,function*(){return e.collection.awaitBeforeReads.size>0&&(yield Promise.all(Array.from(e.collection.awaitBeforeReads).map(t=>t()))),e.collection.database.closed||Df(e)?!1:(e._ensureEqualQueue=e._ensureEqualQueue.then(()=>sv(e)),e._ensureEqualQueue)})}function sv(e){if(e._lastEnsureEqual=ze(),e.collection.database.closed||Df(e))return xt;var t=!1,r=!1;if(e._latestChangeEvent===-1&&(r=!0),!r){var n=e.asRxQuery.collection._changeEventBuffer.getFrom(e._latestChangeEvent+1);if(n===null)r=!0;else{e._latestChangeEvent=e.asRxQuery.collection._changeEventBuffer.getCounter();var a=e.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(n);if(e.op==="count"){var c=ue(e._result).count,f=c;a.forEach(d=>{var _=d.previousDocumentData&&e.doesDocumentDataMatch(d.previousDocumentData),x=e.doesDocumentDataMatch(d.documentData);!_&&x&&f++,_&&!x&&f--}),f!==c&&(t=!0,e._setResultData(f))}else{var p=xf(e,a);p.runFullQueryAgain?r=!0:p.changed&&(t=!0,e._setResultData(p.newResults))}}}return r?e._execOverDatabase().then(d=>(e._latestChangeEvent=e.collection._changeEventBuffer.getCounter(),typeof d=="number"?((!e._result||d!==e._result.count)&&(t=!0,e._setResultData(d)),t):((!e._result||!gc(e.collection.schema.primaryPath,d,e._result.docsData))&&(t=!0,e._setResultData(d)),t))):Promise.resolve(t)}function uv(e){return S(this,null,function*(){var t=[],r=e.collection;if(e.isFindOneByIdQuery)if(Array.isArray(e.isFindOneByIdQuery)){var n=e.isFindOneByIdQuery;if(n=n.filter(x=>{var E=e.collection._docCache.getLatestDocumentDataIfExists(x);return E?(E._deleted||t.push(E),!1):!0}),n.length>0){var a=yield r.storageInstance.findDocumentsById(n,!1);yt(t,a)}}else{var c=e.isFindOneByIdQuery,f=e.collection._docCache.getLatestDocumentDataIfExists(c);if(!f){var p=yield r.storageInstance.findDocumentsById([c],!1);p[0]&&(f=p[0])}f&&!f._deleted&&t.push(f)}else{var d=e.getPreparedQuery(),_=yield r.storageInstance.query(d);t=_.documents}return t})}function cv(e,t){if(!t.skip&&t.selector&&Object.keys(t.selector).length===1&&t.selector[e]){var r=t.selector[e];if(typeof r=="string")return r;if(Object.keys(r).length===1&&typeof r.$eq=="string"||Object.keys(r).length===1&&Array.isArray(r.$eq)&&!r.$eq.find(n=>typeof n!="string"))return r.$eq}return!1}var Jr="collection",ws="storage-token",lv="rx-migration-status",fv="rx-pipeline-checkpoint",mv="RxInternalDocument",xi=qo({version:0,title:mv,primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[Jr,ws,lv,fv,"OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}});function wi(e,t){return An(xi,{key:e,context:t})}function bi(e){return S(this,null,function*(){var t=ci(e.schema,{selector:{context:Jr,_deleted:{$eq:!1}},sort:[{id:"asc"}],skip:0}),r=yield e.query(t),n=r.documents;return n})}var If="storageToken",pv=wi(If,ws);function Rf(e){return S(this,null,function*(){var t=er(10),r=e.password?yield e.hashFunction(JSON.stringify(e.password)):void 0,n={id:pv,context:ws,key:If,data:{rxdbVersion:e.rxdbVersion,token:t,instanceToken:e.token,passwordHash:r},_deleted:!1,_meta:Fr(),_rev:jr(),_attachments:{}},a=[{document:n}],c=yield e.internalStore.bulkWrite(a,"internal-add-storage-token");if(!c.error[0])return ft("id",a,c)[0];var f=ue(c.error[0]);if(f.isError&&ko(f)){var p=f;if(!hv(p.documentInDb.data.rxdbVersion,e.rxdbVersion))throw H("DM5",{args:{database:e.name,databaseStateVersion:p.documentInDb.data.rxdbVersion,codeVersion:e.rxdbVersion}});if(r&&r!==p.documentInDb.data.passwordHash)throw H("DB1",{passwordHash:r,existingPasswordHash:p.documentInDb.data.passwordHash});var d=p.documentInDb;return ue(d)}throw f})}function hv(e,t){if(!e)return!1;var r=e.split(".")[0],n=t.split(".")[0];return r==="15"&&n==="16"?!0:r===n}function bs(e,t){return e+"-"+t.version}function qn(e,t){return t=Ee(t),t=Nc(e,t),typeof e.jsonSchema.primaryKey!="string"&&(t=Mc(e.primaryPath,e.jsonSchema,t)),t._meta=Fr(),Object.prototype.hasOwnProperty.call(t,"_deleted")||(t._deleted=!1),Object.prototype.hasOwnProperty.call(t,"_attachments")||(t._attachments={}),Object.prototype.hasOwnProperty.call(t,"_rev")||(t._rev=jr()),t}function Af(e,t){return S(this,null,function*(){t.multiInstance=e.multiInstance;var r=yield e.storage.createStorageInstance(t);return r})}function _i(e,t,r,n,a,c,f,p){return S(this,null,function*(){var d=yield bi(t),_=d.filter(I=>I.data.name===a),x=[];_.forEach(I=>{x.push({collectionName:I.data.name,schema:I.data.schema,isCollection:!0}),I.data.connectedStorages.forEach(A=>x.push({collectionName:A.collectionName,isCollection:!1,schema:A.schema}))});var E=new Set;if(x=x.filter(I=>{var A=I.collectionName+"||"+I.schema.version;return E.has(A)?!1:(E.add(A),!0)}),yield Promise.all(x.map(I=>S(null,null,function*(){var A=yield e.createStorageInstance({collectionName:I.collectionName,databaseInstanceToken:r,databaseName:n,multiInstance:c,options:{},schema:I.schema,password:f,devMode:we.isDevMode()});yield A.remove(),I.isCollection&&(yield tr("postRemoveRxCollection",{storage:e,databaseName:n,collectionName:a}))}))),p){var R=_.map(I=>{var A=Dr(I);return A._deleted=!0,A._meta.lwt=ze(),A._rev=In(r,I),{previous:I,document:A}});yield t.bulkWrite(R,"rx-database-remove-collection-all")}})}function tt(e){if(e.closed)throw H("COL21",{collection:e.name,version:e.schema.version})}var dv=(function(){function e(r){this.subs=[],this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.limit=100,this.tasks=new Set,this.collection=r,this.subs.push(this.collection.eventBulks$.pipe(ke(n=>!n.isLocal)).subscribe(n=>{this.tasks.add(()=>this._handleChangeEvents(n.events)),this.tasks.size<=1&&Kr().then(()=>{this.processTasks()})}))}var t=e.prototype;return t.processTasks=function(){if(this.tasks.size!==0){var n=Array.from(this.tasks);n.forEach(a=>a()),this.tasks.clear()}},t._handleChangeEvents=function(n){var a=this.counter;this.counter=this.counter+n.length,n.length>this.limit?this.buffer=n.slice(n.length*-1):(yt(this.buffer,n),this.buffer=this.buffer.slice(this.limit*-1));for(var c=a+1,f=this.eventCounterMap,p=0;p<n.length;p++){var d=n[p];f.set(d,c+p)}},t.getCounter=function(){return this.processTasks(),this.counter},t.getBuffer=function(){return this.processTasks(),this.buffer},t.getArrayIndexByPointer=function(n){this.processTasks();var a=this.buffer[0],c=this.eventCounterMap.get(a);if(n<c)return null;var f=n-c;return f},t.getFrom=function(n){this.processTasks();var a=[],c=this.getArrayIndexByPointer(n);if(c===null)return null;for(;;){var f=this.buffer[c];if(c++,f)a.push(f);else return a}},t.runFrom=function(n,a){this.processTasks();var c=this.getFrom(n);if(c===null)throw new Error("out of bounds");c.forEach(f=>a(f))},t.reduceByLastOfDoc=function(n){return this.processTasks(),n.slice(0)},t.close=function(){this.tasks.clear(),this.subs.forEach(n=>n.unsubscribe())},e})();function Cf(e){return new dv(e)}var vv=new WeakMap;function yv(e){var t=e.schema.getDocumentPrototype(),r=gv(e),n=cs,a={};return[t,r,n].forEach(c=>{var f=Object.getOwnPropertyNames(c);f.forEach(p=>{var d=Object.getOwnPropertyDescriptor(c,p),_=!0;(p.startsWith("_")||p.endsWith("_")||p.startsWith("$")||p.endsWith("$"))&&(_=!1),typeof d.value=="function"?Object.defineProperty(a,p,{get(){return d.value.bind(this)},enumerable:_,configurable:!1}):(d.enumerable=_,d.configurable=!1,d.writable&&(d.writable=!1),Object.defineProperty(a,p,d))})}),a}function Pf(e){return Ae(vv,e,()=>Tl(yv(e)))}function Tf(e,t,r){var n=Ml(t,e,we.deepFreezeWhenDevMode(r));return e._runHooksSync("post","create",r,n),Ce("postCreateRxDocument",n),n}function gv(e){var t={};return Object.entries(e.methods).forEach(([r,n])=>{t[r]=n}),t}var _s={isEqual(e,t,r){e=Mf(e),t=Mf(t);var n=qr(St(e),St(t));return n},resolve(e){return e.realMasterState}};function Mf(e){return e._attachments||(e=Ee(e),e._attachments={}),e}var Nf=["pre","post"],$f=["insert","save","remove","create"],kf=!1,Zr=new Set,xv=(function(){function e(r,n,a,c,f={},p={},d={},_={},x={},E=gs,R={},I=_s){this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this.awaitBeforeReads=new Set,this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=bf(),this.$={},this.checkpoint$={},this._changeEventBuffer={},this.eventBulks$={},this.onClose=[],this.closed=!1,this.onRemove=[],this.database=r,this.name=n,this.schema=a,this.internalStorageInstance=c,this.instanceCreationOptions=f,this.migrationStrategies=p,this.methods=d,this.attachments=_,this.options=x,this.cacheReplacementPolicy=E,this.statics=R,this.conflictHandler=I,wv(this.asRxCollection),r&&(this.eventBulks$=r.eventBulks$.pipe(ke(A=>A.collectionName===this.name))),this.database&&Zr.add(this)}var t=e.prototype;return t.prepare=function(){return S(this,null,function*(){if(!(yield Ko())){for(var n=0;n<10&&Zr.size>qa;)n++,yield this.promiseWait(30);if(Zr.size>qa)throw H("COL23",{database:this.database.name,collection:this.name,args:{existing:Array.from(Zr.values()).map(d=>({db:d.database?d.database.name:"",c:d.name}))}})}this.storageInstance=fi(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new Pl(this.storageInstance,this.schema.primaryPath,(d,_)=>ls(this,d,_),d=>this._runHooks("post","save",d)),this.$=this.eventBulks$.pipe(Br(d=>Uo(d))),this.checkpoint$=this.eventBulks$.pipe(ot(d=>d.checkpoint)),this._changeEventBuffer=Cf(this.asRxCollection);var a;this._docCache=new Sf(this.schema.primaryPath,this.eventBulks$.pipe(ke(d=>!d.isLocal),ot(d=>d.events)),d=>(a||(a=Pf(this.asRxCollection)),Tf(this.asRxCollection,a,d)));var c=this.database.internalStore.changeStream().pipe(ke(d=>{var _=this.name+"-"+this.schema.version,x=d.events.find(E=>E.documentData.context==="collection"&&E.documentData.key===_&&E.operation==="DELETE");return!!x})).subscribe(()=>S(this,null,function*(){yield this.close(),yield Promise.all(this.onRemove.map(d=>d()))}));this._subs.push(c);var f=yield this.database.storageToken,p=this.storageInstance.changeStream().subscribe(d=>{var _={id:d.id,isLocal:!1,internal:!1,collectionName:this.name,storageToken:f,events:d.events,databaseToken:this.database.token,checkpoint:d.checkpoint,context:d.context};this.database.$emit(_)});return this._subs.push(p),At})},t.cleanup=function(n){throw tt(this),ve("cleanup")},t.migrationNeeded=function(){throw ve("migration-schema")},t.getMigrationState=function(){throw ve("migration-schema")},t.startMigration=function(n=10){return tt(this),this.getMigrationState().startMigration(n)},t.migratePromise=function(n=10){return this.getMigrationState().migratePromise(n)},t.insert=function(n){return S(this,null,function*(){tt(this);var a=yield this.bulkInsert([n]),c=a.error[0];Xr(this,n[this.schema.primaryPath],n,c);var f=ue(a.success[0]);return f})},t.insertIfNotExists=function(n){return S(this,null,function*(){var a=yield this.bulkInsert([n]);if(a.error.length>0){var c=a.error[0];if(c.status===409){var f=c.documentInDb;return jn(this._docCache,[f])[0]}else throw c}return a.success[0]})},t.bulkInsert=function(n){return S(this,null,function*(){if(tt(this),n.length===0)return{success:[],error:[]};var a=this.schema.primaryPath,c=new Set,f;if(this.hasHooks("pre","insert"))f=yield Promise.all(n.map(B=>{var Z=qn(this.schema,B);return this._runHooks("pre","insert",Z).then(()=>(c.add(Z[a]),{document:Z}))}));else{f=new Array(n.length);for(var p=this.schema,d=0;d<n.length;d++){var _=n[d],x=qn(p,_);c.add(x[a]),f[d]={document:x}}}if(c.size!==n.length)throw H("COL22",{collection:this.name,args:{documents:n}});var E=yield this.storageInstance.bulkWrite(f,"rx-collection-bulk-insert"),R,I=this,A={get success(){if(!R){var B=ft(I.schema.primaryPath,f,E);R=jn(I._docCache,B)}return R},error:E.error};if(this.hasHooks("post","insert")){var F=new Map;f.forEach(B=>{var Z=B.document;F.set(Z[a],Z)}),yield Promise.all(A.success.map(B=>this._runHooks("post","insert",F.get(B.primary),B)))}return A})},t.bulkRemove=function(n){return S(this,null,function*(){tt(this);var a=this.schema.primaryPath;if(n.length===0)return{success:[],error:[]};var c;typeof n[0]=="string"?c=yield this.findByIds(n).exec():(c=new Map,n.forEach(I=>c.set(I.primary,I)));var f=[],p=new Map;Array.from(c.values()).forEach(I=>{var A=I.toMutableJSON(!0);f.push(A),p.set(I.primary,A)}),yield Promise.all(f.map(I=>{var A=I[this.schema.primaryPath];return this._runHooks("pre","remove",I,c.get(A))}));var d=f.map(I=>{var A=Ee(I);return A._deleted=!0,{previous:I,document:A}}),_=yield this.storageInstance.bulkWrite(d,"rx-collection-bulk-remove"),x=ft(this.schema.primaryPath,d,_),E=[],R=x.map(I=>{var A=I[a],F=this._docCache.getCachedRxDocument(I);return E.push(F),A});return yield Promise.all(R.map(I=>this._runHooks("post","remove",p.get(I),c.get(I)))),{success:E,error:_.error}})},t.bulkUpsert=function(n){return S(this,null,function*(){tt(this);var a=[],c=new Map;n.forEach(_=>{var x=qn(this.schema,_),E=x[this.schema.primaryPath];if(!E)throw H("COL3",{primaryPath:this.schema.primaryPath,data:x,schema:this.schema.jsonSchema});c.set(E,x),a.push(x)});var f=yield this.bulkInsert(a),p=f.success.slice(0),d=[];return yield Promise.all(f.error.map(_=>S(this,null,function*(){if(_.status!==409)d.push(_);else{var x=_.documentId,E=br(c,x),R=ue(_.documentInDb),I=this._docCache.getCachedRxDocuments([R])[0],A=yield I.incrementalModify(()=>E);p.push(A)}}))),{error:d,success:p}})},t.upsert=function(n){return S(this,null,function*(){tt(this);var a=yield this.bulkUpsert([n]);return Xr(this.asRxCollection,n[this.schema.primaryPath],n,a.error[0]),a.success[0]})},t.incrementalUpsert=function(n){tt(this);var a=qn(this.schema,n),c=a[this.schema.primaryPath];if(!c)throw H("COL4",{data:n});var f=this._incrementalUpsertQueues.get(c);return f||(f=At),f=f.then(()=>_v(this,c,a)).then(p=>p.inserted?p.doc:bv(p.doc,a)),this._incrementalUpsertQueues.set(c,f),f},t.find=function(n){tt(this),Ce("prePrepareRxQuery",{op:"find",queryObj:n,collection:this}),n||(n=Kn());var a=Gr("find",n,this);return a},t.findOne=function(n){tt(this),Ce("prePrepareRxQuery",{op:"findOne",queryObj:n,collection:this});var a;if(typeof n=="string")a=Gr("findOne",{selector:{[this.schema.primaryPath]:n},limit:1},this);else{if(n||(n=Kn()),n.limit)throw H("QU6");n=Ee(n),n.limit=1,a=Gr("findOne",n,this)}return a},t.count=function(n){tt(this),n||(n=Kn());var a=Gr("count",n,this);return a},t.findByIds=function(n){tt(this);var a={selector:{[this.schema.primaryPath]:{$in:n.slice(0)}}},c=Gr("findByIds",a,this);return c},t.exportJSON=function(){throw ve("json-dump")},t.importJSON=function(n){throw ve("json-dump")},t.insertCRDT=function(n){throw ve("crdt")},t.addPipeline=function(n){throw ve("pipeline")},t.addHook=function(n,a,c,f=!1){if(typeof c!="function")throw Na("COL7",{key:a,when:n});if(!Nf.includes(n))throw Na("COL8",{key:a,when:n});if(!$f.includes(a))throw H("COL9",{key:a});if(n==="post"&&a==="create"&&f===!0)throw H("COL10",{when:n,key:a,parallel:f});var p=c.bind(this),d=f?"parallel":"series";this.hooks[a]=this.hooks[a]||{},this.hooks[a][n]=this.hooks[a][n]||{series:[],parallel:[]},this.hooks[a][n][d].push(p)},t.getHooks=function(n,a){return!this.hooks[a]||!this.hooks[a][n]?{series:[],parallel:[]}:this.hooks[a][n]},t.hasHooks=function(n,a){if(!this.hooks[a]||!this.hooks[a][n])return!1;var c=this.getHooks(n,a);return c?c.series.length>0||c.parallel.length>0:!1},t._runHooks=function(n,a,c,f){var p=this.getHooks(n,a);if(!p)return At;var d=p.series.map(_=>()=>_(c,f));return Dc(d).then(()=>Promise.all(p.parallel.map(_=>_(c,f))))},t._runHooksSync=function(n,a,c,f){if(this.hasHooks(n,a)){var p=this.getHooks(n,a);p&&p.series.forEach(d=>d(c,f))}},t.promiseWait=function(n){var a=new Promise(c=>{var f=setTimeout(()=>{this.timeouts.delete(f),c()},n);this.timeouts.add(f)});return a},t.close=function(){return S(this,null,function*(){return this.closed?xt:(Zr.delete(this),yield Promise.all(this.onClose.map(n=>n())),this.closed=!0,Array.from(this.timeouts).forEach(n=>clearTimeout(n)),this._changeEventBuffer&&this._changeEventBuffer.close(),this.database.requestIdlePromise().then(()=>this.storageInstance.close()).then(()=>(this._subs.forEach(n=>n.unsubscribe()),delete this.database.collections[this.name],tr("postCloseRxCollection",this).then(()=>!0))))})},t.remove=function(){return S(this,null,function*(){yield this.close(),yield Promise.all(this.onRemove.map(n=>n())),yield _i(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.multiInstance,this.database.password,this.database.hashFunction)})},qe(e,[{key:"insert$",get:function(){return this.$.pipe(ke(r=>r.operation==="INSERT"))}},{key:"update$",get:function(){return this.$.pipe(ke(r=>r.operation==="UPDATE"))}},{key:"remove$",get:function(){return this.$.pipe(ke(r=>r.operation==="DELETE"))}},{key:"asRxCollection",get:function(){return this}}])})();function wv(e){if(!kf){kf=!0;var t=Object.getPrototypeOf(e);$f.forEach(r=>{Nf.map(n=>{var a=n+Lo(r);t[a]=function(c,f){return this.addHook(n,r,c,f)}})})}}function bv(e,t){return e.incrementalModify(r=>t)}function _v(e,t,r){var n=e._docCache.getLatestDocumentDataIfExists(t);return n?Promise.resolve({doc:e._docCache.getCachedRxDocuments([n])[0],inserted:!1}):e.findOne(t).exec().then(a=>a?{doc:a,inserted:!1}:e.insert(r).then(c=>({doc:c,inserted:!0})))}function Bf(I){return S(this,arguments,function*({database:e,name:t,schema:r,instanceCreationOptions:n={},migrationStrategies:a={},autoMigrate:c=!0,statics:f={},methods:p={},attachments:d={},options:_={},localDocuments:x=!1,cacheReplacementPolicy:E=gs,conflictHandler:R=_s}){var A={databaseInstanceToken:e.token,databaseName:e.name,collectionName:t,schema:r.jsonSchema,options:n,multiInstance:e.multiInstance,password:e.password,devMode:we.isDevMode()};Ce("preCreateRxStorageInstance",A);var F=yield Af(e,A),B=new xv(e,t,r,F,n,a,p,d,_,E,f,R);try{yield B.prepare(),Object.entries(f).forEach(([Z,G])=>{Object.defineProperty(B,Z,{get:()=>G.bind(B)})}),Ce("createRxCollection",{collection:B,creator:{name:t,schema:r,storageInstance:F,instanceCreationOptions:n,migrationStrategies:a,methods:p,attachments:d,options:_,cacheReplacementPolicy:E,localDocuments:x,statics:f}}),c&&B.schema.version!==0&&(yield B.migratePromise())}catch(Z){throw Zr.delete(B),yield F.close(),Z}return B})}var Os=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this._parallels=t||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map};Os.prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,Ss(this)},wrapCall:function(t){var r=this;this._qC++;var n;try{n=t()}catch(a){throw this.unlock(),a}return!n.then||typeof n.then!="function"?(this.unlock(),n):n.then(function(a){return r.unlock(),a}).catch(function(a){throw r.unlock(),a})},requestIdlePromise:function(t){var r=this;t=t||{};var n,a=new Promise(function(p){return n=p}),c=function(){Es(r,a),n()};if(a._manRes=c,t.timeout){var f=setTimeout(function(){a._manRes()},t.timeout);a._timeoutObj=f}return this._iC.add(a),Ss(this),a},cancelIdlePromise:function(t){Es(this,t)},requestIdleCallback:function(t,r){var n=this._lHN++,a=this.requestIdlePromise(r);return this._hPM.set(n,a),this._pHM.set(a,n),a.then(function(){return t()}),n},cancelIdleCallback:function(t){var r=this._hPM.get(t);this.cancelIdlePromise(r)},clear:function(){var t=this;this._iC.forEach(function(r){return Es(t,r)}),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}};function Ev(e){if(e._iC.size!==0){var t=e._iC.values(),r=t.next().value;r._manRes(),setTimeout(function(){return Ss(e)},0)}}function Es(e,t){if(t){if(t._timeoutObj&&clearTimeout(t._timeoutObj),e._pHM.has(t)){var r=e._pHM.get(t);e._hPM.delete(r),e._pHM.delete(t)}e._iC.delete(t)}}function Ss(e){e._tryIR||e._iC.size===0||(e._tryIR=!0,setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}Ev(e),e._tryIR=!1},0)},0))}var ar=class{ttl;map=new Map;_to=!1;constructor(t){this.ttl=t}has(t){return this.map.has(t)}add(t){this.map.set(t,Lf()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,Sv(this)},0))}clear(){this.map.clear()}};function Sv(e){let t=Lf()-e.ttl,r=e.map[Symbol.iterator]();for(;;){let n=r.next().value;if(!n)return;let a=n[0];if(n[1]<t)e.map.delete(a);else return}}function Lf(){return Date.now()}var Ds=new Set,Ff=new Map,jf=0,Ov=(function(){function e(r,n,a,c,f,p,d=!1,_={},x,E,R,I,A,F){this.idleQueue=new Os,this.rxdbVersion=_r,this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onClose=[],this.closed=!1,this.collections={},this.states={},this.eventBulks$=new Gt,this.closePromise=null,this.observable$=this.eventBulks$.pipe(Br(B=>Uo(B))),this.storageToken=xt,this.storageTokenDocument=xt,this.emittedEventBulkIds=new ar(60*1e3),this.name=r,this.token=n,this.storage=a,this.instanceCreationOptions=c,this.password=f,this.multiInstance=p,this.eventReduce=d,this.options=_,this.internalStore=x,this.hashFunction=E,this.cleanupPolicy=R,this.allowSlowCount=I,this.reactivity=A,this.onClosed=F,jf++,this.name!=="pseudoInstance"&&(this.internalStore=fi(this.asRxDatabase,x,xi),this.storageTokenDocument=Rf(this.asRxDatabase).catch(B=>this.startupErrors.push(B)),this.storageToken=this.storageTokenDocument.then(B=>B.data.token).catch(B=>this.startupErrors.push(B)))}var t=e.prototype;return t.getReactivityFactory=function(){if(!this.reactivity)throw H("DB14",{database:this.name});return this.reactivity},t.$emit=function(n){this.emittedEventBulkIds.has(n.id)||(this.emittedEventBulkIds.add(n.id),this.eventBulks$.next(n))},t.removeCollectionDoc=function(n,a){return S(this,null,function*(){var c=yield ss(this.internalStore,wi(bs(n,a),Jr));if(!c)throw H("SNH",{name:n,schema:a});var f=Dr(c);f._deleted=!0,yield this.internalStore.bulkWrite([{document:f,previous:c}],"rx-database-remove-collection")})},t.addCollections=function(n){return S(this,null,function*(){var a={},c={},f=[],p={};yield Promise.all(Object.entries(n).map(R=>S(this,[R],function*([x,E]){var I=x,A=E.schema;a[I]=A;var F=$c(A,this.hashFunction);if(c[I]=F,this.collections[x])throw H("DB3",{name:x});var B=bs(x,A),Z={id:wi(B,Jr),key:B,context:Jr,data:{name:I,schemaHash:yield F.hash,schema:F.jsonSchema,version:F.version,connectedStorages:[]},_deleted:!1,_meta:Fr(),_rev:jr(),_attachments:{}};f.push({document:Z});var G=Object.assign({},E,{name:I,schema:F,database:this}),re=Ee(E);re.database=this,re.name=x,Ce("preCreateRxCollection",re),G.conflictHandler=re.conflictHandler,p[I]=G})));var d=yield this.internalStore.bulkWrite(f,"rx-database-add-collection");yield Rv(this),yield Promise.all(d.error.map(x=>S(this,null,function*(){if(x.status!==409)throw H("DB12",{database:this.name,writeError:x});var E=ue(x.documentInDb),R=E.data.name,I=c[R];if(E.data.schemaHash!==(yield I.hash))throw H("DB6",{database:this.name,collection:R,previousSchemaHash:E.data.schemaHash,schemaHash:yield I.hash,previousSchema:E.data.schema,schema:ue(a[R])})})));var _={};return yield Promise.all(Object.keys(n).map(x=>S(this,null,function*(){var E=p[x],R=yield Bf(E);_[x]=R,this.collections[x]=R,this[x]||Object.defineProperty(this,x,{get:()=>this.collections[x]})}))),_})},t.lockedRun=function(n){return this.idleQueue.wrapCall(n)},t.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},t.exportJSON=function(n){throw ve("json-dump")},t.addState=function(n){throw ve("state")},t.importJSON=function(n){throw ve("json-dump")},t.backup=function(n){throw ve("backup")},t.leaderElector=function(){throw ve("leader-election")},t.isLeader=function(){throw ve("leader-election")},t.waitForLeadership=function(){throw ve("leader-election")},t.migrationStates=function(){throw ve("migration-schema")},t.close=function(){if(this.closePromise)return this.closePromise;var{promise:n,resolve:a}=Kf(),c=f=>{this.onClosed&&this.onClosed(),this.closed=!0,a(f)};return this.closePromise=n,S(this,null,function*(){if(yield tr("preCloseRxDatabase",this),this.eventBulks$.complete(),jf--,this._subs.map(f=>f.unsubscribe()),this.name==="pseudoInstance"){c(!1);return}return this.requestIdlePromise().then(()=>Promise.all(this.onClose.map(f=>f()))).then(()=>Promise.all(Object.keys(this.collections).map(f=>this.collections[f]).map(f=>f.close()))).then(()=>this.internalStore.close()).then(()=>c(!0))}),n},t.remove=function(){return this.close().then(()=>Iv(this.name,this.storage,this.multiInstance,this.password))},qe(e,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}])})();function Dv(e,t){if(Ds.has(qf(e,t)))throw H("DB8",{name:e,storage:t.name,link:"https://rxdb.info/rx-database.html#ignoreduplicate"})}function Kf(){var e,t,r=new Promise((n,a)=>{e=n,t=a});return{promise:r,resolve:e,reject:t}}function qf(e,t){return t.name+"|"+e}function Uf(e,t,r,n,a,c){return S(this,null,function*(){var f=yield t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:Al,schema:xi,options:n,multiInstance:a,password:c,devMode:we.isDevMode()});return f})}function Vf({storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:a=!0,eventReduce:c=!0,ignoreDuplicate:f=!1,options:p={},cleanupPolicy:d,closeDuplicates:_=!1,allowSlowCount:x=!1,localDocuments:E=!1,hashFunction:R=Bo,reactivity:I}){Ce("preCreateRxDatabase",{storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:a,eventReduce:c,ignoreDuplicate:f,options:p,localDocuments:E});var A=qf(r,e),F=Ff.get(A)||new Set,B=Kf(),Z=Array.from(F),G=()=>{F.delete(B.promise),Ds.delete(A)};return F.add(B.promise),Ff.set(A,F),S(null,null,function*(){if(_&&(yield Promise.all(Z.map(be=>be.catch(()=>null).then(ne=>ne&&ne.close())))),f){if(!we.isDevMode())throw H("DB9",{database:r})}else Dv(r,e);Ds.add(A);var re=er(10),xe=yield Uf(re,e,r,t,a,n),me=new Ov(r,re,e,t,n,a,c,p,xe,R,d,x,I,G);return yield tr("createRxDatabase",{database:me,creator:{storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:a,eventReduce:c,ignoreDuplicate:f,options:p,localDocuments:E}}),me}).then(re=>{B.resolve(re)}).catch(re=>{B.reject(re),G()}),B.promise}function Iv(e,t,r=!0,n){return S(this,null,function*(){var a=er(10),c=yield Uf(a,t,e,{},r,n),f=yield bi(c),p=new Set;f.forEach(_=>p.add(_.data.name));var d=Array.from(p);return yield Promise.all(d.map(_=>_i(t,c,a,e,_,r,n))),yield tr("postRemoveRxDatabase",{databaseName:e,storage:t}),yield c.remove(),d})}function Rv(e){return S(this,null,function*(){if(yield e.storageToken,e.startupErrors[0])throw e.startupErrors[0]})}function Wf(e){return e&&typeof e.then=="function"}var Av=Promise.resolve(!1),fF=Promise.resolve(!0),Ot=Promise.resolve();function Ei(e,t){return e||(e=0),new Promise(function(r){return setTimeout(function(){return r(t)},e)})}function zf(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Un(){return Math.random().toString(36).substring(2)}var Is=0;function $t(){var e=Date.now()*1e3;return e<=Is&&(e=Is+1),Is=e,e}var Cv=$t,Pv="native";function Tv(e){var t={time:$t(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(r){t.messagesCallback&&t.messagesCallback(r.data)},t}function Mv(e){e.bc.close(),e.subFns=[]}function kv(e,t){try{return e.bc.postMessage(t,!1),Ot}catch(r){return Promise.reject(r)}}function Nv(e,t){e.messagesCallback=t}function $v(){if(typeof globalThis<"u"&&globalThis.Deno&&globalThis.Deno.args)return!0;if((typeof window<"u"||typeof self<"u")&&typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function Bv(){return 150}var Qf={create:Tv,close:Mv,onMessage:Nv,postMessage:kv,canBeUsed:$v,type:Pv,averageResponseTime:Bv,microSeconds:Cv};function en(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=1e3*45),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&typeof e.idb.onclose=="function"&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=1e3*60),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=1e3*60*2),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var Lv=$t,Fv="pubkey.broadcast-channel-0-",Bt="messages",Si={durability:"relaxed"},jv="idb";function Hf(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function Rs(e){e.commit&&e.commit()}function Kv(e){var t=Hf(),r=Fv+e,n=t.open(r);return n.onupgradeneeded=function(a){var c=a.target.result;c.createObjectStore(Bt,{keyPath:"id",autoIncrement:!0})},new Promise(function(a,c){n.onerror=function(f){return c(f)},n.onsuccess=function(){a(n.result)}})}function qv(e,t,r){var n=Date.now(),a={uuid:t,time:n,data:r},c=e.transaction([Bt],"readwrite",Si);return new Promise(function(f,p){c.oncomplete=function(){return f()},c.onerror=function(_){return p(_)};var d=c.objectStore(Bt);d.add(a),Rs(c)})}function Uv(e,t){var r=e.transaction(Bt,"readonly",Si),n=r.objectStore(Bt),a=[],c=IDBKeyRange.bound(t+1,1/0);if(n.getAll){var f=n.getAll(c);return new Promise(function(d,_){f.onerror=function(x){return _(x)},f.onsuccess=function(x){d(x.target.result)}})}function p(){try{return c=IDBKeyRange.bound(t+1,1/0),n.openCursor(c)}catch{return n.openCursor()}}return new Promise(function(d,_){var x=p();x.onerror=function(E){return _(E)},x.onsuccess=function(E){var R=E.target.result;R?R.value.id<t+1?R.continue(t+1):(a.push(R.value),R.continue()):(Rs(r),d(a))}})}function Vv(e,t){if(e.closed)return Promise.resolve([]);var r=e.db.transaction(Bt,"readwrite",Si),n=r.objectStore(Bt);return Promise.all(t.map(function(a){var c=n.delete(a);return new Promise(function(f){c.onsuccess=function(){return f()}})}))}function Wv(e,t){var r=Date.now()-t,n=e.transaction(Bt,"readonly",Si),a=n.objectStore(Bt),c=[];return new Promise(function(f){a.openCursor().onsuccess=function(p){var d=p.target.result;if(d){var _=d.value;_.time<r?(c.push(_),d.continue()):(Rs(n),f(c))}else f(c)}})}function zv(e){return Wv(e.db,e.options.idb.ttl).then(function(t){return Vv(e,t.map(function(r){return r.id}))})}function Qv(e,t){return t=en(t),Kv(e).then(function(r){var n={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:Un(),eMIs:new ar(t.idb.ttl*2),writeBlockPromise:Ot,messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,t.idb.onclose&&t.idb.onclose()},Yf(n),n})}function Yf(e){e.closed||Xf(e).then(function(){return Ei(e.options.idb.fallbackInterval)}).then(function(){return Yf(e)})}function Hv(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}function Xf(e){return e.closed?Ot:e.messagesCallback?Uv(e.db,e.lastCursorId).then(function(t){var r=t.filter(function(n){return!!n}).map(function(n){return n.id>e.lastCursorId&&(e.lastCursorId=n.id),n}).filter(function(n){return Hv(n,e)}).sort(function(n,a){return n.time-a.time});return r.forEach(function(n){e.messagesCallback&&(e.eMIs.add(n.id),e.messagesCallback(n.data))}),Ot}):Ot}function Yv(e){e.closed=!0,e.db.close()}function Xv(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return qv(e.db,e.uuid,t)}).then(function(){zf(0,10)===0&&zv(e)}),e.writeBlockPromise}function Gv(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,Xf(e)}function Jv(){return!!Hf()}function Zv(e){return e.idb.fallbackInterval*2}var Gf={create:Qv,close:Yv,onMessage:Gv,postMessage:Xv,canBeUsed:Jv,type:jv,averageResponseTime:Zv,microSeconds:Lv};var ey=$t,ty="pubkey.broadcastChannel-",ry="localstorage";function Jf(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function Zf(e){return ty+e}function ny(e,t){return new Promise(function(r){Ei().then(function(){var n=Zf(e.channelName),a={token:Un(),time:Date.now(),data:t,uuid:e.uuid},c=JSON.stringify(a);Jf().setItem(n,c);var f=document.createEvent("Event");f.initEvent("storage",!0,!0),f.key=n,f.newValue=c,window.dispatchEvent(f),r()})})}function oy(e,t){var r=Zf(e),n=function(c){c.key===r&&t(JSON.parse(c.newValue))};return window.addEventListener("storage",n),n}function iy(e){window.removeEventListener("storage",e)}function ay(e,t){if(t=en(t),!em())throw new Error("BroadcastChannel: localstorage cannot be used");var r=Un(),n=new ar(t.localstorage.removeTimeout),a={channelName:e,uuid:r,eMIs:n};return a.listener=oy(e,function(c){a.messagesCallback&&c.uuid!==r&&(!c.token||n.has(c.token)||c.data.time&&c.data.time<a.messagesCallbackTime||(n.add(c.token),a.messagesCallback(c.data)))}),a}function sy(e){iy(e.listener)}function uy(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function em(){var e=Jf();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function cy(){var e=120,t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?e*2:e}var tm={create:ay,close:sy,onMessage:uy,postMessage:ny,canBeUsed:em,type:ry,averageResponseTime:cy,microSeconds:ey};var rm=$t,ly="simulate",As=new Set;function fy(e){var t={time:rm(),name:e,messagesCallback:null};return As.add(t),t}function my(e){As.delete(e)}var nm=5;function py(e,t){return new Promise(function(r){return setTimeout(function(){var n=Array.from(As);n.forEach(function(a){a.name===e.name&&a!==e&&a.messagesCallback&&a.time<t.time&&a.messagesCallback(t)}),r()},nm)})}function hy(e,t){e.messagesCallback=t}function dy(){return!0}function vy(){return nm}var om={create:fy,close:my,onMessage:hy,postMessage:py,canBeUsed:dy,type:ly,averageResponseTime:vy,microSeconds:rm};var im=[Qf,Gf,tm];function am(e){var t=[].concat(e.methods,im).filter(Boolean);if(e.type){if(e.type==="simulate")return om;var r=t.find(function(a){return a.type===e.type});if(r)return r;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter(function(a){return a.type!=="idb"}));var n=t.find(function(a){return a.canBeUsed()});if(n)return n;throw new Error("No usable method found in "+JSON.stringify(im.map(function(a){return a.type})))}var Cs=new Set,yy=0,Vn=function(t,r){this.id=yy++,Cs.add(this),this.name=t,sm&&(r=sm),this.options=en(r),this.method=am(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,gy(this)};Vn._pubkey=!0;var sm;Vn.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return um(this,"message",t)},postInternal:function(t){return um(this,"internal",t)},set onmessage(e){var t=this.method.microSeconds(),r={time:t,fn:e};lm(this,"message",this._onML),e&&typeof e=="function"?(this._onML=r,cm(this,"message",r)):this._onML=null},addEventListener:function(t,r){var n=this.method.microSeconds(),a={time:n,fn:r};cm(this,t,a)},removeEventListener:function(t,r){var n=this._addEL[t].find(function(a){return a.fn===r});lm(this,t,n)},close:function(){var t=this;if(!this.closed){Cs.delete(this),this.closed=!0;var r=this._prepP?this._prepP:Ot;return this._onML=null,this._addEL.message=[],r.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(n){return n()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function um(e,t,r){var n=e.method.microSeconds(),a={time:n,type:t,data:r},c=e._prepP?e._prepP:Ot;return c.then(function(){var f=e.method.postMessage(e._state,a);return e._uMP.add(f),f.catch().then(function(){return e._uMP.delete(f)}),f})}function gy(e){var t=e.method.create(e.name,e.options);Wf(t)?(e._prepP=t,t.then(function(r){e._state=r})):e._state=t}function fm(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function cm(e,t,r){e._addEL[t].push(r),xy(e)}function lm(e,t,r){e._addEL[t]=e._addEL[t].filter(function(n){return n!==r}),wy(e)}function xy(e){if(!e._iL&&fm(e)){var t=function(a){e._addEL[a.type].forEach(function(c){a.time>=c.time&&c.fn(a.data)})},r=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,r)}):(e._iL=!0,e.method.onMessage(e._state,t,r))}}function wy(e){if(e._iL&&!fm(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}var Oi=new Map;function by(e,t,r,n){var a=Oi.get(t);return a||(a={bc:new Vn(["RxDB:",e,r].join("|")),refs:new Set},Oi.set(t,a)),a.refs.add(n),a.bc}function mm(e,t){var r=Oi.get(e);if(r&&(r.refs.delete(t),r.refs.size===0))return Oi.delete(e),r.bc.close()}function Di(e,t,r,n){if(t.multiInstance){var a=n||by(e,t.databaseInstanceToken,r.databaseName,r),c=new Gt,f=R=>{R.storageName===e&&R.databaseName===t.databaseName&&R.collectionName===t.collectionName&&R.version===t.schema.version&&c.next(R.eventBulk)};a.addEventListener("message",f);var p=r.changeStream(),d=!1,_=p.subscribe(R=>{d||a.postMessage({storageName:e,databaseName:t.databaseName,collectionName:t.collectionName,version:t.schema.version,eventBulk:R})});r.changeStream=function(){return c.asObservable().pipe(Pu(p))};var x=r.close.bind(r);r.close=function(){return S(this,null,function*(){return d=!0,_.unsubscribe(),a.removeEventListener("message",f),n||(yield mm(t.databaseInstanceToken,r)),x()})};var E=r.remove.bind(r);r.remove=function(){return S(this,null,function*(){return d=!0,_.unsubscribe(),a.removeEventListener("message",f),n||(yield mm(t.databaseInstanceToken,r)),E()})}}}var Ii=new Map,Ai="sqlite",_y=":memory:";function pm(e,t){var r=Ii.get(t);if(!r)r={database:e.open(t),sqliteBasics:e,openConnections:1},Ii.set(t,r);else{if(r.sqliteBasics!==e&&t!==_y)throw new Error("opened db with different creator method "+t+" "+r.sqliteBasics.debugId+" "+e.debugId);r.openConnections=r.openConnections+1}return r.database}function hm(e,t){var r=Ii.get(e);if(r&&(r.openConnections=r.openConnections-1,r.openConnections===0))return Ii.delete(e),r.database.then(n=>t.close(n))}function Ci(e){return e&&(Array.isArray(e)?e[4]?e[4]:e[0]:e.data)}function dm(e,t,r){var n=`
        INSERT INTO "`+e+`" (
            id,
            revision,
            deleted,
            lastWriteTime,
            data
        ) VALUES (
            ?,
            ?,
            ?,
            ?,
            ?
        );
    `,a=[r[t],r._rev,r._deleted?1:0,r._meta.lwt,JSON.stringify(r)];return{query:n,params:a,context:{method:"getSQLiteInsertSQL",data:{collectionName:e,primaryPath:t}}}}function vm(e,t,r){var n=r.document,a=`
    UPDATE "`+e+`"
    SET 
        revision = ?,
        deleted = ?,
        lastWriteTime = ?,
        data = json(?)
    WHERE
        id = ?
    `,c=[n._rev,n._deleted?1:0,n._meta.lwt,JSON.stringify(n),n[t]];return{query:a,params:c,context:{method:"getSQLiteUpdateSQL",data:{tableName:e,primaryPath:t}}}}var Ri=new WeakMap;function Pi(e,t,r,n){var a=Ri.get(e);return a||(a=At),a=a.then(()=>S(null,null,function*(){yield Ey(e,t);var c=yield r();yield Sy(e,t,c,n)})),Ri.set(e,a),a}function Ey(e,t){return S(this,null,function*(){for(var r=!1;!r;)try{yield t.run(e,{query:"BEGIN;",params:[],context:{method:"openSqliteTransaction",data:""}}),r=!0}catch(a){console.log("open transaction error (will retry):");var n=Pc(a);if(console.log(n),console.dir(a),a.message&&(a.message.includes("Database is closed")||a.message.includes("API misuse")))throw a;yield Zt(0)}})}function Sy(e,t,r,n){return t.run(e,{query:r+";",params:[],context:{method:"finishSqliteTransaction",data:r}}).catch(a=>{throw n&&(console.error("cannot close transaction (mode: "+r+")"),console.log(JSON.stringify(n,null,4))),a})}var Oy="?";function Ps(e){var t=e.params.length,r=e.query.split(Oy).length-1;if(t!==r)throw new Error("ensureParamsCountIsCorrect() wrong param count: "+JSON.stringify(e))}var Dy=0,Iy=(function(){function e(r,n,a,c,f,p,d,_,x){this.changes$=new Gt,this.instanceId=Dy++,this.openWriteCount$=new So(0),this.opCount=0,this.storage=r,this.databaseName=n,this.collectionName=a,this.schema=c,this.internals=f,this.options=p,this.settings=d,this.tableName=_,this.devMode=x,this.sqliteBasics=r.settings.sqliteBasics,this.primaryPath=Qe(this.schema.primaryKey)}var t=e.prototype;return t.run=function(n,a){return this.devMode&&Ps(a),this.sqliteBasics.run(n,a)},t.all=function(n,a){if(this.devMode&&Ps(a),this.opCount=this.opCount+1,this.opCount>110)throw H("SQL3");return this.sqliteBasics.all(n,a)},t.bulkWrite=function(n,a){return S(this,null,function*(){this.openWriteCount$.next(this.openWriteCount$.getValue()+1);var c=yield this.internals.databasePromise,f={error:[]},p=[],d={};if(yield Pi(c,this.sqliteBasics,()=>S(this,null,function*(){if(this.closed)throw this.openWriteCount$.next(this.openWriteCount$.getValue()-1),new Error("SQLite.bulkWrite("+a+") already closed "+this.tableName+" context: "+a);var x=yield this.all(c,{query:'SELECT data FROM "'+this.tableName+'"',params:[],context:{method:"bulkWrite",data:n}}),E=new Map;if(x.forEach(R=>{var I=JSON.parse(Ci(R)),A=I[this.primaryPath];E.set(A,I)}),d=li(this,this.primaryPath,E,n,a),f.error=d.errors,x.length+d.bulkInsertDocs.length>300)throw H("SQL2");return d.bulkInsertDocs.forEach(R=>{var I=dm(this.tableName,this.primaryPath,R.document);p.push(this.all(c,{query:I.query,params:I.params,context:{method:"bulkWrite",data:d}}))}),d.bulkUpdateDocs.forEach(R=>{var I=vm(this.tableName,this.primaryPath,R);p.push(this.run(c,I))}),yield Promise.all(p),this.closed?(this.openWriteCount$.next(this.openWriteCount$.getValue()-1),"ROLLBACK"):(this.openWriteCount$.next(this.openWriteCount$.getValue()-1),"COMMIT")}),{databaseName:this.databaseName,collectionName:this.collectionName}),d&&d.eventBulk.events.length>0){var _=ue(d.newestRow).document;d.eventBulk.checkpoint={id:_[this.primaryPath],lwt:_._meta.lwt},this.changes$.next(d.eventBulk)}return f})},t.query=function(n){return S(this,null,function*(){var a=yield this.internals.databasePromise,c=[],f=n.query,p=f.skip?f.skip:0,d=f.limit?f.limit:1/0,_=p+d,x=ir(this.schema,f),E=yield this.all(a,{query:'SELECT data FROM "'+this.tableName+'"',params:[],context:{method:"query",data:n}});E.forEach(I=>{var A=JSON.parse(Ci(I));x(A)&&c.push(A)});var R=Hr(this.schema,f);return c=c.sort(R),c=c.slice(p,_),{documents:c}})},t.count=function(n){return S(this,null,function*(){var a=yield this.query(n);return{count:a.documents.length,mode:"fast"}})},t.findDocumentsById=function(n,a){return S(this,null,function*(){var c=yield this.internals.databasePromise;if(this.closed)throw new Error("SQLite.findDocumentsById() already closed "+this.tableName+" context: "+context);for(var f=yield this.all(c,{query:'SELECT data FROM "'+this.tableName+'"',params:[],context:{method:"findDocumentsById",data:n}}),p=[],d=0;d<f.length;++d){var _=f[d],x=JSON.parse(Ci(_));n.includes(x[this.primaryPath])&&(a||!x._deleted)&&p.push(x)}return p})},t.changeStream=function(){return this.changes$.asObservable()},t.cleanup=function(n){return S(this,null,function*(){yield Zt(0),yield Zt(0);var a=yield this.internals.databasePromise,c=new Date().getTime()-n;return yield this.all(a,{query:`
                    DELETE FROM
                        "`+this.tableName+`"
                    WHERE
                        deleted = 1
                        AND
                        lastWriteTime < ?
                `,params:[c],context:{method:"cleanup",data:n}}),!0})},t.getAttachmentData=function(n,a){return S(this,null,function*(){throw H("SQL1")})},t.remove=function(){return S(this,null,function*(){if(this.closed)throw new Error("closed already");var n=yield this.internals.databasePromise,a=[this.run(n,{query:'DROP TABLE IF EXISTS "'+this.tableName+'"',params:[],context:{method:"remove",data:this.tableName}})];return yield Promise.all(a),this.close()})},t.close=function(){return S(this,null,function*(){var n=Ri.get(yield this.internals.databasePromise);return n&&(yield n),this.closed?this.closed:(this.closed=S(this,null,function*(){yield Au(this.openWriteCount$.pipe(ke(c=>c===0)));var a=yield this.internals.databasePromise;yield Pi(a,this.sqliteBasics,()=>Promise.resolve("COMMIT")).catch(()=>{}),this.changes$.complete(),yield hm(this.databaseName,this.storage.settings.sqliteBasics)}),this.closed)})},e})();function ym(e,t,r){return S(this,null,function*(){var n=r.sqliteBasics,a=t.collectionName+"-"+t.schema.version;if(t.schema.attachments)throw H("SQL1");var c={},f=(r.databaseNamePrefix?r.databaseNamePrefix:"")+"_trial_"+t.databaseName;c.databasePromise=pm(e.settings.sqliteBasics,f).then(d=>S(null,null,function*(){return yield Pi(d,n,()=>S(null,null,function*(){var _=`
                CREATE TABLE IF NOT EXISTS "`+a+`"(
                    id TEXT NOT NULL PRIMARY KEY UNIQUE,
                    revision TEXT,
                    deleted BOOLEAN NOT NULL CHECK (deleted IN (0, 1)),
                    lastWriteTime INTEGER NOT NULL,
                    data json
                );
                `;return yield n.run(d,{query:_,params:[],context:{method:"createSQLiteStorageInstance create tables",data:t.databaseName}}),"COMMIT"}),{indexCreation:!1,databaseName:t.databaseName,collectionName:t.collectionName}),d}));var p=new Iy(e,t.databaseName,t.collectionName,t.schema,c,t.options,r,a,t.devMode);return yield Di(Ai,t,p),p})}var Ry=new WeakMap,Ay=new Map,tn=At;function gm(e,t){var r=Ae(Ry,e,()=>{var n={open(c){return tn=tn.then(()=>S(null,null,function*(){var f=yield Ae(Ay,c,()=>e.createConnection(c,!1,"no-encryption",1));return yield f.open(),f})),tn},run(c,f){return S(this,null,function*(){yield c.run(f.query,f.params,!1)})},all(c,f){return S(this,null,function*(){var p=yield c.query(f.query,f.params);return ue(p.values)})},setPragma(c,f,p){return c.execute("PRAGMA "+f+" = "+p,!1)},close(c){return tn=tn.then(()=>c.close()),tn},journalMode:t.getPlatform()==="android"?"":"WAL"};return n});return r}var Cy=(function(){function e(r){this.name=Ai,this.rxdbVersion=_r,this.settings=r}var t=e.prototype;return t.createStorageInstance=function(n){return mi(n),ym(this,n,this.settings)},e})(),xm=!1;function wm(e){xm||(xm=!0,console.warn(["-------------- RxDB SQLite Trial Version in Use -------------------------------","You are using the trial version of the SQLite RxStorage from RxDB https://rxdb.info/rx-storage-sqlite.html?console=sqlite ",'While this is a great option to try out RxDB itself, notice that you should never use the trial version in production. It is way slower compared to the "real" SQLite storage',"and it has several limitations like not using indexes and being limited to store a maximum of 300 documents.","For production environments, use the premium SQLite RxStorage:"," https://rxdb.info/premium/?console=sqlite ","If you already purchased premium access, ensure that you have imported the correct sqlite storage from the premium plugins.","-------------------------------------------------------------------------------"].join(`
`)));var t=new Cy(e);return t}var Ti=class{constructor(t){this.sqlite=t,this._connectionDict=new Map}initWebStore(){return S(this,null,function*(){try{return yield this.sqlite.initWebStore(),Promise.resolve()}catch(t){return Promise.reject(t)}})}saveToStore(t){return S(this,null,function*(){try{return yield this.sqlite.saveToStore({database:t}),Promise.resolve()}catch(r){return Promise.reject(r)}})}saveToLocalDisk(t){return S(this,null,function*(){try{return yield this.sqlite.saveToLocalDisk({database:t}),Promise.resolve()}catch(r){return Promise.reject(r)}})}getFromLocalDiskToStore(t){return S(this,null,function*(){let r=t??!0;try{return yield this.sqlite.getFromLocalDiskToStore({overwrite:r}),Promise.resolve()}catch(n){return Promise.reject(n)}})}echo(t){return S(this,null,function*(){try{let r=yield this.sqlite.echo({value:t});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}isSecretStored(){return S(this,null,function*(){try{let t=yield this.sqlite.isSecretStored();return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}setEncryptionSecret(t){return S(this,null,function*(){try{return yield this.sqlite.setEncryptionSecret({passphrase:t}),Promise.resolve()}catch(r){return Promise.reject(r)}})}changeEncryptionSecret(t,r){return S(this,null,function*(){try{return yield this.sqlite.changeEncryptionSecret({passphrase:t,oldpassphrase:r}),Promise.resolve()}catch(n){return Promise.reject(n)}})}clearEncryptionSecret(){return S(this,null,function*(){try{return yield this.sqlite.clearEncryptionSecret(),Promise.resolve()}catch(t){return Promise.reject(t)}})}checkEncryptionSecret(t){return S(this,null,function*(){try{let r=yield this.sqlite.checkEncryptionSecret({passphrase:t});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}addUpgradeStatement(t,r){return S(this,null,function*(){try{return t.endsWith(".db")&&(t=t.slice(0,-3)),yield this.sqlite.addUpgradeStatement({database:t,upgrade:r}),Promise.resolve()}catch(n){return Promise.reject(n)}})}createConnection(t,r,n,a,c){return S(this,null,function*(){try{t.endsWith(".db")&&(t=t.slice(0,-3)),yield this.sqlite.createConnection({database:t,encrypted:r,mode:n,version:a,readonly:c});let f=new Mi(t,c,this.sqlite),p=c?`RO_${t}`:`RW_${t}`;return this._connectionDict.set(p,f),Promise.resolve(f)}catch(f){return Promise.reject(f)}})}closeConnection(t,r){return S(this,null,function*(){try{t.endsWith(".db")&&(t=t.slice(0,-3)),yield this.sqlite.closeConnection({database:t,readonly:r});let n=r?`RO_${t}`:`RW_${t}`;return this._connectionDict.delete(n),Promise.resolve()}catch(n){return Promise.reject(n)}})}isConnection(t,r){return S(this,null,function*(){let n={};t.endsWith(".db")&&(t=t.slice(0,-3));let a=r?`RO_${t}`:`RW_${t}`;return n.result=this._connectionDict.has(a),Promise.resolve(n)})}retrieveConnection(t,r){return S(this,null,function*(){t.endsWith(".db")&&(t=t.slice(0,-3));let n=r?`RO_${t}`:`RW_${t}`;if(this._connectionDict.has(n)){let a=this._connectionDict.get(n);return typeof a<"u"?Promise.resolve(a):Promise.reject(`Connection ${t} is undefined`)}else return Promise.reject(`Connection ${t} does not exist`)})}getNCDatabasePath(t,r){return S(this,null,function*(){try{let n=yield this.sqlite.getNCDatabasePath({path:t,database:r});return Promise.resolve(n)}catch(n){return Promise.reject(n)}})}createNCConnection(t,r){return S(this,null,function*(){try{yield this.sqlite.createNCConnection({databasePath:t,version:r});let n=new Mi(t,!0,this.sqlite),a=`RO_${t})`;return this._connectionDict.set(a,n),Promise.resolve(n)}catch(n){return Promise.reject(n)}})}closeNCConnection(t){return S(this,null,function*(){try{yield this.sqlite.closeNCConnection({databasePath:t});let r=`RO_${t})`;return this._connectionDict.delete(r),Promise.resolve()}catch(r){return Promise.reject(r)}})}isNCConnection(t){return S(this,null,function*(){let r={},n=`RO_${t})`;return r.result=this._connectionDict.has(n),Promise.resolve(r)})}retrieveNCConnection(t){return S(this,null,function*(){if(this._connectionDict.has(t)){let r=`RO_${t})`,n=this._connectionDict.get(r);return typeof n<"u"?Promise.resolve(n):Promise.reject(`Connection ${t} is undefined`)}else return Promise.reject(`Connection ${t} does not exist`)})}isNCDatabase(t){return S(this,null,function*(){try{let r=yield this.sqlite.isNCDatabase({databasePath:t});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}retrieveAllConnections(){return S(this,null,function*(){return this._connectionDict})}closeAllConnections(){return S(this,null,function*(){let t=new Map;try{for(let r of this._connectionDict.keys()){let n=r.substring(3),a=r.substring(0,3)==="RO_";yield this.sqlite.closeConnection({database:n,readonly:a}),t.set(r,null)}for(let r of t.keys())this._connectionDict.delete(r);return Promise.resolve()}catch(r){return Promise.reject(r)}})}checkConnectionsConsistency(){return S(this,null,function*(){try{let t=[...this._connectionDict.keys()],r=[],n=[];for(let c of t)r.push(c.substring(0,2)),n.push(c.substring(3));let a=yield this.sqlite.checkConnectionsConsistency({dbNames:n,openModes:r});return a.result||(this._connectionDict=new Map),Promise.resolve(a)}catch(t){return this._connectionDict=new Map,Promise.reject(t)}})}importFromJson(t){return S(this,null,function*(){try{let r=yield this.sqlite.importFromJson({jsonstring:t});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}isJsonValid(t){return S(this,null,function*(){try{let r=yield this.sqlite.isJsonValid({jsonstring:t});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}copyFromAssets(t){return S(this,null,function*(){let r=t??!0;try{return yield this.sqlite.copyFromAssets({overwrite:r}),Promise.resolve()}catch(n){return Promise.reject(n)}})}getFromHTTPRequest(t,r){return S(this,null,function*(){let n=r??!0;try{return yield this.sqlite.getFromHTTPRequest({url:t,overwrite:n}),Promise.resolve()}catch(a){return Promise.reject(a)}})}isDatabaseEncrypted(t){return S(this,null,function*(){t.endsWith(".db")&&(t=t.slice(0,-3));try{let r=yield this.sqlite.isDatabaseEncrypted({database:t});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}isInConfigEncryption(){return S(this,null,function*(){try{let t=yield this.sqlite.isInConfigEncryption();return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}isInConfigBiometricAuth(){return S(this,null,function*(){try{let t=yield this.sqlite.isInConfigBiometricAuth();return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}isDatabase(t){return S(this,null,function*(){t.endsWith(".db")&&(t=t.slice(0,-3));try{let r=yield this.sqlite.isDatabase({database:t});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}getDatabaseList(){return S(this,null,function*(){try{let r=(yield this.sqlite.getDatabaseList()).values;r.sort();let n={values:r};return Promise.resolve(n)}catch(t){return Promise.reject(t)}})}getMigratableDbList(t){return S(this,null,function*(){let r=t||"default";try{let n=yield this.sqlite.getMigratableDbList({folderPath:r});return Promise.resolve(n)}catch(n){return Promise.reject(n)}})}addSQLiteSuffix(t,r){return S(this,null,function*(){let n=t||"default",a=r||[];try{let c=yield this.sqlite.addSQLiteSuffix({folderPath:n,dbNameList:a});return Promise.resolve(c)}catch(c){return Promise.reject(c)}})}deleteOldDatabases(t,r){return S(this,null,function*(){let n=t||"default",a=r||[];try{let c=yield this.sqlite.deleteOldDatabases({folderPath:n,dbNameList:a});return Promise.resolve(c)}catch(c){return Promise.reject(c)}})}moveDatabasesAndAddSuffix(t,r){return S(this,null,function*(){let n=t||"default",a=r||[];return this.sqlite.moveDatabasesAndAddSuffix({folderPath:n,dbNameList:a})})}},Mi=class{constructor(t,r,n){this.dbName=t,this.readonly=r,this.sqlite=n}getConnectionDBName(){return this.dbName}getConnectionReadOnly(){return this.readonly}open(){return S(this,null,function*(){try{return yield this.sqlite.open({database:this.dbName,readonly:this.readonly}),Promise.resolve()}catch(t){return Promise.reject(t)}})}close(){return S(this,null,function*(){try{return yield this.sqlite.close({database:this.dbName,readonly:this.readonly}),Promise.resolve()}catch(t){return Promise.reject(t)}})}beginTransaction(){return S(this,null,function*(){try{let t=yield this.sqlite.beginTransaction({database:this.dbName});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}commitTransaction(){return S(this,null,function*(){try{let t=yield this.sqlite.commitTransaction({database:this.dbName});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}rollbackTransaction(){return S(this,null,function*(){try{let t=yield this.sqlite.rollbackTransaction({database:this.dbName});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}isTransactionActive(){return S(this,null,function*(){try{let t=yield this.sqlite.isTransactionActive({database:this.dbName});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}loadExtension(t){return S(this,null,function*(){try{return yield this.sqlite.loadExtension({database:this.dbName,path:t,readonly:this.readonly}),Promise.resolve()}catch(r){return Promise.reject(r)}})}enableLoadExtension(t){return S(this,null,function*(){try{return yield this.sqlite.enableLoadExtension({database:this.dbName,toggle:t,readonly:this.readonly}),Promise.resolve()}catch(r){return Promise.reject(r)}})}getUrl(){return S(this,null,function*(){try{let t=yield this.sqlite.getUrl({database:this.dbName,readonly:this.readonly});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}getVersion(){return S(this,null,function*(){try{let t=yield this.sqlite.getVersion({database:this.dbName,readonly:this.readonly});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}getTableList(){return S(this,null,function*(){try{let t=yield this.sqlite.getTableList({database:this.dbName,readonly:this.readonly});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}execute(t,r=!0,n=!0){return S(this,null,function*(){try{if(this.readonly)return Promise.reject("not allowed in read-only mode");{let a=yield this.sqlite.execute({database:this.dbName,statements:t,transaction:r,readonly:!1,isSQL92:n});return Promise.resolve(a)}}catch(a){return Promise.reject(a)}})}query(t,r,n=!0){return S(this,null,function*(){let a;try{return r&&r.length>0?a=yield this.sqlite.query({database:this.dbName,statement:t,values:r,readonly:this.readonly,isSQL92:!0}):a=yield this.sqlite.query({database:this.dbName,statement:t,values:[],readonly:this.readonly,isSQL92:n}),a=yield this.reorderRows(a),Promise.resolve(a)}catch(c){return Promise.reject(c)}})}run(t,r,n=!0,a="no",c=!0){return S(this,null,function*(){let f;try{return this.readonly?Promise.reject("not allowed in read-only mode"):(r&&r.length>0?f=yield this.sqlite.run({database:this.dbName,statement:t,values:r,transaction:n,readonly:!1,returnMode:a,isSQL92:!0}):f=yield this.sqlite.run({database:this.dbName,statement:t,values:[],transaction:n,readonly:!1,returnMode:a,isSQL92:c}),f.changes=yield this.reorderRows(f.changes),Promise.resolve(f))}catch(p){return Promise.reject(p)}})}executeSet(t,r=!0,n="no",a=!0){return S(this,null,function*(){let c;try{return this.readonly?Promise.reject("not allowed in read-only mode"):(c=yield this.sqlite.executeSet({database:this.dbName,set:t,transaction:r,readonly:!1,returnMode:n,isSQL92:a}),c.changes=yield this.reorderRows(c.changes),Promise.resolve(c))}catch(f){return Promise.reject(f)}})}isExists(){return S(this,null,function*(){try{let t=yield this.sqlite.isDBExists({database:this.dbName,readonly:this.readonly});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}isTable(t){return S(this,null,function*(){try{let r=yield this.sqlite.isTableExists({database:this.dbName,table:t,readonly:this.readonly});return Promise.resolve(r)}catch(r){return Promise.reject(r)}})}isDBOpen(){return S(this,null,function*(){try{let t=yield this.sqlite.isDBOpen({database:this.dbName,readonly:this.readonly});return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}delete(){return S(this,null,function*(){try{return this.readonly?Promise.reject("not allowed in read-only mode"):(yield this.sqlite.deleteDatabase({database:this.dbName,readonly:!1}),Promise.resolve())}catch(t){return Promise.reject(t)}})}createSyncTable(){return S(this,null,function*(){try{if(this.readonly)return Promise.reject("not allowed in read-only mode");{let t=yield this.sqlite.createSyncTable({database:this.dbName,readonly:!1});return Promise.resolve(t)}}catch(t){return Promise.reject(t)}})}setSyncDate(t){return S(this,null,function*(){try{return this.readonly?Promise.reject("not allowed in read-only mode"):(yield this.sqlite.setSyncDate({database:this.dbName,syncdate:t,readonly:!1}),Promise.resolve())}catch(r){return Promise.reject(r)}})}getSyncDate(){return S(this,null,function*(){try{let t=yield this.sqlite.getSyncDate({database:this.dbName,readonly:this.readonly}),r="";return t.syncDate>0&&(r=new Date(t.syncDate*1e3).toISOString()),Promise.resolve(r)}catch(t){return Promise.reject(t)}})}exportToJson(t,r=!1){return S(this,null,function*(){try{let n=yield this.sqlite.exportToJson({database:this.dbName,jsonexportmode:t,readonly:this.readonly,encrypted:r});return Promise.resolve(n)}catch(n){return Promise.reject(n)}})}deleteExportedRows(){return S(this,null,function*(){try{return this.readonly?Promise.reject("not allowed in read-only mode"):(yield this.sqlite.deleteExportedRows({database:this.dbName,readonly:!1}),Promise.resolve())}catch(t){return Promise.reject(t)}})}executeTransaction(t,r=!0){return S(this,null,function*(){let n=0,a=!1;if(this.readonly)return Promise.reject("not allowed in read-only mode");if(yield this.sqlite.beginTransaction({database:this.dbName}),a=yield this.sqlite.isTransactionActive({database:this.dbName}),!a)return Promise.reject("After Begin Transaction, no transaction active");try{for(let p of t){if(typeof p!="object"||!("statement"in p))throw new Error("Error a task.statement must be provided");if("values"in p&&p.values&&p.values.length>0){let d=p.statement.toUpperCase().includes("RETURNING")?"all":"no",_=yield this.sqlite.run({database:this.dbName,statement:p.statement,values:p.values,transaction:!1,readonly:!1,returnMode:d,isSQL92:r});if(_.changes.changes<0)throw new Error("Error in transaction method run ");n+=_.changes.changes}else{let d=yield this.sqlite.execute({database:this.dbName,statements:p.statement,transaction:!1,readonly:!1});if(d.changes.changes<0)throw new Error("Error in transaction method execute ");n+=d.changes.changes}}let c=yield this.sqlite.commitTransaction({database:this.dbName});n+=c.changes.changes;let f={changes:{changes:n}};return Promise.resolve(f)}catch(c){let f=c.message?c.message:c;return yield this.sqlite.rollbackTransaction({database:this.dbName}),Promise.reject(f)}})}reorderRows(t){return S(this,null,function*(){let r=t;if(t?.values&&typeof t.values[0]=="object"&&Object.keys(t.values[0]).includes("ios_columns")){let n=t.values[0].ios_columns,a=[];for(let c=1;c<t.values.length;c++){let f=t.values[c],p={};for(let d of n)p[d]=f[d];a.push(p)}r.values=a}return Promise.resolve(r)})}};var Ts=ac("CapacitorSQLite",{web:()=>import("./chunk-DUUQYY5X.js").then(e=>new e.CapacitorSQLiteWeb),electron:()=>window.CapacitorCustomPlatform.plugins.CapacitorSQLite});var ki=dh(bm(),1),_m=Symbol.for("Dexie"),Wn=globalThis[_m]||(globalThis[_m]=ki.default);if(ki.default.semVer!==Wn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${ki.default.semVer} and ${Wn.semVer}`);var{liveQuery:w2,mergeRanges:b2,rangesOverlap:_2,RangeSet:E2,cmp:S2,Entity:O2,PropModSymbol:D2,PropModification:I2,replacePrefix:R2,add:A2,remove:C2}=Wn;var zn="docs",Py="changes",Em="attachments",$i="dexie",Sm=new Map,Ni=new Map;function Om(e,t,r,n){var a="rxdb-dexie-"+e+"--"+n.version+"--"+t,c=Ae(Sm,a,()=>{var f=S(null,null,function*(){var p=Ee(r);p.autoOpen=!1;var d=new Wn(a,p);r.onCreate&&(yield r.onCreate(d,a));var _={[zn]:Ty(n),[Py]:"++sequence, id",[Em]:"id"};return d.version(1).stores(_),yield d.open(),{dexieDb:d,dexieTable:d[zn],dexieAttachmentsTable:d[Em],booleanIndexes:My(n)}});return Sm.set(a,c),Ni.set(c,0),f});return c}function Dm(e){return S(this,null,function*(){var t=yield e,r=Ni.get(e),n=r-1;n===0?(t.dexieDb.close(),Ni.delete(e)):Ni.set(e,n)})}var Ns="__";function Ir(e){var t=e.split(".");if(t.length>1)return t.map(n=>Ir(n)).join(".");if(e.startsWith("|")){var r=e.substring(1);return Ns+r}else return e}function Im(e){var t=e.split(".");if(t.length>1)return t.map(n=>Im(n)).join(".");if(e.startsWith(Ns)){var r=e.substring(Ns.length);return"|"+r}else return e}function Rm(e,t){if(!t)return t;var r=Ee(t);return r=$s(r),e.forEach(n=>{var a=Ct(t,n),c=a?"1":"0",f=Ir(n);Fa(r,f,c)}),r}function Ls(e,t){return t&&(t=Ee(t),t=Bs(t),e.forEach(r=>{var n=Ct(t,r),a=n==="1";Fa(t,r,a)}),t)}function $s(e){if(!e||typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(Array.isArray(e))return e.map(r=>$s(r));if(typeof e=="object"){var t={};return Object.entries(e).forEach(([r,n])=>{typeof n=="object"&&(n=$s(n)),t[Ir(r)]=n}),t}}function Bs(e){if(!e||typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(Array.isArray(e))return e.map(r=>Bs(r));if(typeof e=="object"){var t={};return Object.entries(e).forEach(([r,n])=>{(typeof n=="object"||Array.isArray(e))&&(n=Bs(n)),t[Im(r)]=n}),t}}function Ty(e){var t=[],r=Qe(e.primaryKey);t.push([r]),t.push(["_deleted",r]),e.indexes&&e.indexes.forEach(c=>{var f=Dn(c);t.push(f)}),t.push(["_meta.lwt",r]),t.push(["_meta.lwt"]),t=t.map(c=>c.map(f=>Ir(f)));var n=t.map(c=>c.length===1?c[0]:"["+c.join("+")+"]");n=n.filter((c,f,p)=>p.indexOf(c)===f);var a=n.join(", ");return a}function Fs(e,t){return S(this,null,function*(){var r=yield e,n=yield r.dexieTable.bulkGet(t);return n.map(a=>Ls(r.booleanIndexes,a))})}function Qn(e,t){return e+"||"+t}function My(e){var t=new Set,r=[];return e.indexes?(e.indexes.forEach(n=>{var a=Dn(n);a.forEach(c=>{if(!t.has(c)){t.add(c);var f=Pt(e,c);f.type==="boolean"&&r.push(c)}})}),r.push("_deleted"),hc(r)):r}function Am(e){return e===Sr?-1/0:e}function Cm(e,t,r){if(e.includes(t)){var n=r===Er||r===!0?"1":"0";return n}else return r}function Pm(e,t,r){if(!r){if(typeof window>"u")throw new Error("IDBKeyRange missing");r=window.IDBKeyRange}var n=t.startKeys.map((f,p)=>{var d=t.index[p];return Cm(e,d,f)}).map(Am),a=t.endKeys.map((f,p)=>{var d=t.index[p];return Cm(e,d,f)}).map(Am),c=r.bound(n,a,!t.inclusiveStart,!t.inclusiveEnd);return c}function js(e,t){return S(this,null,function*(){var r=yield e.internals,n=t.query,a=n.skip?n.skip:0,c=n.limit?n.limit:1/0,f=a+c,p=t.queryPlan,d=!1;p.selectorSatisfiedByIndex||(d=ir(e.schema,t.query));var _=Pm(r.booleanIndexes,p,r.dexieDb._options.IDBKeyRange),x=p.index,E=[];if(yield r.dexieDb.transaction("r",r.dexieTable,I=>S(null,null,function*(){var A=I.idbtrans,F=A.objectStore(zn),B,Z;Z="["+x.map(re=>Ir(re)).join("+")+"]",B=F.index(Z);var G=B.openCursor(_);yield new Promise(re=>{G.onsuccess=function(xe){var me=xe.target.result;if(me){var be=Ls(r.booleanIndexes,me.value);(!d||d(be))&&E.push(be),p.sortSatisfiedByIndex&&E.length===f?re():me.continue()}else re()}})})),!p.sortSatisfiedByIndex){var R=Hr(e.schema,t.query);E=E.sort(R)}return E=E.slice(a,f),{documents:E}})}function Tm(e,t){return S(this,null,function*(){var r=yield e.internals,n=t.queryPlan,a=n.index,c=Pm(r.booleanIndexes,n,r.dexieDb._options.IDBKeyRange),f=-1;return yield r.dexieDb.transaction("r",r.dexieTable,p=>S(null,null,function*(){var d=p.idbtrans,_=d.objectStore(zn),x,E;E="["+a.map(I=>Ir(I)).join("+")+"]",x=_.index(E);var R=x.count(c);f=yield new Promise((I,A)=>{R.onsuccess=function(){I(R.result)},R.onerror=F=>A(F)})})),f})}var ky=ze(),Ks=!1,Ny=(function(){function e(r,n,a,c,f,p,d,_){this.changes$=new Gt,this.instanceId=ky++,this.storage=r,this.databaseName=n,this.collectionName=a,this.schema=c,this.internals=f,this.options=p,this.settings=d,this.devMode=_,this.primaryPath=Qe(this.schema.primaryKey)}var t=e.prototype;return t.bulkWrite=function(n,a){return S(this,null,function*(){Rr(this),!Ks&&!(yield Ko())&&console.warn(["-------------- RxDB Open Core RxStorage -------------------------------","You are using the free Dexie.js based RxStorage implementation from RxDB https://rxdb.info/rx-storage-dexie.html?console=dexie ","While this is a great option, we want to let you know that there are faster storage solutions available in our premium plugins.","For professional users and production environments, we highly recommend considering these premium options to enhance performance and reliability."," https://rxdb.info/premium/?console=dexie ","If you already purchased premium access you can disable this log by calling the setPremiumFlag() function from rxdb-premium/plugins/shared.","---------------------------------------------------------------------"].join(`
`)),Ks=!0,n.forEach(x=>{if(!x.document._rev||x.previous&&!x.previous._rev)throw H("SNH",{args:{row:x}})});var c=yield this.internals,f={error:[]};this.devMode&&(n=n.map(x=>{var E=Dr(x.document);return{previous:x.previous,document:E}}));var p=n.map(x=>x.document[this.primaryPath]),d;if(yield c.dexieDb.transaction("rw",c.dexieTable,c.dexieAttachmentsTable,()=>S(this,null,function*(){var x=new Map,E=yield Fs(this.internals,p);E.forEach(A=>{var F=A;return F&&x.set(F[this.primaryPath],F),F}),d=li(this,this.primaryPath,x,n,a),f.error=d.errors;var R=[];d.bulkInsertDocs.forEach(A=>{R.push(A.document)}),d.bulkUpdateDocs.forEach(A=>{R.push(A.document)}),R=R.map(A=>Rm(c.booleanIndexes,A)),R.length>0&&(yield c.dexieTable.bulkPut(R));var I=[];d.attachmentsAdd.forEach(A=>{I.push({id:Qn(A.documentId,A.attachmentId),data:A.attachmentData.data})}),d.attachmentsUpdate.forEach(A=>{I.push({id:Qn(A.documentId,A.attachmentId),data:A.attachmentData.data})}),yield c.dexieAttachmentsTable.bulkPut(I),yield c.dexieAttachmentsTable.bulkDelete(d.attachmentsRemove.map(A=>Qn(A.documentId,A.attachmentId)))})),d=ue(d),d.eventBulk.events.length>0){var _=ue(d.newestRow).document;d.eventBulk.checkpoint={id:_[this.primaryPath],lwt:_._meta.lwt},this.changes$.next(d.eventBulk)}return f})},t.findDocumentsById=function(n,a){return S(this,null,function*(){Rr(this);var c=yield this.internals,f=[];return yield c.dexieDb.transaction("r",c.dexieTable,()=>S(this,null,function*(){var p=yield Fs(this.internals,n);p.forEach(d=>{d&&(!d._deleted||a)&&f.push(d)})})),f})},t.query=function(n){return Rr(this),js(this,n)},t.count=function(n){return S(this,null,function*(){if(n.queryPlan.selectorSatisfiedByIndex){var a=yield Tm(this,n);return{count:a,mode:"fast"}}else{var c=yield js(this,n);return{count:c.documents.length,mode:"slow"}}})},t.changeStream=function(){return Rr(this),this.changes$.asObservable()},t.cleanup=function(n){return S(this,null,function*(){Rr(this);var a=yield this.internals;return yield a.dexieDb.transaction("rw",a.dexieTable,()=>S(this,null,function*(){var c=ze()-n,f=yield a.dexieTable.where("_meta.lwt").below(c).toArray(),p=[];f.forEach(d=>{d._deleted==="1"&&p.push(d[this.primaryPath])}),yield a.dexieTable.bulkDelete(p)})),!0})},t.getAttachmentData=function(n,a,c){return S(this,null,function*(){Rr(this);var f=yield this.internals,p=Qn(n,a);return yield f.dexieDb.transaction("r",f.dexieAttachmentsTable,()=>S(this,null,function*(){var d=yield f.dexieAttachmentsTable.get(p);if(d)return d.data;throw new Error("attachment missing documentId: "+n+" attachmentId: "+a)}))})},t.remove=function(){return S(this,null,function*(){Rr(this);var n=yield this.internals;return yield n.dexieTable.clear(),this.close()})},t.close=function(){return this.closed?this.closed:(this.closed=S(this,null,function*(){this.changes$.complete(),yield Dm(this.internals)}),this.closed)},e})();function Mm(e,t,r){return S(this,null,function*(){var n=Om(t.databaseName,t.collectionName,r,t.schema),a=new Ny(e,t.databaseName,t.collectionName,t.schema,n,t.options,r,t.devMode);return yield Di($i,t,a),Promise.resolve(a)})}function Rr(e){if(e.closed)throw new Error("RxStorageInstanceDexie is closed "+e.databaseName+"-"+e.collectionName)}var $y=(function(){function e(r){this.name=$i,this.rxdbVersion=_r,this.settings=r}var t=e.prototype;return t.createStorageInstance=function(n){if(mi(n),n.schema.indexes){var a=n.schema.indexes.flat();a.filter(c=>!c.includes(".")).forEach(c=>{if(!n.schema.required||!n.schema.required.includes(c))throw H("DXE1",{field:c,schema:n.schema})})}return Mm(this,n,this.settings)},e})();function km(e={}){var t=new $y(e);return t}var By=new Ti(Ts),rn={production:!0,apiUrl:"https://api.yourdomain.com",wsUrl:"wss://api.yourdomain.com",databaseName:"kiosk_prod",multiInstance:!1,addRxDBPlugins(){},getRxStorage(){return ic.isNativePlatform()?wm({sqliteBasics:gm(By,Ts)}):km()}};var Nm={title:"Txn",description:"Txn schema",version:0,primaryKey:"id",keyCompression:!1,type:"object",properties:{id:{type:"string",primary:!0,maxLength:100},name:{type:"string",maxLength:200},id_card_base64:{type:"string",maxLength:1e6},student_number:{type:"string",maxLength:50},register_type:{type:"string",maxLength:20},door_permission:{type:"array",items:{type:"string",maxLength:10}},status:{type:"string",maxLength:20},client_created_at:{type:"string",maxLength:20},client_updated_at:{type:"string",maxLength:20},server_created_at:{type:"string",maxLength:20},server_updated_at:{type:"string",maxLength:20}},required:["id","name","id_card_base64","student_number","register_type","door_permission","status","client_created_at"]},lj=Nm,$m=Nm;rn.addRxDBPlugins();var Ly="kiosk_db",Fy={txn:{schema:$m}};function jy(e){return S(this,null,function*(){rn.addRxDBPlugins(),console.log("DatabaseService: creating database..");let t={fromObservable(n,a){return Ra(()=>lc(n,{initialValue:a,injector:e}))}},r=yield Vf({name:Ly,storage:rn.getRxStorage(),multiInstance:rn.multiInstance,reactivity:t});return console.log("DatabaseService: created database"),rn.multiInstance&&r.waitForLeadership().then(()=>{console.log("isLeader now"),document.title="\u265B "+document.title}),console.log("DatabaseService: create collections"),yield r.addCollections(Fy),r})}var qs=null,Bm;function Lm(e){return S(this,null,function*(){if(!e)throw new Error("initDatabase() injector missing");qs||(console.log("initDatabase()"),qs=jy(e).then(t=>Bm=t)),yield qs})}var Fm=(()=>{class e{get db(){return Bm}static \u0275fac=function(n){return new(n||e)};static \u0275prov=Io({token:e,factory:e.\u0275fac})}return e})();var jm=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=Ao({type:e,bootstrap:[sc]});static \u0275inj=Ro({providers:[{provide:Xu,useClass:Ju},{provide:qu,useFactory:r=>()=>Lm(r),multi:!0,deps:[On]},Fm,cc(),nc,rc,oc({theme:{preset:"aura",options:{darkModeSelector:!1}},ripple:!0})],imports:[Yu,tc.forRoot(),uc]})}return e})();Hu().bootstrapModule(jm).catch(e=>console.log(e));
